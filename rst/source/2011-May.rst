===============
2011-May
===============

| [Sunday 01 May 2011] [02:59:12] <ASY>	wondering what can be the cause of this...
| [Sunday 01 May 2011] [03:01:09] <ASY>	I am sending messages from different threads as follows:
| [Sunday 01 May 2011] [03:01:17] <ASY>	zmq::message_t request(e,e->size(),&event_queue::free_callback);
| [Sunday 01 May 2011] [03:01:17] <ASY>	socket_req_.send(request,ZMQ_NOBLOCK);
| [Sunday 01 May 2011] [03:02:07] <ASY>	in the main thread I do:  id = zmq_poll (&poll_items[0], (int)poll_items.size(), 1000 * 1000);
| [Sunday 01 May 2011] [03:03:03] <ASY>	wondering if this is thread related.
| [Sunday 01 May 2011] [03:03:24] <ASY>	if anyone has any thoughts, please let me know.  thanks.
| [Sunday 01 May 2011] [03:16:37] <ASY>	hm... upgraded to 2.1.6, can't seem to reproduce yet...
| [Sunday 01 May 2011] [03:56:36] <pieterh>	ASY: what version were you using before you upgraded?
| [Sunday 01 May 2011] [03:59:34] <ASY>	2.1.3
| [Sunday 01 May 2011] [04:59:40] <pieterh>	ASY: are you using the same sockets from multiple threads?
| [Sunday 01 May 2011] [05:00:09] <pieterh>	if you poll in one thread and send/recv in another, it'll crash under load
| [Sunday 01 May 2011] [05:00:52] <pieterh>	(if you're working with the same sockets in multiple threads, that is)
| [Sunday 01 May 2011] [05:11:59] <ASY>	hm... you know what... I think this is it!
| [Sunday 01 May 2011] [05:12:15] <ASY>	i use two sockets, however the sending socket is not protected
| [Sunday 01 May 2011] [05:13:14] <ASY>	yup.  that gotta be it.  gotta place a mutex on the sending function
| [Sunday 01 May 2011] [05:17:02] <ASY>	i was perfectly aware of this problem.  it is in the docs, but somehow i didn't see it in the code until you said it.
| [Sunday 01 May 2011] [05:17:04] <ASY>	thanks.
| [Sunday 01 May 2011] [06:06:43] <pieterh>	ASY: if you're using the same socket from two threads, your design is wrong, usually
| [Sunday 01 May 2011] [06:11:46] <ASY>	correct, but not in this case I don't think.  i have a central function that gets invoked from different async callbacks of different 3rd party libraries. i don't even know which threads this function gets invoked from.  this is special circumstances.  if these are my threads, however, they will establish a dedicated socket.
| [Sunday 01 May 2011] [06:19:16] <pieterh>	what language are you working in?
| [Sunday 01 May 2011] [06:19:56] <ASY>	C++
| [Sunday 01 May 2011] [06:20:45] <pieterh>	well, I'm no expert in weird async callbacks but IMO if you end up using mutexes to share 0MQ sockets, your design is probably not ideal
| [Sunday 01 May 2011] [06:21:00] <pieterh>	I'd try to get all callbacks to a single thread and then use 0MQ inproc sockets between that and other threads
| [Sunday 01 May 2011] [06:21:23] <pieterh>	sorry to just offer generalities... anyhow, glad we found the cause of the crashes
| [Sunday 01 May 2011] [06:23:47] <ASY>	the reason I have a central (now mutexed) function is that it relays events to a central event queue using one inproc socket.  this is my way of getting all callbacks to a single thread... :)
| [Sunday 01 May 2011] [06:25:33] <guido_g>	pieterh: this kind of _design_ is tought all over the place, will be hard to negate the included brainwashing
| [Sunday 01 May 2011] [06:26:18] <pieterh>	ASY: have you studied the asyncsrv example in the Guide?
| [Sunday 01 May 2011] [06:26:23] <pieterh>	guido_g: seems so...
| [Sunday 01 May 2011] [06:26:30] <guido_g>	but hey, that's the price to pay to be in an elitist community  ]:->
| [Sunday 01 May 2011] [06:26:54] <pieterh>	guido_g: we'
| [Sunday 01 May 2011] [06:26:58] <pieterh>	we're elitist?
| [Sunday 01 May 2011] [06:27:06] <pieterh>	I thought we were cryptoanarchists
| [Sunday 01 May 2011] [06:27:46] <guido_g>	sure, we're everything we want to be
| [Sunday 01 May 2011] [06:27:56] <guido_g>	oh, shit, this would be punk...  ,)
| [Sunday 01 May 2011] [06:28:44] <pieterh>	:)
| [Sunday 01 May 2011] [06:29:23] <ASY>	async callbacks come from multiple unrelated existing subsystems, so there is really nothing I can do other then making my own custom event queue, which is pointless since I have zmq.  the advantage of using zmq with this is that I do also have multiple processes and multiple threads that push data through individually established sockets to the same queue.  so really it is only a segment of 
| [Sunday 01 May 2011] [06:29:23] <ASY>	the application that suffers from this due to 3rd party callbacks.
| [Sunday 01 May 2011] [06:30:34] <pieterh>	ASY: I'm sure you're right, it's hard to tell from where I'm sitting
| [Sunday 01 May 2011] [06:35:03] <ASY>	i have another question if you don't mind.  I have an application that does broadcast UDP discovery of it's siblings on the network...  every system broadcasts on a known port and learns about the presense of the others.  I am wondering if there is anything in zmq that can be used to acheive something like that.
| [Sunday 01 May 2011] [06:36:00] <guido_g>	pub/sub using a common channel for discovery
| [Sunday 01 May 2011] [06:36:10] <guido_g>	you might want to use (e)pgm for that
| [Sunday 01 May 2011] [06:37:33] <ASY>	ok, i will read up on that and try to figure it out.
| [Sunday 01 May 2011] [06:38:17] <guido_g>	basically you use a well known multicast group instead of the subnets broadcast address
| [Sunday 01 May 2011] [06:40:35] <ASY>	ok, i will start working on that in about a week probably, will probably be back with questions :)
| [Sunday 01 May 2011] [06:40:59] <guido_g>	np
| [Sunday 01 May 2011] [06:41:12] <ASY>	6:40am :/  gotta crash
| [Sunday 01 May 2011] [06:41:30] <guido_g>	:)
| [Sunday 01 May 2011] [06:41:36] <ASY>	where are you guys located?
| [Sunday 01 May 2011] [06:41:50] <guido_g>	europe
| [Sunday 01 May 2011] [06:41:59] <guido_g>	so it's time for lunch
| [Sunday 01 May 2011] [06:42:17] <ASY>	:)
| [Sunday 01 May 2011] [06:42:37] <ASY>	ok, thanks for everyones help.  bbl. cheers.
| [Sunday 01 May 2011] [06:42:45] <guido_g>	good night!
| [Sunday 01 May 2011] [07:02:32] <Guthur>	did someone finally get 0MQ on android
| [Sunday 01 May 2011] [07:03:17] <pieterh>	Guthur: well, I've written up the protocol so it's possible to make it in Javascript now, I guess
| [Sunday 01 May 2011] [07:03:25] <pieterh>	I'm doing some Android development but not in C
| [Sunday 01 May 2011] [07:03:37] <pieterh>	Also, I'd probably not use 0MQ across an open internet in any case
| [Sunday 01 May 2011] [07:04:00] <Guthur>	I just got an android phone yesterday and development some development for it is on my todo list
| [Sunday 01 May 2011] [07:04:32] <pieterh>	tbh I'd make a http bridge that maps req/rep and pub/sub to simple HTTP methods
| [Sunday 01 May 2011] [07:04:33] <Guthur>	ah yes, internet...
| [Sunday 01 May 2011] [07:04:46] 	 * pieterh is going to have to spend a couple of hours making this one day
| [Sunday 01 May 2011] [07:05:02] <pieterh>	get URI -> long poll to receive next sub message
| [Sunday 01 May 2011] [07:05:08] <pieterh>	post URI -> publish
| [Sunday 01 May 2011] [07:05:12] <pieterh>	etc.
| [Sunday 01 May 2011] [07:05:23] <Guthur>	have you looked at websockets
| [Sunday 01 May 2011] [07:05:45] <pieterh>	yes yes but it's not stable
| [Sunday 01 May 2011] [07:06:01] <pieterh>	there are several versions and its still in evolution
| [Sunday 01 May 2011] [07:06:25] <pieterh>	it would be the right solution if/when it emerges from its IEFT party
| [Sunday 01 May 2011] [07:06:54] <Guthur>	yeah, I actually mistakenly assumed it had become stable by now
| [Sunday 01 May 2011] [07:08:02] <pieterh>	subscribe to the IEFT HyBi list for great merriment
| [Sunday 01 May 2011] [07:11:48] <Guthur>	pieterh, do you know if android allows raw TCP connections, so that 0MQ could work over the internet if a secure connection wasn't a requirement
| [Sunday 01 May 2011] [07:12:05] <pieterh>	Guthur: afaik yes, it does
| [Sunday 01 May 2011] [07:12:25] <pieterh>	in fact it's 100% certain that it does
| [Sunday 01 May 2011] [07:13:18] <djc>	longpolling is kind of an ugly hack
| [Sunday 01 May 2011] [07:13:28] <djc>	but mapping req/rep to HTTP does make sense
| [Sunday 01 May 2011] [07:13:34] <djc>	do the pyzmq guys hang out here?
| [Sunday 01 May 2011] [07:13:50] <pieterh>	longpolling is a hack but not any different than waiting on a TCP socket, really
| [Sunday 01 May 2011] [07:14:05] <pieterh>	especially if you return a stream rather than just one message
| [Sunday 01 May 2011] [07:34:32] <guido_g>	djc: the wrapper devs are here often, if you need them better use the mailinglist
| [Sunday 01 May 2011] [07:34:36] <guido_g>	*are not
| [Sunday 01 May 2011] [07:34:46] <djc>	I filed an issue
| [Sunday 01 May 2011] [07:35:49] <guido_g>	nothing serious
| [Sunday 01 May 2011] [07:38:39] <guido_g>	here it works
| [Sunday 01 May 2011] [07:38:53] <guido_g>	did you try a specific version?
| [Sunday 01 May 2011] [07:39:07] <guido_g>	or just the head of master?
| [Sunday 01 May 2011] [07:39:32] <djc>	2.1.4
| [Sunday 01 May 2011] [07:39:58] <guido_g>	ah ok
| [Sunday 01 May 2011] [07:40:08] <guido_g>	2.1dev works
| [Sunday 01 May 2011] [07:41:20] <guido_g>	aka latest master
| [Sunday 01 May 2011] [07:44:06] <djc>	did you reproduce my issue with 2.1.4?
| [Sunday 01 May 2011] [07:44:25] <guido_g>	not yet
| [Sunday 01 May 2011] [07:47:11] <guido_g>	nope, works fine here
| [Sunday 01 May 2011] [07:47:29] <guido_g>	-> Ran 73 tests in 8.164s
| [Sunday 01 May 2011] [07:48:07] <guido_g>	so it might be something blocking the network address and/or port
| [Sunday 01 May 2011] [07:48:13] <guido_g>	did you check that?
| [Sunday 01 May 2011] [21:00:35] <neopallium>	iFire: I am here.
| [Sunday 01 May 2011] [21:01:58] <neopallium>	iFire: yes, build it like any C Lua module.  Make sure to link it against libzmq (-lzmq).
| [Sunday 01 May 2011] [21:10:43] <iFire>	neopallium 
| [Sunday 01 May 2011] [21:10:44] <iFire>	> require "lua-zmq"
| [Sunday 01 May 2011] [21:10:44] <iFire>	error loading module 'lua-zmq' from file '.\lua-zmq.dll':
| [Sunday 01 May 2011] [21:10:44] <iFire>	        The specified procedure could not be found.
| [Sunday 01 May 2011] [21:10:46] <iFire>	I get that
| [Sunday 01 May 2011] [21:10:59] <iFire>	where  pre_generated-zmq.nobj.c is compiled into lua-zmq.dll
| [Sunday 01 May 2011] [21:11:44] <iFire>	on windows
| [Sunday 01 May 2011] [21:11:48] <iFire>	using lua-jit
| [Sunday 01 May 2011] [22:12:56] <iFire>	neopallium how was dinner :P
| [Sunday 01 May 2011] [22:58:08] <iFire>	neopallium I can't seem to load the library from a lua interpreter
| [Sunday 01 May 2011] [22:58:21] <iFire>	what's a short lua thing to test if it works
| [Sunday 01 May 2011] [23:02:30] <private_meta>	 AH GODDAMMIT!
| [Sunday 01 May 2011] [23:06:28] 	 * iFire calls first aid to private_meta
| [Sunday 01 May 2011] [23:07:07] <private_meta>	I spent so much time to implement our communications library with ZeroMQ and now it seems like it's got the same problem as ASIO
| [Sunday 01 May 2011] [23:07:19] <private_meta>	OMG this pisses me off so much
| [Sunday 01 May 2011] [23:07:29] 	 * iFire listens
| [Sunday 01 May 2011] [23:08:09] <iFire>	private_meta same problem?
| [Sunday 01 May 2011] [23:08:18] <private_meta>	Messages are lost/garbled
| [Sunday 01 May 2011] [23:08:30] <private_meta>	when I compile it with OpenMPI
| [Sunday 01 May 2011] [23:10:01] <iFire>	I thought you weren't supposed to use zeromq with locks and stuff
| [Sunday 01 May 2011] [23:10:12] <iFire>	each thread is supposed to be its own unit
| [Sunday 01 May 2011] [23:10:27] <iFire>	and you communicate through inproc/ipc/tcp/etc.
| [Sunday 01 May 2011] [23:11:14] <private_meta>	I don't know what you get at with that
| [Sunday 01 May 2011] [23:13:09] <private_meta>	iFire: not sure what that has to do with my problem
| [Sunday 01 May 2011] [23:13:40] <iFire>	hmm
| [Sunday 01 May 2011] [23:13:43] <iFire>	sorry
| [Sunday 01 May 2011] [23:13:55] <iFire>	well mpi and zeromq do the same things
| [Sunday 01 May 2011] [23:14:09] <iFire>	unless you're using it to connect two systems
| [Sunday 01 May 2011] [23:14:42] <iFire>	http://zguide.zeromq.org/page:all#Multithreading-with-MQ
| [Sunday 01 May 2011] [23:16:13] <private_meta>	I'm using MPI to create parallel processes and to control them, I wanted to use zeromq for backend communication
| [Sunday 01 May 2011] [23:16:29] <private_meta>	each process being a client
| [Sunday 01 May 2011] [23:16:34] <private_meta>	these two are independent
| [Sunday 01 May 2011] [23:16:55] <jer>	why use MPI for that and not zeromq for both?
| [Sunday 01 May 2011] [23:18:00] <private_meta>	Because zmq doesn't supply most of the mpi functions like scattering, gathering, ... out of the box like mpi
| [Sunday 01 May 2011] [23:29:08] <neopallium>	iFire: back, you need to use: require"zmq"
| [Sunday 01 May 2011] [23:30:00] <iFire>	hmm
| [Sunday 01 May 2011] [23:30:06] <iFire>	what about the dll
| [Sunday 01 May 2011] [23:30:26] <iFire>	I'm doing a custom packaging
| [Sunday 01 May 2011] [23:30:33] <iFire>	so everything is in the wrong place
| [Sunday 01 May 2011] [23:30:44] <neopallium>	the dll, I think you will need to call: zmq.dll
| [Sunday 01 May 2011] [23:31:07] <iFire>	> require "zmq"
| [Sunday 01 May 2011] [23:31:07] <iFire>	error loading module 'zmq' from file '.\zmq.dll':
| [Sunday 01 May 2011] [23:31:07] <iFire>	        The specified procedure could not be found.
| [Sunday 01 May 2011] [23:31:15] <iFire>	I renamed lua-zmq.dll to zmq.dll
| [Sunday 01 May 2011] [23:31:20] <iFire>	hmm
| [Sunday 01 May 2011] [23:31:42] <iFire>	I don't actually NEED poller.lua [for testing if the dll loads right?]
| [Sunday 01 May 2011] [23:31:50] <neopallium>	can you check that luaopen_zmq() is a public/exported symbol in the .dll?
| [Sunday 01 May 2011] [23:32:08] <neopallium>	for testing, no, you don't need poller.lua or threads.lua
| [Sunday 01 May 2011] [23:32:59] <neopallium>	this page has instructions on compiling a Lua module on Windows: http://lua-users.org/wiki/BuildingModules
| [Sunday 01 May 2011] [23:33:36] <iFire>	neopallium will depdency walk in windows show me it
| [Sunday 01 May 2011] [23:33:43] <iFire>	dependency walker
| [Sunday 01 May 2011] [23:34:03] <neopallium>	I am not a windows dev., so I am not sure.
| [Sunday 01 May 2011] [23:35:03] <iFire>	int __declspec(dllexport) MyModuleName (lua_State* L) { ... } ?
| [Sunday 01 May 2011] [23:35:08] <iFire>	note : make sure your main init function is exported with __declspec(dllexport) like this :
| [Sunday 01 May 2011] [23:35:09] <iFire>	int __declspec(dllexport) MyModuleName (lua_State* L) { ... }
| [Sunday 01 May 2011] [23:35:53] <iFire>	neopallium is that needeD?
| [Sunday 01 May 2011] [23:36:24] <neopallium>	no, the symbol that needs to be exported for this module is: int luaopen_zmq(lua_State *L);
| [Sunday 01 May 2011] [23:37:51] <neopallium>	in the pre_generated-zmq.nobj.c file you will see it as: LUALIB_API int luaopen_zmq(lua_State *L) {
| [Sunday 01 May 2011] [23:38:07] <neopallium>	very close to the end of the .c file
| [Sunday 01 May 2011] [23:38:12] <iFire>	yes
| [Sunday 01 May 2011] [23:38:33] <iFire>	hmm
| [Sunday 01 May 2011] [23:38:39] <iFire>	somehow add int __declspec(dllexport) <-?
| [Sunday 01 May 2011] [23:39:10] <neopallium>	LUALIB_API will do that on windows.
| [Sunday 01 May 2011] [23:39:46] <iFire>	it doesn't :/
| [Sunday 01 May 2011] [23:40:55] <iFire>	neopallium ok I did  __declspec(dllexport) LUALIB_API int luaopen_zmq(lua_State *L) {
| [Sunday 01 May 2011] [23:40:58] <iFire>	and it seems to work
| [Sunday 01 May 2011] [23:41:11] <iFire>	what's a way of printing the zmq table
| [Sunday 01 May 2011] [23:41:19] <neopallium>	look in your luaconf.h file, that is where LUALIB_API & LUA_API are defined.
| [Sunday 01 May 2011] [23:41:26] <iFire>	using luajit
| [Sunday 01 May 2011] [23:41:56] <neopallium>	for k,v in pairs(zmq) do print(k,v) end
| [Sunday 01 May 2011] [23:43:06] <neopallium>	ah, you need to define LUA_BUILD_AS_DLL on windows when compiling a Lua C module.
| [Sunday 01 May 2011] [23:43:35] <iFire>	http://pastebin.ca/2052715 <- this is a working table print right?
| [Sunday 01 May 2011] [23:43:56] <neopallium>	yup, that looks right.
| [Sunday 01 May 2011] [23:45:46] <iFire>	ha
| [Sunday 01 May 2011] [23:45:52] <iFire>	well using that define makes the build fail
| [Sunday 01 May 2011] [23:46:08] <iFire>	>..\..\..\deps\lua-zmq\src\pre_generated-zmq.nobj.c(3121): error C2491: 'luaopen_zmq' : definition of dllimport function not allowed
| [Sunday 01 May 2011] [23:46:45] <iFire>	neopallium you probably mean LUA_LIB
| [Sunday 01 May 2011] [23:47:20] <iFire>	#if defined(LUA_CORE) || defined(LUA_LIB)
| [Sunday 01 May 2011] [23:47:20] <iFire>	#define LUA_API		__declspec(dllexport)
| [Sunday 01 May 2011] [23:47:20] <iFire>	#else
| [Sunday 01 May 2011] [23:47:20] <iFire>	#define LUA_API		__declspec(dllimport)
| [Sunday 01 May 2011] [23:47:20] <iFire>	#endif
| [Sunday 01 May 2011] [23:47:30] <iFire>	actually both
| [Sunday 01 May 2011] [23:47:35] <neopallium>	hmm, maybe I shouldn't be using LUALIB_API or LUA_API for exporting the module's luaopen_*() function.
| [Sunday 01 May 2011] [23:47:59] <iFire>	http://www.lua.org/source/5.1/luaconf.h.html [search for LUA_LIB]
| [Sunday 01 May 2011] [23:48:10] <neopallium>	I will look for a better solution, but for now just replace LUALIB_API with __declspec(dllexport)
| [Sunday 01 May 2011] [23:48:37] <neopallium>	yeah, I think those defines are more for the Lua core not modules.
| [Sunday 01 May 2011] [23:49:20] <neopallium>	ok, I need to go now, I will be back in about an hour or two.
| [Sunday 01 May 2011] [23:49:51] <neopallium>	but, I will take a closer look at the problem later tonight.
| [Sunday 01 May 2011] [23:50:00] <iFire>	neopallium pm
| [Sunday 01 May 2011] [23:55:21] <iFire>	I added  two defines and it worked "LUA_BUILD_AS_DLL", "LUA_LIB" 
| [Monday 02 May 2011] [02:03:59] <neopallium>	iFire: I committed a fix to lua-zmq that should make it easier to compile on windows.  You don't need to define LUA_BUILD_AS_DLL, LUA_LIB, or LUALIB_API.
| [Monday 02 May 2011] [02:48:31] <staylor>	is there a way to get the connection status of a socket to a given endpoint?
| [Monday 02 May 2011] [02:49:21] <guido_g>	no
| [Monday 02 May 2011] [03:06:58] <jer>	i've got a couple of workers creating push sockets sending some results out to a single node binding a pull socket. communication works fine, as i'd expect. however, after i send a first message off, my workers cpu usage goes up over 30% and none of the workers are processing any jobs, sockets are idle. not sure wtf is going on. anyone have any suggestions on what i might look for first?
| [Monday 02 May 2011] [03:09:03] <staylor>	guido_g so would the best way to know if a connection can be made to open a separate standard connection to the host, but not exchange any data?
| [Monday 02 May 2011] [03:09:43] <guido_g>	you still don't know if the mq endpoint is connected and alive
| [Monday 02 May 2011] [03:09:54] <guido_g>	only mq could tell you that
| [Monday 02 May 2011] [03:10:02] <guido_g>	and it doesn't
| [Monday 02 May 2011] [03:11:16] <staylor>	well ideally it would, but I guess at least a standard socket would tell me that at least that much works.  I'd like to know if a connection is refused basically, as it tells me most likely the other end failed to map a upnp port or the service isn't running.
| [Monday 02 May 2011] [05:43:09] <edwin>	hi, the helloworld zeromq example is not working properly for me with 0MQ 2.1.6 on Debian x86-64, and here's a testcase: https://gist.github.com/951368
| [Monday 02 May 2011] [05:43:09] <edwin>	output from testcase( zmq_send fails with Bad address): https://gist.github.com/951369
| [Monday 02 May 2011] [05:43:43] <edwin>	the server keeps giving those errors, and the client hangs
| [Monday 02 May 2011] [05:43:49] <edwin>	same with hwserver/hwclient
| [Monday 02 May 2011] [05:46:15] <pieterh>	edwin: could you run hwserver & hwclient (not your test case, which is rather more code) and post the messages that gives? thanks
| [Monday 02 May 2011] [05:47:48] <edwin>	https://gist.github.com/951374
| [Monday 02 May 2011] [05:47:55] <edwin>	pieterh: the client hangs after the first send
| [Monday 02 May 2011] [05:48:04] <edwin>	sometimes it receives too, but doesn't do a 2nd send
| [Monday 02 May 2011] [05:48:29] <pieterh>	so it hangs, presumably the server isn't sending a reply?
| [Monday 02 May 2011] [05:48:38] <edwin>	interesting thing is that it worked better yesterday
| [Monday 02 May 2011] [05:48:49] <edwin>	yes the server gives an error on zmq_send
| [Monday 02 May 2011] [05:48:59] <edwin>	see output from my code: https://gist.github.com/951369
| [Monday 02 May 2011] [05:49:04] <edwin>	ZMQ error: Bad address
| [Monday 02 May 2011] [05:49:10] <pieterh>	what does the server say on zmq_send (the hwserver, not yours)
| [Monday 02 May 2011] [05:49:19] <edwin>	let me add a printf hold on
| [Monday 02 May 2011] [05:50:15] <edwin>	hwserver zmq_send failed: Bad address
| [Monday 02 May 2011] [05:50:41] <edwin>	https://gist.github.com/951380
| [Monday 02 May 2011] [05:50:44] <edwin>	that is the change I made
| [Monday 02 May 2011] [05:50:50] <edwin>	to print the error
| [Monday 02 May 2011] [05:51:21] <pieterh>	ok, let me just retest that
| [Monday 02 May 2011] [05:52:36] <pieterh>	it works for me, but that's not helpful...
| [Monday 02 May 2011] [05:52:47] <pieterh>	I'm not sure what 'bad address' means for 0MQ, let me dig a little
| [Monday 02 May 2011] [05:53:54] <pieterh>	EFAULT = invalid memory access, I'd assume
| [Monday 02 May 2011] [05:54:45] <pieterh>	ah, edwin....
| [Monday 02 May 2011] [05:54:46] <edwin>	ah yes version 2.0.x crashes with SIGSEGV with invalid access
| [Monday 02 May 2011] [05:54:55] <pieterh>	can you please take the actual current version of hwserver
| [Monday 02 May 2011] [05:55:05] <pieterh>	I'd posted a version with a bug in it, that's what's hitting you
| [Monday 02 May 2011] [05:55:35] <pieterh>	you can see it's putting "World" into the request, not the reply... :-/
| [Monday 02 May 2011] [05:55:38] <edwin>	yeah that works
| [Monday 02 May 2011] [05:56:13] <edwin>	ok let me fix my latency measurement tool then :)
| [Monday 02 May 2011] [05:56:44] <pieterh>	sorry about that, someone caught it but it was there for a day or two
| [Monday 02 May 2011] [05:57:39] <edwin>	Time: 1.521894s, 6570.759856 Req/s, Latency: 152.189400 us
| [Monday 02 May 2011] [05:57:40] <edwin>	yep works now
| [Monday 02 May 2011] [05:57:42] <edwin>	thanks :)
| [Monday 02 May 2011] [05:58:13] <edwin>	I was going to try and improve the latency by using a pipe instead of socketpair for the mailbox
| [Monday 02 May 2011] [05:58:22] <edwin>	but then the helloworld started failing...
| [Monday 02 May 2011] [06:00:50] <edwin>	(unix socket latency is ~28us, and pipe is 3-4x faster than the socket according to hackbench)
| [Monday 02 May 2011] [06:03:40] <mikko>	good morning
| [Monday 02 May 2011] [06:04:05] <pieterh>	mikko: hi, how're you doing?
| [Monday 02 May 2011] [06:04:19] <mikko>	i am excellent
| [Monday 02 May 2011] [06:04:24] <mikko>	extra bank holiday today
| [Monday 02 May 2011] [06:04:31] <pieterh>	:) yeah
| [Monday 02 May 2011] [06:04:49] <mikko>	very bad time for freelancers
| [Monday 02 May 2011] [06:04:58] <mikko>	:)
| [Monday 02 May 2011] [06:05:00] <mikko>	you?
| [Monday 02 May 2011] [06:06:00] <pieterh>	working on a new android app
| [Monday 02 May 2011] [06:06:02] <pieterh>	quite fun
| [Monday 02 May 2011] [06:07:09] <mikko>	are you using zeromq?
| [Monday 02 May 2011] [06:07:11] <pieterh>	it's fun to see that stuff I was designing in 1999 is still better than web frameworks today
| [Monday 02 May 2011] [06:07:19] <pieterh>	nope, this is a different project
| [Monday 02 May 2011] [06:07:41] <pieterh>	well, the web frameworks are pretty, and easy to use
| [Monday 02 May 2011] [06:08:23] <pieterh>	I'd not use 0MQ across the Internet anyhow
| [Monday 02 May 2011] [06:08:41] <pieterh>	we're making connectivity for this app across RestTL, and we'll use 0MQ in the backend
| [Monday 02 May 2011] [06:15:33] <edwin>	hmm, latency with pipes for mailbox is 43 - 44us (vs 49-50 us with unix socket for mailbox). If I turn on CPU freq scaling then latency is 135 - 150 us
| [Monday 02 May 2011] [06:16:08] <edwin>	however using just a unix socketpair (without zeromq) latency is 10us
| [Monday 02 May 2011] [06:18:05] <edwin>	why is a socket used for zeromq's mailbox, instead of lets say a ypipe and a pthread condition?
| [Monday 02 May 2011] [06:27:14] <sustrik>	edwin: even with ypipe you have to synchronise the two sides of the pipe somehow
| [Monday 02 May 2011] [06:27:37] <sustrik>	but yes, ypipe + using socketpair just for signaling would be superior solution
| [Monday 02 May 2011] [06:27:54] <mikko>	sustrik: did you notice that several compilers fail now with master?
| [Monday 02 May 2011] [06:27:54] <edwin>	not sure if socketpair is faster than a pthread condition for signaling
| [Monday 02 May 2011] [06:28:06] <edwin>	will have to test
| [Monday 02 May 2011] [06:28:18] <mikko>	well, ICC and sun studio
| [Monday 02 May 2011] [06:28:28] <sustrik>	the problem is that the signal has to interrupt a polling loop
| [Monday 02 May 2011] [06:28:39] <sustrik>	you can't do that with condition variable afaik
| [Monday 02 May 2011] [06:29:06] <edwin>	ah because you also use it to poll network sockets
| [Monday 02 May 2011] [06:29:14] <sustrik>	exactly
| [Monday 02 May 2011] [06:29:38] <edwin>	won't a signal() interrupt poll with EINTR?
| [Monday 02 May 2011] [06:30:15] <sustrik>	it's a nightmare to combine signals with threads
| [Monday 02 May 2011] [06:30:50] <edwin>	the signal handler doesn't have to actually do anything, just wake the poller
| [Monday 02 May 2011] [06:31:05] <edwin>	of course there is a problem which signal to use
| [Monday 02 May 2011] [06:31:11] <edwin>	since libzmq is a library..
| [Monday 02 May 2011] [06:31:31] <sustrik>	there's a problem which thread the signal will be delivered to
| [Monday 02 May 2011] [06:32:23] <edwin>	yeah that too, ok bad idea. using pipe to wake poll() sounds fine, we can avoid a recv() on the mailbox
| [Monday 02 May 2011] [06:32:46] <sustrik>	you've just said it's slower
| [Monday 02 May 2011] [06:32:57] <edwin>	its slower than pthread, but pipe is faster than unix sockets
| [Monday 02 May 2011] [06:33:00] <edwin>	(which is used now)
| [Monday 02 May 2011] [06:33:08] <sustrik>	ok, we can do that
| [Monday 02 May 2011] [06:33:21] <sustrik>	if you have a patch, send it to the mailing list
| [Monday 02 May 2011] [06:33:34] <edwin>	sure, I'll be testing some variants
| [Monday 02 May 2011] [06:33:38] <sustrik>	ok
| [Monday 02 May 2011] [06:33:46] <edwin>	patch aganist 2.1.6 is fine?
| [Monday 02 May 2011] [06:33:51] <edwin>	or the 3.0 master?
| [Monday 02 May 2011] [06:33:58] <sustrik>	master is better
| [Monday 02 May 2011] [06:34:10] <sustrik>	but the mailbox code haven't changed iirc
| [Monday 02 May 2011] [06:34:16] <sustrik>	so, it'll be the same anyway
| [Monday 02 May 2011] [06:34:20] <edwin>	ok
| [Monday 02 May 2011] [06:34:41] <sustrik>	btw, if you want to implement ypipe+pipe thing
| [Monday 02 May 2011] [06:34:54] <sustrik>	that would solve one serious problem 0mq is experiencing
| [Monday 02 May 2011] [06:35:13] <sustrik>	namely that the mailbox can overflow in some special cases
| [Monday 02 May 2011] [06:35:39] <sustrik>	ypipe+pipe would solve that as there's no limit on number of items in yqueue
| [Monday 02 May 2011] [06:36:04] <edwin>	won't send() block if mailbox is full?
| [Monday 02 May 2011] [06:36:21] <edwin>	or zeromq spins on send with errno=EAGAIN?
| [Monday 02 May 2011] [06:37:04] <sustrik>	it have blocked originally, but that leads to deadlocks
| [Monday 02 May 2011] [06:37:26] <sustrik>	so now it tries to increase the mailbox size
| [Monday 02 May 2011] [06:37:36] <sustrik>	which doesn't work well on different OSes
| [Monday 02 May 2011] [06:38:14] <sustrik>	btw, note that if pipe is used only for signaling
| [Monday 02 May 2011] [06:38:22] <sustrik>	it can be optimised on some OSes
| [Monday 02 May 2011] [06:38:49] <sustrik>	eg. on Linux we can use eventfd which is much faster than socketpair or pipe
| [Monday 02 May 2011] [06:42:01] <edwin>	eventfd looks cool, I should use that in clamd as well (I use a pipe with 1 byte write for signaling)
| [Monday 02 May 2011] [07:20:51] <th>	sustrik: did you have a look at #199 yet? thats a 3-0 master issue..
| [Monday 02 May 2011] [07:22:34] <sustrik>	th: yes, i've reproduced it this morning
| [Monday 02 May 2011] [07:22:51] <th>	sustrik: thats a great start :)
| [Monday 02 May 2011] [08:22:35] <djc>	guido_g: turned out my test box had something else listening on a port pyzmq was using for testing...
| [Monday 02 May 2011] [09:05:02] <private_meta>	pieterh: eh... remember that I went to zeromq to fix a problem I had with asio? got the same problem now with zeromq
| [Monday 02 May 2011] [09:05:17] <pieterh>	private_meta: lol...
| [Monday 02 May 2011] [09:05:23] <pieterh>	what is happening?
| [Monday 02 May 2011] [09:06:19] <private_meta>	I send normal strings with the messaging library, all is ok, I send (boost)serialized classes, all is ok. Once I send boost serialized classes when the stuff is compiled and used with MPI, some of these messages are garbled beyond recognicion
| [Monday 02 May 2011] [09:06:31] <private_meta>	*recognition
| [Monday 02 May 2011] [09:07:26] <pieterh>	hmm, so it's a problem in your app, not in the transport
| [Monday 02 May 2011] [09:07:29] <private_meta>	Figured that out last night, but not sure if it's really the fault of boost serialization in combination with mpi
| [Monday 02 May 2011] [09:07:36] <private_meta>	well, yes and no
| [Monday 02 May 2011] [09:07:43] <pieterh>	sounds like a memory management issue
| [Monday 02 May 2011] [09:07:44] <private_meta>	the message i send, and the serialize looks ok
| [Monday 02 May 2011] [09:07:52] <private_meta>	but it's broken when it arriveso n the other side
| [Monday 02 May 2011] [09:08:05] <pieterh>	you sure you're not deallocating the memory before the message is really sent?
| [Monday 02 May 2011] [09:08:05] <private_meta>	but only when i compile it with mpi
| [Monday 02 May 2011] [09:08:14] <private_meta>	pretty sure
| [Monday 02 May 2011] [09:08:50] <pieterh>	and of course a minimal test case requires MPI... so I can't really help much... :/
| [Monday 02 May 2011] [09:09:19] <private_meta>	That was one of the problems. It seems the minimal test case is quite complex
| [Monday 02 May 2011] [09:09:43] <private_meta>	Well, I need to write a paper now, but as soon as I'm finished, I'm going back to the matter, in a couple of days I hope
| [Monday 02 May 2011] [09:09:46] <pieterh>	well, try sending the data via a device, log it there and see if it's ok or corrupt
| [Monday 02 May 2011] [09:09:57] <private_meta>	I DID log it
| [Monday 02 May 2011] [09:10:02] <pieterh>	and it was corrupt?
| [Monday 02 May 2011] [09:10:09] <private_meta>	Yes
| [Monday 02 May 2011] [09:10:11] <pieterh>	so the sender is getting it wrong...
| [Monday 02 May 2011] [09:10:23] <pieterh>	and you're logging at the zmq_send() call?
| [Monday 02 May 2011] [09:10:33] <private_meta>	in one case, out of a 300-symbol long string I got a 4-digit number, in another case I got a 2-byte-garbled string
| [Monday 02 May 2011] [09:10:56] <pieterh>	did you log at the zmq_send() call?
| [Monday 02 May 2011] [09:12:09] <private_meta>	I logged at the zmq method I think. I wanted to pry into it deeper, but I'm out of time right now, I'll get to the deepest send part and log there once I'm finished with the matter at hand
| [Monday 02 May 2011] [09:12:21] <pieterh>	ack
| [Monday 02 May 2011] [09:12:38] <pieterh>	I'm not always on IRC so if you get useful output, send to zeromq-dev...
| [Monday 02 May 2011] [09:50:35] <martin_____>	Trying to build 0MQ with python bindings on OS X 10.6 - 0MQ installed into /usr/local/ no problems, building python extension gives me an exception at zmq/core/constants.c:2574: fatal error: error writing to -: Broken pipe
| [Monday 02 May 2011] [09:50:56] <martin_____>	Any ideas?
| [Monday 02 May 2011] [10:00:48] <pieterh>	martin_____: I'd check disk full, permissions on directory you're writing to
| [Monday 02 May 2011] [10:02:44] <martin_____>	pieterh: Definitely not disk full, and I'm running the install as root (it's my own laptop)
| [Monday 02 May 2011] [10:06:20] <martin_____>	here's the compilation command: gcc-4.2 -fno-strict-aliasing -fno-common -dynamic -DNDEBUG -g -fwrapv -Os -Wall -Wstrict-prototypes -DENABLE_DTRACE -arch i386 -arch ppc -arch x86_64 -pipe -I/usr/local/include -Izmq/utils -Izmq/core -Izmq/devices -I/System/Library/Frameworks/Python.framework/Versions/2.6/include/python2.6 -c zmq/core/constants.c -o build/temp.macosx-10.6-universal-2.6/zmq/core/constants.o -Wno-unused-function -Wn
| [Monday 02 May 2011] [11:37:16] <jhawk28>	pieterh: was looking at the specs, does the GPL license for the spec means that any impl of the specs need to be GPL?
| [Monday 02 May 2011] [11:37:32] <pieterh>	jhawk28: nope
| [Monday 02 May 2011] [11:37:40] <pieterh>	since you ask, I'll clarify this in the text
| [Monday 02 May 2011] [11:37:53] <jhawk28>	it just means the spec itself
| [Monday 02 May 2011] [11:38:38] <pieterh>	indeed
| [Monday 02 May 2011] [11:38:59] <jhawk28>	good, I was hoping to use them to create a native Java impl
| [Monday 02 May 2011] [11:39:17] <jhawk28>	in the future
| [Monday 02 May 2011] [11:39:47] <jhawk28>	and I prefer BSD/MIT/Apache 2.0
| [Monday 02 May 2011] [11:41:08] <pieterh>	jhawk28: can you check http://rfc.zeromq.org/spec:13 and tell me if it's clear?
| [Monday 02 May 2011] [11:41:13] <pieterh>	see right hand panel...
| [Monday 02 May 2011] [11:43:05] <jhawk28>	yes, that is clear. wasn't expecting it to be on the right hand panel, but ok
| [Monday 02 May 2011] [11:44:02] <pieterh>	well, that makes it easier to apply to all specs, otherwise I have to edit each one individually
| [Monday 02 May 2011] [11:44:15] <pieterh>	also, it's not really part of the spec but an explanatory note
| [Monday 02 May 2011] [11:46:33] <jhawk28>	yes, thank you for the clarification
| [Monday 02 May 2011] [11:51:06] <pieterh>	jhawk28: I'd be really interested in your experiences making a native implementation
| [Monday 02 May 2011] [11:55:17] <sustrik>	th, pieterh: patch for issue 199 is at the ML
| [Monday 02 May 2011] [11:55:37] <pieterh>	sustrik: great! I'll test that immediately
| [Monday 02 May 2011] [11:58:03] <pieterh>	sustrik: it works, confirmed on 3.0
| [Monday 02 May 2011] [11:58:20] 	 * pieterh loves having test cases in a separate repo...
| [Monday 02 May 2011] [11:58:56] <sustrik>	:)
| [Monday 02 May 2011] [12:30:42] <th>	sustrik: oh really? fantastic!
| [Monday 02 May 2011] [12:36:00] <pieterh>	sustrik: should I try to backport this to 2.1?
| [Monday 02 May 2011] [12:36:34] <sustrik>	pieterh: yes
| [Monday 02 May 2011] [12:36:41] <pieterh>	ok
| [Monday 02 May 2011] [12:38:26] <NikolaVeber>	does anyone else have problems by copy/paste from the guide?
| [Monday 02 May 2011] [12:38:47] <__alex>	erm, yes with the python-snippets
| [Monday 02 May 2011] [12:39:01] <NikolaVeber>	I had the same with php and c...
| [Monday 02 May 2011] [12:39:44] <__alex>	chars like "..." where one thing, but there's more which i couldn't figure out
| [Monday 02 May 2011] [12:39:55] <NikolaVeber>	I guess it's the sodify's fault, or whatever this code formatting thing is calles
| [Monday 02 May 2011] [12:40:07] <NikolaVeber>	codify*
| [Monday 02 May 2011] [12:40:30] <NikolaVeber>	seen it in gedit and eclipse...
| [Monday 02 May 2011] [12:41:46] <__alex>	was strange, took it to vim with utf8 encoding(also the file) and a valid python-encoding header
| [Monday 02 May 2011] [12:41:52] <__alex>	it did boom
| [Monday 02 May 2011] [12:44:52] <th>	sustrik: yea - confirmed again for 3-0
| [Monday 02 May 2011] [12:44:53] <pieterh>	NikolaVeber: copy/paste from the Guide may do strange things...
| [Monday 02 May 2011] [12:45:56] <NikolaVeber>	could be the formatting library for the code...
| [Monday 02 May 2011] [12:46:05] <pieterh>	it should work but a 'smart' editor may trip over the formatting
| [Monday 02 May 2011] [12:46:16] <pieterh>	I'm using Kate and can copy/paste without trouble
| [Monday 02 May 2011] [12:46:23] <pieterh>	do you have a specific example that's failing?
| [Monday 02 May 2011] [12:46:45] <NikolaVeber>	hm, my colleague just went home
| [Monday 02 May 2011] [12:46:56] <NikolaVeber>	it was the php binding code
| [Monday 02 May 2011] [12:47:00] <pieterh>	ok, raise an issue on the guide tracker
| [Monday 02 May 2011] [12:47:02] <NikolaVeber>	req resp example
| [Monday 02 May 2011] [12:47:21] <pieterh>	there are some characters that might need escaping
| [Monday 02 May 2011] [12:47:43] <NikolaVeber>	I'll look at it tomorrow, with exact problem
| [Monday 02 May 2011] [12:47:51] <NikolaVeber>	I had the same in c++
| [Monday 02 May 2011] [12:48:08] <pieterh>	ack
| [Monday 02 May 2011] [12:48:37] <NikolaVeber>	not a big deal, but spoils the fun sometimes :)
| [Monday 02 May 2011] [12:48:57] <pieterh>	well, let me know the specific problem and we'll fix it... "it doesn't work" isn't useful data :)
| [Monday 02 May 2011] [12:49:30] <NikolaVeber>	I know :)
| [Monday 02 May 2011] [12:50:08] <NikolaVeber>	I tracked it last time it failed with c++ examples to stack overflow describing the bug in some code-colouring plugin
| [Monday 02 May 2011] [12:51:20] <NikolaVeber>	ok, I have it
| [Monday 02 May 2011] [12:51:21] <NikolaVeber>	:)
| [Monday 02 May 2011] [12:52:23] <NikolaVeber>	I have copied the first c++ example in gedit
| [Monday 02 May 2011] [12:52:25] <NikolaVeber>	http://pastebin.com/zKhHBnr3
| [Monday 02 May 2011] [12:52:39] <pieterh>	ok, let me try that
| [Monday 02 May 2011] [12:52:49] <pieterh>	which is the 'first c++ example'?
| [Monday 02 May 2011] [12:52:55] <pieterh>	hwserver?
| [Monday 02 May 2011] [12:53:08] <NikolaVeber>	/HelloWorldserverinC++
| [Monday 02 May 2011] [12:53:14] <NikolaVeber>	  //HelloWorldserverinC++
| [Monday 02 May 2011] [12:53:29] <NikolaVeber>	right beneath figure one
| [Monday 02 May 2011] [12:53:35] <pieterh>	I copied/pasted into gedit, it works fine
| [Monday 02 May 2011] [12:54:14] <NikolaVeber>	gives a bunch of crap in my case...
| [Monday 02 May 2011] [12:54:17] <pieterh>	works fine in Kate too
| [Monday 02 May 2011] [12:54:28] <pieterh>	vim shows nothing, I think because of pasteboard confusion
| [Monday 02 May 2011] [12:54:31] <NikolaVeber>	could be the firefox' fault
| [Monday 02 May 2011] [12:54:43] <pieterh>	did you enable the "Paste as crap" option in gedit?
| [Monday 02 May 2011] [12:54:54] <NikolaVeber>	hm, not that I know
| [Monday 02 May 2011] [12:54:58] <pieterh>	it needs to paste as plain text, not HTML
| [Monday 02 May 2011] [12:56:01] <pieterh>	NikolaVeber: perhaps your default language setting affects it
| [Monday 02 May 2011] [12:56:06] <pieterh>	I'm using US English
| [Monday 02 May 2011] [12:56:32] <NikolaVeber>	hm, my UI language is english
| [Monday 02 May 2011] [12:56:49] <pieterh>	hmm, so the error isn't in gedit
| [Monday 02 May 2011] [12:56:54] <pieterh>	it's in gcc when you save the file
| [Monday 02 May 2011] [12:57:17] <NikolaVeber>	whell, if I "clean up" the code
| [Monday 02 May 2011] [12:57:30] <NikolaVeber>	that is, do a bunch of backspace/enter moves
| [Monday 02 May 2011] [12:57:33] <NikolaVeber>	it works
| [Monday 02 May 2011] [12:57:47] <NikolaVeber>	so it has to be some invisible characters
| [Monday 02 May 2011] [12:58:02] <pieterh>	can you save, put the source into a zip, send me that?
| [Monday 02 May 2011] [12:58:21] <NikolaVeber>	shure
| [Monday 02 May 2011] [12:58:42] <pieterh>	ah, I know...
| [Monday 02 May 2011] [12:58:46] <pieterh>	hehe :)
| [Monday 02 May 2011] [12:59:16] <NikolaVeber>	?
| [Monday 02 May 2011] [12:59:26] <NikolaVeber>	are you getting the file?
| [Monday 02 May 2011] [12:59:34] <pieterh>	yeah, but it's not necessary any more
| [Monday 02 May 2011] [12:59:38] <NikolaVeber>	ok :)
| [Monday 02 May 2011] [12:59:52] <pieterh>	I use unicode whitespace characters to force the layout to work
| [Monday 02 May 2011] [13:00:00] <th>	Assertion failed: new_sndbuf > old_sndbuf (mailbox.cpp:183)
| [Monday 02 May 2011] [13:00:05] <th>	whats that?
| [Monday 02 May 2011] [13:00:12] <pieterh>	it was... difficult to get the coloring to work otherwise
| [Monday 02 May 2011] [13:00:18] <NikolaVeber>	hehe, that could be it :)
| [Monday 02 May 2011] [13:00:22] <pieterh>	th: looks like a resource issue
| [Monday 02 May 2011] [13:00:45] <th>	pieterh: after running 199 testcase with 3-0 for a while
| [Monday 02 May 2011] [13:00:47] <pieterh>	th: read http://zero.mq/tips
| [Monday 02 May 2011] [13:00:58] <CIA-75>	libzmq: 03Pieter Hintjens 07master * re78cc47 10/ (3 files): Moved tests off 5555 (conflict with Eclipse) ...
| [Monday 02 May 2011] [13:01:06] <pieterh>	NikolaVeber: there is no way to fix this afaik, but I could be wrong
| [Monday 02 May 2011] [13:01:25] <NikolaVeber>	do you have the sources for all examples somewhere?
| [Monday 02 May 2011] [13:01:30] <pieterh>	NikolaVeber: please log an issue in the tracker, I'll think about it and find a solution
| [Monday 02 May 2011] [13:01:48] <NikolaVeber>	it might be a good idea to have plain-text files linked 
| [Monday 02 May 2011] [13:01:57] <pieterh>	if you click on the "GET THE EXAMPLES" button on the main guide page ...
| [Monday 02 May 2011] [13:02:12] <sustrik>	th: it's socketpair buffers filled up
| [Monday 02 May 2011] [13:02:30] <pieterh>	NikolaVeber: there is also a section at http://zguide.zeromq.org/page:all#Getting-the-Examples
| [Monday 02 May 2011] [13:02:55] <NikolaVeber>	lets see 
| [Monday 02 May 2011] [13:02:56] <NikolaVeber>	:)
| [Monday 02 May 2011] [13:03:49] <th>	sustrik: what resource would that be? vmsize?
| [Monday 02 May 2011] [13:04:14] <th>	sustrik: ahh data segment probably.
| [Monday 02 May 2011] [13:04:36] <th>	ah HWM would probably help
| [Monday 02 May 2011] [13:04:37] <NikolaVeber>	pieterh, maybe linking to sources in the guide? I don't mind getting them all personally, just speculating on the general user experience :)
| [Monday 02 May 2011] [13:05:05] <sustrik>	th: no, it's socketpair buffer size limit
| [Monday 02 May 2011] [13:05:16] <pieterh>	NikolaVeber: the Guide already links to the sources, I'm not sure what you mean
| [Monday 02 May 2011] [13:05:27] <pieterh>	you mean a link in each example to the source code?
| [Monday 02 May 2011] [13:05:28] <sustrik>	th: what OS are you on?
| [Monday 02 May 2011] [13:05:53] <NikolaVeber>	pieterh, I mean links to the plaintext-source
| [Monday 02 May 2011] [13:06:21] <pieterh>	yes, that part I understood but since there are already two such links I am asking what more links you want, and where exactly
| [Monday 02 May 2011] [13:06:25] <NikolaVeber>	but if they are "pimped" with utf8 whitespaces, it's not much of a help
| [Monday 02 May 2011] [13:06:49] <NikolaVeber>	under each example, a link to the appropriate plain-text version
| [Monday 02 May 2011] [13:07:07] <pieterh>	it's better just to make copy/paste work, no?
| [Monday 02 May 2011] [13:07:15] <NikolaVeber>	that would be optimal :)
| [Monday 02 May 2011] [13:07:22] <pieterh>	please enter an issue in the tracker, I'll get to it later
| [Monday 02 May 2011] [13:07:23] <pieterh>	thanks
| [Monday 02 May 2011] [13:07:37] <NikolaVeber>	np, thank you :)
| [Monday 02 May 2011] [13:09:06] <NikolaVeber>	done
| [Monday 02 May 2011] [13:09:32] <th>	sustrik: ubuntu10.04 64bit
| [Monday 02 May 2011] [13:26:21] <CIA-75>	libzmq: 03Martin Sustrik 07master * re5d4cd3 10/ src/dist.cpp : Yet one more fix related to PUB socket and multipart messages ...
| [Monday 02 May 2011] [13:28:50] <CIA-75>	libzmq: 03Martin Sustrik 07master * r6ecec9b 10/ src/xrep.cpp : Current inpipe remains unchaged in XREP when other pipe terminates ...
| [Monday 02 May 2011] [13:38:47] <iFire>	neopallium hmm lthreads uses pthreads which is unix only [windows is lgpl] :/ 
| [Monday 02 May 2011] [13:39:05] <iFire>	I wonder if it's possible to rewrite it using tbb or boost threads
| [Monday 02 May 2011] [13:41:39] <pieterh>	iFire: what's lthreads?
| [Monday 02 May 2011] [13:42:10] <iFire>	https://github.com/Neopallium/lua-llthreads
| [Monday 02 May 2011] [13:42:18] <iFire>	apparently it's a lua pthreads wrapper
| [Monday 02 May 2011] [13:42:45] <pieterh>	I wrote a similar class for czmq, zthreads, which has the win32 code
| [Monday 02 May 2011] [13:42:53] <pieterh>	doesn't wrap all pthreads, just thread creation
| [Monday 02 May 2011] [13:43:03] <iFire>	well I'm seeing how far I can go doing it in lua
| [Monday 02 May 2011] [13:43:34] <iFire>	Using send_msg/recv_msg functions running under LuaJIT2 (git HEAD):
| [Monday 02 May 2011] [13:43:35] <iFire>	mean throughput: 6160911 [msg/s]
| [Monday 02 May 2011] [13:43:35] <iFire>	mean throughput: 1478.619 [Mb/s]
| [Monday 02 May 2011] [13:43:35] <iFire>	C++ code:
| [Monday 02 May 2011] [13:43:35] <iFire>	mean throughput: 6241452 [msg/s]
| [Monday 02 May 2011] [13:43:36] <iFire>	mean throughput: 1497.948 [Mb/s]
| [Monday 02 May 2011] [13:43:47] <iFire>	from the lua-zmq repo
| [Monday 02 May 2011] [13:43:58] <pieterh>	that's pretty nice
| [Monday 02 May 2011] [13:44:39] <iFire>	apparently I have to compile lua sockets if I want to run those benchmarks though
| [Monday 02 May 2011] [13:45:00] <iFire>	that's what I've been trying to do
| [Monday 02 May 2011] [14:02:48] <th>	pieterh: patch works for 2.1 as well. it even applies with a small offset
| [Monday 02 May 2011] [14:03:04] <pieterh>	th: great! I've not had time to test it yet
| [Monday 02 May 2011] [14:03:32] <pieterh>	I'll do this right now
| [Monday 02 May 2011] [14:10:19] <pieterh>	th: ack, confirmed on 2.1
| [Monday 02 May 2011] [14:10:26] <pieterh>	it'll go into 2.1.7
| [Monday 02 May 2011] [14:12:26] <pieterh>	th: if you want to get the 2.1 master, it's at git://github.com/zeromq/zeromq2-1
| [Monday 02 May 2011] [14:41:16] <iFire>	pieterh ok that was weird
| [Monday 02 May 2011] [14:41:26] <iFire>	first windows sucks
| [Monday 02 May 2011] [14:41:34] <iFire>	and luajit has a higher performance than c O.o
| [Monday 02 May 2011] [14:42:00] <pieterh>	performance figures are quite variable, +- 10% afaik
| [Monday 02 May 2011] [14:42:12] <pieterh>	more, depending on your configuration
| [Monday 02 May 2011] [14:42:42] <iFire>	pieterh what throughput do you usually get for windowS?
| [Monday 02 May 2011] [14:42:53] <pieterh>	I don't use Windows, personally
| [Monday 02 May 2011] [14:43:03] <pieterh>	but reports are 50-20% of Linux
| [Monday 02 May 2011] [14:43:18] <iFire>	http://pastebin.ca/2052970
| [Monday 02 May 2011] [14:43:21] <iFire>	this is what I got
| [Monday 02 May 2011] [14:43:34] <iFire>	for some reason c++ is slower than luajit
| [Monday 02 May 2011] [14:44:05] <pieterh>	iFire: without specifying what setup you're on, the figures are pretty meaningless, sorry
| [Monday 02 May 2011] [14:44:12] <iFire>	ok 
| [Monday 02 May 2011] [14:44:32] <iFire>	well I'm trying to figure out what's the difference between windows c++ and lua
| [Monday 02 May 2011] [14:44:33] <pieterh>	also, you need to run the tests quite a few times
| [Monday 02 May 2011] [14:44:36] <iFire>	hmm
| [Monday 02 May 2011] [14:44:44] <pieterh>	and take the average of the N fastest runs
| [Monday 02 May 2011] [14:44:46] <iFire>	it's quite variable?
| [Monday 02 May 2011] [14:44:51] <pieterh>	one run proves very little
| [Monday 02 May 2011] [14:45:12] <pieterh>	well, we *know* that lua can't be faster than the C api it's *calling* :)
| [Monday 02 May 2011] [14:45:18] <pieterh>	so you have at least the variance shown here
| [Monday 02 May 2011] [14:48:57] <sustrik>	throughput is silly metric, it's inherently unstable
| [Monday 02 May 2011] [14:49:58] <iFire>	the question I want to answer is how much of a difference is between lua and c++
| [Monday 02 May 2011] [14:50:25] <sustrik>	check latencies
| [Monday 02 May 2011] [14:50:37] <sustrik>	latency is much better metric
| [Monday 02 May 2011] [14:51:14] <sustrik>	it should be fairly stable and give you an sane idea what the difference between the two is
| [Monday 02 May 2011] [14:59:03] <iFire>	something is wrong on my system
| [Monday 02 May 2011] [15:00:35] <iFire>	http://pastebin.ca/2052978
| [Monday 02 May 2011] [15:01:19] <iFire>	also missed a zero on the inproc. but I'm not comparing that
| [Monday 02 May 2011] [15:03:20] <iFire>	bah
| [Monday 02 May 2011] [15:03:26] <iFire>	I should do this correctly
| [Monday 02 May 2011] [15:03:32] <iFire>	and have multiple tests
| [Monday 02 May 2011] [15:13:28] <sustrik>	latency tests are stable, you'll see similar figures all the time
| [Monday 02 May 2011] [15:13:53] <iFire>	I wonder where the extra 10 us comes from
| [Monday 02 May 2011] [15:14:11] <iFire>	sustrik actually it fluctuates too
| [Monday 02 May 2011] [15:14:18] <iFire>	on a desktop
| [Monday 02 May 2011] [15:14:18] <sustrik>	more than 2-3 us?
| [Monday 02 May 2011] [15:14:59] <sustrik>	well, if there's lot of stuff running on the box, it can blur the results
| [Monday 02 May 2011] [15:16:41] <pieterh>	iFire: if you don't have 4 cores, and a quiet box, any test will be quite flaky
| [Monday 02 May 2011] [15:16:44] <pieterh>	flakey
| [Monday 02 May 2011] [15:16:49] <iFire>	hmm
| [Monday 02 May 2011] [15:17:05] <iFire>	I guess I can try doing the tests on a vps where it's not a desktop
| [Monday 02 May 2011] [15:17:13] <pieterh>	ideal is two boxes connected over a private network
| [Monday 02 May 2011] [15:17:25] <pieterh>	how many cores on your desktop?
| [Monday 02 May 2011] [15:17:30] <iFire>	4
| [Monday 02 May 2011] [15:17:46] <pieterh>	and you're running other software?
| [Monday 02 May 2011] [15:17:51] <iFire>	yes
| [Monday 02 May 2011] [15:18:06] <iFire>	windows says 3-5% CPU use though
| [Monday 02 May 2011] [15:18:12] <pieterh>	you're on Windows?
| [Monday 02 May 2011] [15:18:31] <iFire>	windows is probably a terrible platform
| [Monday 02 May 2011] [15:18:34] <pieterh>	forget it, you're not going to get serious metrics
| [Monday 02 May 2011] [15:19:00] <pieterh>	but if you really must use that, then kill anything you don't absolutely need
| [Monday 02 May 2011] [15:19:19] <pieterh>	and run the tests multiple times, taking average of the 3 lowest runs (run each 10-20 times)
| [Monday 02 May 2011] [15:20:13] <iFire>	well it's not serious but it's just nagging me to see c++  how slower than lua on thr and lat
| [Monday 02 May 2011] [15:20:13] <pieterh>	also, make sure you send/recv enough messages, e.g. 10M or 20M
| [Monday 02 May 2011] [15:20:17] <iFire>	hmm
| [Monday 02 May 2011] [15:20:38] <iFire>	ok I'll try 10 million
| [Monday 02 May 2011] [15:20:54] <sustrik>	don't do that with latency tests, it'll take forever
| [Monday 02 May 2011] [15:21:01] <sustrik>	10 million for throughput
| [Monday 02 May 2011] [15:21:07] <sustrik>	100,000 for latency
| [Monday 02 May 2011] [15:23:37] <sustrik>	the lua being faster is kind of strange
| [Monday 02 May 2011] [15:23:56] <sustrik>	how does it compute the result?
| [Monday 02 May 2011] [15:24:21] <iFire>	https://github.com/Neopallium/lua-zmq/tree/master/perf
| [Monday 02 May 2011] [15:24:35] <iFire>	not sure how faithful are the ports
| [Monday 02 May 2011] [15:25:20] <iFire>	bah
| [Monday 02 May 2011] [15:25:24] <iFire>	that might be why
| [Monday 02 May 2011] [15:26:29] <sustrik>	ah, it uses lua's time function
| [Monday 02 May 2011] [15:26:45] <sustrik>	if you want to have it consistent with C tests
| [Monday 02 May 2011] [15:27:11] <sustrik>	you should use "stopwatch" provided with libzmq (see zmq_utils.h_
| [Monday 02 May 2011] [15:35:45] <iFire>	I guess it doesn't really matter :) it's fast enough. especially if I'm using inproc
| [Monday 02 May 2011] [16:04:11] <zerosanity>	Is it possible to use epgm or pgm on EC2?
| [Monday 02 May 2011] [16:29:11] <jhawk28>	zerosanity: it doesnt look like EC2 supports multicast
| [Monday 02 May 2011] [17:44:35] <dan__>	I have a really basic forwarder question...  I'm using pubsub and when I connect directly, it seems to work just fine.  When I put a forwarder in the middle, I don't get any messages.  I suspect I'm doing something wrong, but can't figure it out.
| [Monday 02 May 2011] [17:46:20] <dan__>	My minimal code looks like: publishers = context.socket(zmq.SUB) publishers.bind("tcp://127.0.0.1:5555"); subscribers = context.socket(zmq.PUB) subscribers.bind('tcp://127.0.0.1:5556')zmq.device(zmq.FORWARDER, publishers, subscribers)
| [Monday 02 May 2011] [18:12:53] <jhawk28>	dan__: are you subscribing to all?
| [Monday 02 May 2011] [18:16:54] <jhawk28>	dan__: you need to call publishers.subscribe("".getBytes, 0);
| [Monday 02 May 2011] [18:19:32] <neopallium>	what version of zeromq was the zmq_stopwatch_*() functions introduced?
| [Monday 02 May 2011] [18:25:06] <jhawk28>	neopallium: https://github.com/zeromq/libzmq/commit/3b636d7d185cd1a1fa300b4d9ca78d2587cb4bf5#diff-1
| [Monday 02 May 2011] [18:25:14] <jhawk28>	thats when it was moved to zmq_utils.cpp
| [Monday 02 May 2011] [18:27:10] <neopallium>	jhawk28: thanks, I am going to add support for those functions to my lua bindings and wanted to make sure it wasn't a new feature.
| [Monday 02 May 2011] [18:28:34] <jhawk28>	I'm seeing them at least back to Aug 7
| [Monday 02 May 2011] [18:28:37] <jhawk28>	2010
| [Monday 02 May 2011] [18:30:36] <jhawk28>	ah, found when it was added: 7f01e9970d211235fc8057de6dc41ba8ceafe795
| [Monday 02 May 2011] [18:30:50] <jhawk28>	Jun 17, 2010
| [Monday 02 May 2011] [18:32:40] <neopallium>	looks like that is zeromq 2.0.7
| [Monday 02 May 2011] [18:33:59] <jhawk28>	based on the comment, it looks like it was removed then added
| [Monday 02 May 2011] [18:34:14] <neopallium>	that is old enough, also those functions are not documented.
| [Monday 02 May 2011] [18:34:14] <jhawk28>	and then moved on Apr 11, 2011
| [Monday 02 May 2011] [18:35:01] <neopallium>	only the source was moved not the header prototypes.
| [Monday 02 May 2011] [18:35:12] <neopallium>	so that is not a problem for bindings.
| [Monday 02 May 2011] [18:36:34] <neopallium>	jhawk28: thanks for helping me track that down.  I didn't think to use git blame to find out the answer.
| [Monday 02 May 2011] [18:38:02] <jhawk28>	np
| [Monday 02 May 2011] [20:06:24] <neopallium>	iFire: lua-zmq now has support for zmq_stopwatch_*() functions and the perf/*.lua benchmarks have been updated to use that instead of socket.gettime().
| [Tuesday 03 May 2011] [01:21:02] <Steve____>	newbie question here - I just downloaded the windows version of zeromq, and opened up the project in visual studio 2008
| [Tuesday 03 May 2011] [01:22:00] <Steve____>	two projects - inproc_lat, and inproc_thr show as unavailable.  were they removed?  or what do i do to get them in place?
| [Tuesday 03 May 2011] [01:22:19] <Steve____>	(so far all I've done is downloaded the zip file from the "Grab the Software" page)
| [Tuesday 03 May 2011] [01:53:44] <iFire>	bah
| [Tuesday 03 May 2011] [02:52:29] Notice	-ChanServ- [#qt-labs] Welcome to the Qt developers public hideout. Qt Development Frameworks personnel will have Voice status, so they should be easy to pinpoint in the crowd. Please do not paste large blocks of code in the channel, but rather use a pastebin site.
| [Tuesday 03 May 2011] [03:59:56] <kryptom>	hi there, i'm using zeromq 2.1.6 and trying out the ruby samples (hwclient and hwserver). In the zguide it says you can start the client (REQ), then start the server or restart the server (REP) with a running client. But when I try the samples "hang", is this normal behaviour?
| [Tuesday 03 May 2011] [04:06:56] <pieterh>	kryptom: it should work
| [Tuesday 03 May 2011] [04:25:44] <kryptom>	sorry, got distracted
| [Tuesday 03 May 2011] [04:26:05] <kryptom>	i would agree it should work ...
| [Tuesday 03 May 2011] [04:28:15] <kryptom>	so, I start the client, start the server, then quit the server and start the server again - then the client hangs
| [Tuesday 03 May 2011] [04:32:58] <sustrik>	the request may be lost
| [Tuesday 03 May 2011] [04:33:10] <sustrik>	if it was processed by the server when it was shut down
| [Tuesday 03 May 2011] [04:35:05] <kryptom>	checking the examples again ...
| [Tuesday 03 May 2011] [05:19:33] <steve_k>	I'm having a problem.  I'm trying to test HelloWorld cross/platform cross/language.  I have the HelloWorldServer built in Java on Fedora 14, and two clients on Windows XP - One Java and One Python.
| [Tuesday 03 May 2011] [05:20:08] <steve_k>	The Java client talks to the Java server just fine, but if I run the Python Client, the Java Server crashes with: Assertion failed: (msg_->flags | ZMQ_MSG_MASK) == 0xff (zmq.cpp:223)
| [Tuesday 03 May 2011] [05:20:57] <Guthur>	steve_k: are you setting idenitities
| [Tuesday 03 May 2011] [05:21:12] <Guthur>	identities*
| [Tuesday 03 May 2011] [05:32:42] <sustrik>	steve_k: looks like you (or java binding) are using invalid zmq_msg_t
| [Tuesday 03 May 2011] [05:33:21] <sustrik>	can you produce a minimal test case and fill a bug for jzmq project
| [Tuesday 03 May 2011] [05:33:24] <sustrik>	?
| [Tuesday 03 May 2011] [05:39:16] <steve_k>	sorry - got disconnected.
| [Tuesday 03 May 2011] [05:39:54] <steve_k>	where should I submit the bug?
| [Tuesday 03 May 2011] [05:40:07] <steve_k>	the jzmq git repository?
| [Tuesday 03 May 2011] [05:48:07] <djc>	2.0 and 2.1 should be over-the-network compatible, right?
| [Tuesday 03 May 2011] [05:48:51] <guido_g>	yes
| [Tuesday 03 May 2011] [05:52:03] <djc>	k, thanks
| [Tuesday 03 May 2011] [05:52:24] <djc>	are there any good docs on the compatibility of major, minor and micro releases?
| [Tuesday 03 May 2011] [05:52:42] <djc>	in terms of API, ABI and network framing
| [Tuesday 03 May 2011] [06:00:47] <pieterh>	djc: http://www.zeromq.org/docs:policies
| [Tuesday 03 May 2011] [06:01:12] <steve_k2>	hmph... I went about building a test case and I ran the same script from linux instead of windows and it worked fine.
| [Tuesday 03 May 2011] [06:01:32] <pieterh>	but it's not complete, e.g. I'd like a policy on backwards compatibility of wire level protocols
| [Tuesday 03 May 2011] [06:02:05] <steve_k2>	I'm going to try it from an external machine to see if that makes a difference. Otherwise, it must be a problem with my windows install of the python module.
| [Tuesday 03 May 2011] [06:04:01] <steve_k2>	still - it's a bit scary that a client can crash the server so easily.
| [Tuesday 03 May 2011] [06:06:01] <guido_g>	trade-off between speed and angst
| [Tuesday 03 May 2011] [06:11:14] <Soleo>	Hi, does anyone know about something about Queue Device? Should I add lock for each thread queued ?
| [Tuesday 03 May 2011] [06:11:56] <sustrik>	steve_k2: https://github.com/zeromq/jzmq/issues
| [Tuesday 03 May 2011] [06:12:26] <sustrik>	Soleo: no
| [Tuesday 03 May 2011] [06:14:29] <Soleo>	what if I am writing the same file in each thread?
| [Tuesday 03 May 2011] [06:21:54] <Guthur>	that issue is really orthogonal to the queue device
| [Tuesday 03 May 2011] [06:24:04] <Guthur>	possibly you want something like this: <fan out> Process stuff <fan in> write file
| [Tuesday 03 May 2011] [06:38:08] <djc>	pieterh: can you add something there about network protocol/framing compat?
| [Tuesday 03 May 2011] [06:39:15] <pieterh>	djc: what would you like me to add?
| [Tuesday 03 May 2011] [06:39:36] <djc>	ah, nm, read your statement about protocol
| [Tuesday 03 May 2011] [06:39:48] <djc>	if there is no policy, would be hard to describe it
| [Tuesday 03 May 2011] [06:40:33] <djc>	if the network protocol doesn't change that often, perhaps it would suffice to have an exhaustive list of actual versions that changed it
| [Tuesday 03 May 2011] [06:40:55] <pieterh>	you mean for the future?
| [Tuesday 03 May 2011] [06:41:03] <pieterh>	the protocol will definitely change for 3.x
| [Tuesday 03 May 2011] [06:41:07] <djc>	yeah, or even for the current versions
| [Tuesday 03 May 2011] [06:41:17] <pieterh>	there's only one current stable version, 2.1.x
| [Tuesday 03 May 2011] [06:41:21] <djc>	i.e. 2.0 and 2.1, which I bet a lot of people with production stuff will be upgrading soon
| [Tuesday 03 May 2011] [06:41:46] <pieterh>	all 2.x versions use the same protocol
| [Tuesday 03 May 2011] [06:41:49] <djc>	and I've also noticed a 2.2 repo, not sure what that's about? all the talk seems to be about 3.x
| [Tuesday 03 May 2011] [06:42:01] <djc>	okay, well, that would be useful info for that wiki page
| [Tuesday 03 May 2011] [06:42:16] <pieterh>	well, 2.2 is for ongoing evolution of the 2.1 packaging
| [Tuesday 03 May 2011] [06:42:33] <djc>	what do you mean by "packaging" exactly?
| [Tuesday 03 May 2011] [06:42:47] <pieterh>	well, 2.2 is for two things
| [Tuesday 03 May 2011] [06:43:02] <pieterh>	a. new functionality that can't go into 2.1 because that's for bug fixes only
| [Tuesday 03 May 2011] [06:43:14] <pieterh>	b. new functionality packaged with libzmq, e.g. czmq
| [Tuesday 03 May 2011] [06:43:35] <djc>	so what's the difference between 2.2 and 3.x?
| [Tuesday 03 May 2011] [06:43:49] <pieterh>	3.x breaks the API and wire protocol totally...
| [Tuesday 03 May 2011] [06:44:06] <pieterh>	whereas 2.2 is ... hey, this is explained by the wiki page :)
| [Tuesday 03 May 2011] [06:44:29] <pieterh>	2.2 is meant to be a *compatible* evolution of 2.1
| [Tuesday 03 May 2011] [06:44:38] <pieterh>	whereas 3.0 is incompatible in several major ways
| [Tuesday 03 May 2011] [06:45:10] <pieterh>	I'm not 100% sure we'll need the 2.2 branch but it's there and I maintain it
| [Tuesday 03 May 2011] [06:45:18] <djc>	okay, sounds good
| [Tuesday 03 May 2011] [06:45:30] <djc>	yeah, I guess the wiki page is actually quite comprehensive
| [Tuesday 03 May 2011] [06:46:02] <pieterh>	there needs to be a page describing present/future versions, maybe I'll add that as a section to this page...
| [Tuesday 03 May 2011] [06:53:57] <pieterh>	djc: OK, I've summarized the current release situation on that wiki page
| [Tuesday 03 May 2011] [06:54:06] <pieterh>	will you review that and let me know if it's ok?
| [Tuesday 03 May 2011] [06:55:16] <djc>	it seems mostly fine
| [Tuesday 03 May 2011] [06:56:04] <djc>	it might be useful to bring up ZMTP sooner
| [Tuesday 03 May 2011] [06:56:18] <djc>	since it seems to provide useful vocabulary
| [Tuesday 03 May 2011] [06:56:20] <pieterh>	Indeed... hang on...
| [Tuesday 03 May 2011] [06:58:02] <pieterh>	done
| [Tuesday 03 May 2011] [07:00:02] <djc>	better, thanks
| [Tuesday 03 May 2011] [07:04:19] <pieterh>	thanks to you... this is good stuff
| [Tuesday 03 May 2011] [07:47:19] <pieterh>	https://github.com/zeromq/libzmq/issues/209
| [Tuesday 03 May 2011] [08:32:50] <sustrik>	pieterh: fix to blast:
| [Tuesday 03 May 2011] [08:33:01] <pieterh>	ja?
| [Tuesday 03 May 2011] [08:33:03] <sustrik>	line 56 should be: int rc = connect (handle, (struct sockaddr*) &sin, sizeof (sin));
| [Tuesday 03 May 2011] [08:33:52] <pieterh>	ok, done and pushed
| [Tuesday 03 May 2011] [08:47:19] <sustrik>	pieterh: the problem doesn't seem to happen with 3.0
| [Tuesday 03 May 2011] [08:47:53] <pieterh>	sustrik: interesting, does it run for 1M iterations?
| [Tuesday 03 May 2011] [08:48:10] <sustrik>	dunno
| [Tuesday 03 May 2011] [08:48:18] <sustrik>	the server just keeps printing
| [Tuesday 03 May 2011] [08:48:30] <sustrik>	"Received Hello"
| [Tuesday 03 May 2011] [08:48:39] <pieterh>	lol
| [Tuesday 03 May 2011] [08:48:47] <pieterh>	well, that's a good sign
| [Tuesday 03 May 2011] [08:48:59] <pieterh>	the blast program sends 1GB of random data
| [Tuesday 03 May 2011] [08:49:05] <sustrik>	heh
| [Tuesday 03 May 2011] [08:49:12] <sustrik>	the blast seems to fail:
| [Tuesday 03 May 2011] [08:49:13] <sustrik>	sustrik@istvan:~/libzmq/src$ ./blast 
| [Tuesday 03 May 2011] [08:49:13] <sustrik>	Test failed at count 47
| [Tuesday 03 May 2011] [08:54:15] <djc>	I just upgraded a C++ server thingy from 2.0 to 2.1
| [Tuesday 03 May 2011] [08:54:18] <djc>	and now it keeps asserting
| [Tuesday 03 May 2011] [08:54:42] <sustrik>	pieterh: ok, the blast failure is expected
| [Tuesday 03 May 2011] [08:54:42] <djc>	from zmq.cpp:223
| [Tuesday 03 May 2011] [08:54:53] <sustrik>	it's "connection refused by peer"
| [Tuesday 03 May 2011] [08:55:11] <sustrik>	djc: yes, that's what we are talking about now
| [Tuesday 03 May 2011] [08:55:38] <sustrik>	djc: any chance to get a minimal test case?
| [Tuesday 03 May 2011] [08:56:16] <djc>	doesn't seem to be a whole lot I need to do
| [Tuesday 03 May 2011] [08:57:05] <sustrik>	what do you do?
| [Tuesday 03 May 2011] [08:57:33] <djc>	hmm, there might be threads involved
| [Tuesday 03 May 2011] [08:58:06] <sustrik>	ok, forget about it them
| [Tuesday 03 May 2011] [08:58:08] <sustrik>	then
| [Tuesday 03 May 2011] [08:58:26] <djc>	well, not sure, this should all happen on the main thread
| [Tuesday 03 May 2011] [08:58:29] <djc>	but the output is weird
| [Tuesday 03 May 2011] [08:58:30] <sustrik>	the blast client pieter wrote just now is allegedly reporting the same error
| [Tuesday 03 May 2011] [08:58:32] <djc>	http://paste.pocoo.org/show/382144/
| [Tuesday 03 May 2011] [08:59:50] <sustrik>	djc: does that happen when the peer starts sending messages?
| [Tuesday 03 May 2011] [08:59:54] <sustrik>	or even before that?
| [Tuesday 03 May 2011] [09:00:14] <djc>	the req/rep doesn't have a peer at this point
| [Tuesday 03 May 2011] [09:00:21] <djc>	I'm testing with the PUB now
| [Tuesday 03 May 2011] [09:00:42] <sustrik>	so the PUB fails even before there's a SUB connected?
| [Tuesday 03 May 2011] [09:01:04] <djc>	oh yeah, there's no SUB or REQ involved here
| [Tuesday 03 May 2011] [09:01:20] <sustrik>	ok
| [Tuesday 03 May 2011] [09:03:52] <djc>	sustrik: here's something more elaborate:
| [Tuesday 03 May 2011] [09:03:53] <djc>	http://paste.pocoo.org/show/382147/
| [Tuesday 03 May 2011] [09:04:25] <djc>	where nothing should be coming in on this->side, and nothing's listening on this->pub
| [Tuesday 03 May 2011] [09:04:32] <djc>	(no one is connected to this->side, even)
| [Tuesday 03 May 2011] [09:04:55] <djc>	mmm
| [Tuesday 03 May 2011] [09:05:23] <sustrik>	djc: let it be for now
| [Tuesday 03 May 2011] [09:05:30] <sustrik>	we have to sort this out with pieterh
| [Tuesday 03 May 2011] [09:05:30] <djc>	that's wrong, it only fails if something is connected to this->side, but not sending requests
| [Tuesday 03 May 2011] [09:05:43] <sustrik>	probably a problem with backporting
| [Tuesday 03 May 2011] [09:06:47] <djc>	it looks like it somehow tries to process a connection event on the REP socket as a message
| [Tuesday 03 May 2011] [09:12:42] <djc>	ah, more info: it triggers when I try to connect using 2.0.9, but works correctly when trying to connect using 2.1.6
| [Tuesday 03 May 2011] [09:15:27] <sustrik>	yeah, the relevant code was added to 2.0.6
| [Tuesday 03 May 2011] [09:15:39] <sustrik>	2.1.6 i mean
| [Tuesday 03 May 2011] [09:16:05] <djc>	you mean, the assert?
| [Tuesday 03 May 2011] [09:16:39] <sustrik>	yes
| [Tuesday 03 May 2011] [09:16:47] <sustrik>	checking for validity of zmq_msg_t objects
| [Tuesday 03 May 2011] [09:19:25] <djc>	so is the check too tight or should that function not be getting that message?
| [Tuesday 03 May 2011] [09:21:34] <sustrik>	several possibilities
| [Tuesday 03 May 2011] [09:21:57] 	 * sustrik is investigating
| [Tuesday 03 May 2011] [09:34:00] <sustrik>	djc: still there?
| [Tuesday 03 May 2011] [09:34:07] <djc>	yup
| [Tuesday 03 May 2011] [09:34:21] <sustrik>	can you try a patch for me?
| [Tuesday 03 May 2011] [09:34:29] <djc>	sure
| [Tuesday 03 May 2011] [09:34:38] <sustrik>	open src/decoder.cpp
| [Tuesday 03 May 2011] [09:34:47] <sustrik>	line 112
| [Tuesday 03 May 2011] [09:34:54] <sustrik>	replace it by this:
| [Tuesday 03 May 2011] [09:34:55] <sustrik>	in_progress.flags = tmpbuf [0] | ~ZMQ_MSG_MASK;
| [Tuesday 03 May 2011] [09:35:04] <sustrik>	and try whether it helps
| [Tuesday 03 May 2011] [09:36:03] <djc>	okay, give me a moment
| [Tuesday 03 May 2011] [09:38:03] <pieterh>	sustrik: re, was out
| [Tuesday 03 May 2011] [09:38:35] <sustrik>	see the above fix
| [Tuesday 03 May 2011] [09:38:38] <sustrik>	it should help
| [Tuesday 03 May 2011] [09:38:44] <sustrik>	doesn't apply to 3.0 though
| [Tuesday 03 May 2011] [09:39:00] <sustrik>	the code there have already changed
| [Tuesday 03 May 2011] [09:39:00] <djc>	sustrik: seems to work just fine
| [Tuesday 03 May 2011] [09:39:04] <sustrik>	ok
| [Tuesday 03 May 2011] [09:39:12] <djc>	at least I can't reproduce as before
| [Tuesday 03 May 2011] [09:39:20] <sustrik>	pieterh: can you apply the fix?
| [Tuesday 03 May 2011] [09:39:21] <pieterh>	sustrik: should I try that patch wrt blast too?
| [Tuesday 03 May 2011] [09:39:26] <pieterh>	:) ok
| [Tuesday 03 May 2011] [09:39:44] <sustrik>	blast is ok
| [Tuesday 03 May 2011] [09:39:54] <sustrik>	ah
| [Tuesday 03 May 2011] [09:39:57] <sustrik>	i did
| [Tuesday 03 May 2011] [09:40:01] <sustrik>	it fails elsewhere
| [Tuesday 03 May 2011] [09:41:35] <pieterh>	sustrik: it's going to fail in lots of places before it's fully robust :)
| [Tuesday 03 May 2011] [09:41:36] <pieterh>	Assertion failed: msg_->flags & ZMQ_MSG_MORE (rep.cpp:81)
| [Tuesday 03 May 2011] [09:41:56] <pieterh>	I've created a branch, we can fix these one by one
| [Tuesday 03 May 2011] [09:48:28] <sustrik>	yup, same in 3.0
| [Tuesday 03 May 2011] [09:48:37] <sustrik>	not that easy to fix though
| [Tuesday 03 May 2011] [09:53:42] <pieterh>	do you think we can fix these in 2.1?
| [Tuesday 03 May 2011] [09:54:06] <pieterh>	it's mostly to be on malformed messages, of course
| [Tuesday 03 May 2011] [09:54:55] <pieterh>	actually I need to make a test case with all socket types
| [Tuesday 03 May 2011] [10:00:14] <sustrik>	malformed frames can be solved easily
| [Tuesday 03 May 2011] [10:00:39] <sustrik>	malformed messages as such is a problem
| [Tuesday 03 May 2011] [10:01:06] <sustrik>	as the I/O thread currently has no idea of what socket type it is handling
| [Tuesday 03 May 2011] [10:01:22] <sustrik>	and thus can't check the validity of socket-type-specific protocol
| [Tuesday 03 May 2011] [10:03:08] <pieterh>	indeed
| [Tuesday 03 May 2011] [10:03:18] <pieterh>	however it shouldn't assert when it gets confused...
| [Tuesday 03 May 2011] [10:04:24] <pieterh>	So I've replaced line 81 in rep.cpp:             zmq_assert (msg_->flags & ZMQ_MSG_MORE);
| [Tuesday 03 May 2011] [10:04:30] <pieterh>	with 
| [Tuesday 03 May 2011] [10:04:30] <pieterh>	            if (!msg_->flags & ZMQ_MSG_MORE) {
| [Tuesday 03 May 2011] [10:04:30] <pieterh>	                errno = EFAULT;
| [Tuesday 03 May 2011] [10:04:31] <pieterh>	                return -1;
| [Tuesday 03 May 2011] [10:04:31] <pieterh>	            }
| [Tuesday 03 May 2011] [10:04:35] <pieterh>	and it no longer asserts
| [Tuesday 03 May 2011] [10:04:44] <pieterh>	at least on a rep socket test
| [Tuesday 03 May 2011] [10:05:20] <pieterh>	eventually runs out of resources: Assertion failed: new_sndbuf > old_sndbuf (mailbox.cpp:183)
| [Tuesday 03 May 2011] [10:21:00] <sustrik>	hm, that's hiding on a problem
| [Tuesday 03 May 2011] [10:21:03] <sustrik>	of*
| [Tuesday 03 May 2011] [10:21:17] <pieterh>	you mean returning -1?
| [Tuesday 03 May 2011] [10:21:21] <sustrik>	yes
| [Tuesday 03 May 2011] [10:21:34] <sustrik>	it won't assert but it'll leave state machine in an inconsistent state
| [Tuesday 03 May 2011] [10:22:35] <pieterh>	hmm, let me check if that's the case...
| [Tuesday 03 May 2011] [10:24:13] <pieterh>	it appears the FSM remains in a consistent state
| [Tuesday 03 May 2011] [10:25:39] <sustrik>	there's a lot of state there
| [Tuesday 03 May 2011] [10:25:52] <sustrik>	the current pipe
| [Tuesday 03 May 2011] [10:26:05] <sustrik>	the "more" flag
| [Tuesday 03 May 2011] [10:26:08] <pieterh>	what is weird is that it no longer asserts but I don't get an error rc either
| [Tuesday 03 May 2011] [10:26:09] <sustrik>	and so on
| [Tuesday 03 May 2011] [10:26:21] <sustrik>	strange
| [Tuesday 03 May 2011] [10:26:59] <pieterh>	could be my test is wrong, let me add some brackets
| [Tuesday 03 May 2011] [10:27:15] <pieterh>	ah, better
| [Tuesday 03 May 2011] [10:29:10] <pieterh>	Ok, so I'm getting the error return properly
| [Tuesday 03 May 2011] [10:29:18] <pieterh>	it does not get into FSM confusion
| [Tuesday 03 May 2011] [10:29:47] <pieterh>	but I'd need a more sophisticated test case to know if it recovers properly
| [Tuesday 03 May 2011] [10:30:05] <pieterh>	also what it should do is close the socket when it gets garbage, not continue reading off it
| [Tuesday 03 May 2011] [10:30:17] <sustrik>	that's the point
| [Tuesday 03 May 2011] [10:35:58] <Guthur>	<pieterh> could be my test is wrong, let me add some brackets ... Does this work for all testing
| [Tuesday 03 May 2011] [10:36:38] <pieterh>	Guthur: the code had to be "if (!(msg_->flags & ZMQ_MSG_MORE)) {"
| [Tuesday 03 May 2011] [10:36:40] <Guthur>	though as a lisper I would always say there is never enough parenthesis
| [Tuesday 03 May 2011] [10:37:21] <Guthur>	...and that's not even Lisp, hehe
| [Tuesday 03 May 2011] [10:44:38] <djc>	so, if I have a connected REQ socket, and the REP server restarts
| [Tuesday 03 May 2011] [10:44:51] <djc>	it looks like the REQ will reconnect and send new messages fine
| [Tuesday 03 May 2011] [10:45:04] <djc>	but the response from the REP doesn't make it to the client
| [Tuesday 03 May 2011] [10:45:09] <djc>	does that make sense?
| [Tuesday 03 May 2011] [10:50:49] <sustrik>	not really
| [Tuesday 03 May 2011] [10:50:59] <sustrik>	do you have a test case?
| [Tuesday 03 May 2011] [10:51:24] <djc>	I saw it a few times, doesn't seem to be very reproducible
| [Tuesday 03 May 2011] [10:51:57] <sustrik>	what can happen is that the server is killed while it processes the request
| [Tuesday 03 May 2011] [10:52:02] <sustrik>	in such case the request is lost
| [Tuesday 03 May 2011] [10:52:38] <djc>	no, that's not the case here
| [Tuesday 03 May 2011] [10:54:14] <sustrik>	the strange thing about it is that from server's PoV, the reconnect is simply a new client
| [Tuesday 03 May 2011] [10:54:21] <sustrik>	so it should behave in standard way
| [Tuesday 03 May 2011] [10:54:34] <djc>	yeah
| [Tuesday 03 May 2011] [10:58:15] <pieterh>	djc: are you using explicit identities?
| [Tuesday 03 May 2011] [10:58:28] <djc>	pieterh: nope
| [Tuesday 03 May 2011] [10:58:35] <pieterh>	ok
| [Tuesday 03 May 2011] [10:59:23] <pieterh>	djc: is it possible you're not checking the return code from zmq_recv or zmq_send?
| [Tuesday 03 May 2011] [10:59:52] <djc>	I was checking it
| [Tuesday 03 May 2011] [11:00:05] <djc>	but actually it seemed like the zmq_send() on the server was blocking
| [Tuesday 03 May 2011] [11:01:56] <pieterh>	djc: I guess the point is without a concrete test case it's practically impossible to investigate
| [Tuesday 03 May 2011] [11:02:03] <djc>	yeah
| [Tuesday 03 May 2011] [11:22:43] <djc>	will that assert fix (with the msg decoder) appear in a release soon?
| [Tuesday 03 May 2011] [11:22:54] <djc>	or would it be valuable to put the patch in our distribution
| [Tuesday 03 May 2011] [11:23:43] <sustrik>	that's up to pieterh
| [Tuesday 03 May 2011] [11:24:02] <pieterh>	djc: that fix will go into 2.1.7, yes
| [Tuesday 03 May 2011] [11:24:43] <pieterh>	sustrik: do we have an issue number for that decoder fix?
| [Tuesday 03 May 2011] [11:24:55] <djc>	pieterh: do you have an intended ETA for that? sorry to be nagging all the time, I'm trying to use zmq-2.1 in our production setup but if there's issues it's kind of scary
| [Tuesday 03 May 2011] [11:25:04] <sustrik>	nope
| [Tuesday 03 May 2011] [11:25:14] <sustrik>	it's bug on 2-1
| [Tuesday 03 May 2011] [11:25:23] <pieterh>	sustrik:  no open issues for it?
| [Tuesday 03 May 2011] [11:25:28] <djc>	btw, I just tried to start working with ZMQ_FD, which is what I was actually upgrading for, but so far I haven't gotten it to work
| [Tuesday 03 May 2011] [11:25:38] <sustrik>	it doesn't exist in libzmq
| [Tuesday 03 May 2011] [11:25:56] <sustrik>	so, i guess, the issue should be in zeromq2-1 repo
| [Tuesday 03 May 2011] [11:26:16] <sustrik>	djc: what's the problem?
| [Tuesday 03 May 2011] [11:26:31] <djc>	poll doesn't seem to fire
| [Tuesday 03 May 2011] [11:26:31] <pieterh>	sustrik: well, the libzmq repo has all the issues ever reported...
| [Tuesday 03 May 2011] [11:27:09] <sustrik>	djc: ibeware! it's edge-triggered
| [Tuesday 03 May 2011] [11:27:22] <sustrik>	pieterh: well, why not use issue 209 then?
| [Tuesday 03 May 2011] [11:27:23] <pieterh>	I see issue 206
| [Tuesday 03 May 2011] [11:28:07] <djc>	sustrik: right, I read that in the docs
| [Tuesday 03 May 2011] [11:28:14] <djc>	does that mean it will only work with epoll, or something?
| [Tuesday 03 May 2011] [11:28:20] <sustrik>	yes, 206 seems to be the same thing
| [Tuesday 03 May 2011] [11:28:25] <pieterh>	sustrik: can you verify whether that 1-line fix actually solves 206?
| [Tuesday 03 May 2011] [11:28:37] <pieterh>	that does not look like futzing, but a real bug in zmq
| [Tuesday 03 May 2011] [11:28:54] <pieterh>	no test case, so I mean "verify" as in "give an opinion"
| [Tuesday 03 May 2011] [11:29:03] <sustrik>	nope, there's no test case in 206
| [Tuesday 03 May 2011] [11:29:10] <sustrik>	ah
| [Tuesday 03 May 2011] [11:29:18] <sustrik>	i gues it's related
| [Tuesday 03 May 2011] [11:29:22] <pieterh>	OK, I'll push the fix to 2.1 master and people can test it from github
| [Tuesday 03 May 2011] [11:29:39] <sustrik>	djc: it means it fires only on state change
| [Tuesday 03 May 2011] [11:30:08] <sustrik>	have a look at epoll docs for explanation of edge-triggering
| [Tuesday 03 May 2011] [11:31:41] <djc>	sustrik: well, for me it doesn't even trigger the first time I send something to it
| [Tuesday 03 May 2011] [11:32:16] <sustrik>	presumably there was no state change
| [Tuesday 03 May 2011] [11:32:33] <joelr>	folks, what os specifies pathnames like this?
| [Tuesday 03 May 2011] [11:32:34] <sustrik>	what you should do is:
| [Tuesday 03 May 2011] [11:32:34] <joelr>	rc = zmq_bind(socket, "ipc:\/\@@//@@tmp/feeds/0"); assert (rc == 0);
| [Tuesday 03 May 2011] [11:32:40] <djc>	pieterh: I had a real issue with 2.0.9 client (REQ) connecting to 2.1.6 server (REP), which was fixed by sustrik's patch
| [Tuesday 03 May 2011] [11:32:49] <pieterh>	djc: you can help push the 2.1.7 release by testing the fix for 206, see my last comment on https://github.com/zeromq/libzmq/issues/206
| [Tuesday 03 May 2011] [11:33:01] <joelr>	this is for /* Assign the pathname "/tmp/feeds/0" */
| [Tuesday 03 May 2011] [11:33:08] <sustrik>	1. check ZMQ_EVENTS
| [Tuesday 03 May 2011] [11:33:10] <pieterh>	djc: ... hmm, can you confirm that's the same as 206 (we assume it is)
| [Tuesday 03 May 2011] [11:33:20] <sustrik>	2. if POLLIN is set read the message
| [Tuesday 03 May 2011] [11:33:35] <sustrik>	3. if it's not, poll on ZMQ_FD
| [Tuesday 03 May 2011] [11:33:44] <pieterh>	joelr: don't copy/paste code from the Guide
| [Tuesday 03 May 2011] [11:33:47] <pieterh>	it'll come out weird
| [Tuesday 03 May 2011] [11:33:48] <sustrik>	4. when ZMQ_FD triggers goto 1
| [Tuesday 03 May 2011] [11:33:55] <pieterh>	please grab the github sources and use that
| [Tuesday 03 May 2011] [11:34:11] <joelr>	pieterh: that's what's in the guide, take a look http://api.zeromq.org/2-1:zmq-ipc
| [Tuesday 03 May 2011] [11:34:31] <djc>	sustrik: can I start at 3 if I assure no one is connected to it at start time?
| [Tuesday 03 May 2011] [11:34:32] <pieterh>	joelr: this is a bug in the formatting
| [Tuesday 03 May 2011] [11:34:56] <joelr>	pieterh: what's the correct format then?
| [Tuesday 03 May 2011] [11:35:15] <sustrik>	joelr: a valid path + filename
| [Tuesday 03 May 2011] [11:35:30] <sustrik>	djc: no
| [Tuesday 03 May 2011] [11:35:36] <pieterh>	I've patched it manually now
| [Tuesday 03 May 2011] [11:35:45] <pieterh>	ipc:// followed by path name, so ipc:///tmp/etc
| [Tuesday 03 May 2011] [11:35:58] <joelr>	pieterh: thanks
| [Tuesday 03 May 2011] [11:36:21] <pieterh>	joelr: I'll fix the API doc generation tool, this is a bug... sorry about that
| [Tuesday 03 May 2011] [11:36:31] <joelr>	np
| [Tuesday 03 May 2011] [11:41:03] <djc>	sustrik: still doesn't work
| [Tuesday 03 May 2011] [11:41:29] <sustrik>	what happens?
| [Tuesday 03 May 2011] [11:41:52] <djc>	there's no POLLIN on the ZMQ_EVENTS before the poll()
| [Tuesday 03 May 2011] [11:42:03] <djc>	and poll() doesn't fire on the ZMQ_FD after
| [Tuesday 03 May 2011] [11:42:22] <sustrik>	even though there's a message, right?
| [Tuesday 03 May 2011] [11:42:28] <djc>	yeah
| [Tuesday 03 May 2011] [11:42:33] <sustrik>	then it's a bug
| [Tuesday 03 May 2011] [11:42:46] <sustrik>	do you have a test case?
| [Tuesday 03 May 2011] [11:43:07] <djc>	I can reproduce this, it's not exactly minimal
| [Tuesday 03 May 2011] [11:43:15] <sustrik>	goodo
| [Tuesday 03 May 2011] [11:43:21] <sustrik>	open an issue for it then
| [Tuesday 03 May 2011] [11:43:29] <djc>	let me try something first
| [Tuesday 03 May 2011] [11:44:34] <djc>	nope, doesn't work, I'll file an issue
| [Tuesday 03 May 2011] [11:57:56] <djc>	sustrik: okay, I was being stupid, sorry about that
| [Tuesday 03 May 2011] [11:58:03] <djc>	ZMQ_FD works just fine
| [Tuesday 03 May 2011] [11:58:50] <sustrik>	great :)
| [Tuesday 03 May 2011] [12:25:26] <djc>	if you want to reuse a zmq_msg_t, do you have to init AND close every time?
| [Tuesday 03 May 2011] [12:41:31] <pieterh>	djc: yes
| [Tuesday 03 May 2011] [13:58:29] <CindyLinz>	hi ^^
| [Tuesday 03 May 2011] [13:59:15] <CindyLinz>	I can use libev with ZMQ_FD for PULL / SUB / DEALER / ROUTER correctly
| [Tuesday 03 May 2011] [13:59:29] <CindyLinz>	But it seems not work with REQ?
| [Tuesday 03 May 2011] [13:59:49] <CindyLinz>	the ZMQ version is 2.1.6
| [Tuesday 03 May 2011] [14:14:12] <sustrik>	are you using some kind of 0mq-libev glue project or are you doing it by hand?
| [Tuesday 03 May 2011] [14:17:12] <CindyLinz>	sustrik: I think.. it's by hand... Here is my code http://paste.ideaslabs.com/show/Qz59tAylKZ
| [Tuesday 03 May 2011] [14:18:02] <sustrik>	ok
| [Tuesday 03 May 2011] [14:18:11] <sustrik>	what's the problem you are seeing?
| [Tuesday 03 May 2011] [14:18:49] <CindyLinz>	the "!!" has never showed up
| [Tuesday 03 May 2011] [14:20:24] <sustrik>	what happened instead?
| [Tuesday 03 May 2011] [14:20:33] <CindyLinz>	the code of the other side: http://paste.ideaslabs.com/show/04PNUPdV
| [Tuesday 03 May 2011] [14:21:12] <CindyLinz>	The other side will printed the request message from the REP
| [Tuesday 03 May 2011] [14:21:20] <CindyLinz>	and response some messages
| [Tuesday 03 May 2011] [14:21:34] <CindyLinz>	but the REP seems not notified
| [Tuesday 03 May 2011] [14:21:44] <pblasucci>	Hello
| [Tuesday 03 May 2011] [14:21:51] <sustrik>	sleeping in poll?
| [Tuesday 03 May 2011] [14:22:01] <sustrik>	hi
| [Tuesday 03 May 2011] [14:22:17] <CindyLinz>	But if i uncomment the code from 112 to 121, it will get the response
| [Tuesday 03 May 2011] [14:22:35] <pblasucci>	I'm not sure if this is the right place to mention this, but I've just put an F# binding to 0MQ up on GitHub
| [Tuesday 03 May 2011] [14:22:39] <CindyLinz>	no~ I can continue to send other requests.
| [Tuesday 03 May 2011] [14:22:44] <CindyLinz>	But nothing back
| [Tuesday 03 May 2011] [14:23:17] <sustrik>	pblasucci: great
| [Tuesday 03 May 2011] [14:23:29] <sustrik>	have you linked it from zeromq.org?
| [Tuesday 03 May 2011] [14:23:36] <pblasucci>	I tried
| [Tuesday 03 May 2011] [14:23:54] <pblasucci>	but after logging in, it says I don't have permission
| [Tuesday 03 May 2011] [14:24:02] <sustrik>	CindyLinz: hard to say, try to create a minimal test case
| [Tuesday 03 May 2011] [14:24:05] <pblasucci>	perhaps I was on the wrong page
| [Tuesday 03 May 2011] [14:24:26] <sustrik>	have you joined the wiki?
| [Tuesday 03 May 2011] [14:24:30] <CindyLinz>	sustrik: wait~~
| [Tuesday 03 May 2011] [14:24:58] <sustrik>	you have to be a member to have edit rights
| [Tuesday 03 May 2011] [14:25:13] <pblasucci>	Ah, I think I must not be a member
| [Tuesday 03 May 2011] [14:25:28] <pblasucci>	I thought having a Wiki account was enough
| [Tuesday 03 May 2011] [14:25:35] <pblasucci>	I'll go join now
| [Tuesday 03 May 2011] [14:31:32] <pblasucci>	Apologies but I can't figure out how to become a member
| [Tuesday 03 May 2011] [14:31:39] <CindyLinz>	sustrik: This is the test case, thank you ^^ http://paste.ideaslabs.com/show/hf0HoBspWR
| [Tuesday 03 May 2011] [14:36:59] <sustrik>	pblasucci: there used to be a "join wiki" button at zero.mq
| [Tuesday 03 May 2011] [14:37:46] <sustrik>	CindyLinz: i meant a minimal C program I can check
| [Tuesday 03 May 2011] [14:38:01] <sustrik>	presumably without libev as i have no idea of how that works
| [Tuesday 03 May 2011] [14:40:04] <pblasucci>	sustrik: hmmm... I don't see anything like that
| [Tuesday 03 May 2011] [14:40:32] <sustrik>	it must have changed
| [Tuesday 03 May 2011] [14:40:35] <sustrik>	let me invite you
| [Tuesday 03 May 2011] [14:40:46] <sustrik>	what's your name at wikidot?
| [Tuesday 03 May 2011] [14:40:47] <pblasucci>	Great! Thanks.
| [Tuesday 03 May 2011] [14:40:53] <pblasucci>	pblasucci
| [Tuesday 03 May 2011] [14:41:03] <sustrik>	ok, wait a sec
| [Tuesday 03 May 2011] [14:41:12] <CindyLinz>	sustrik: hmm.. how can i just remove the libev part, while the problem is not-notified libev?
| [Tuesday 03 May 2011] [14:41:49] <sustrik>	dunno, the problem is either in 0mq or in libev
| [Tuesday 03 May 2011] [14:41:59] <sustrik>	you should find out which one is it
| [Tuesday 03 May 2011] [14:42:09] <sustrik>	if it's 0mq we'll fix it
| [Tuesday 03 May 2011] [14:42:22] <sustrik>	if it's libev you should speak to libev devs
| [Tuesday 03 May 2011] [14:42:54] <CindyLinz>	Is it help, if I also give a working dealer version?
| [Tuesday 03 May 2011] [14:43:35] <CindyLinz>	(help or helpful.. my English is bad :( )
| [Tuesday 03 May 2011] [14:43:39] <sustrik>	np
| [Tuesday 03 May 2011] [14:43:45] <CindyLinz>	hmm..
| [Tuesday 03 May 2011] [14:45:17] <sustrik>	pblasucci: you are invited
| [Tuesday 03 May 2011] [14:45:46] <pblasucci>	Thanks!
| [Tuesday 03 May 2011] [14:46:13] <pblasucci>	Yup... looks like I'm all set.
| [Tuesday 03 May 2011] [14:46:24] <sustrik>	goodo
| [Tuesday 03 May 2011] [14:46:47] <sustrik>	CindyLinz: you can remove libev from the test case by doing what libev does by hand
| [Tuesday 03 May 2011] [14:46:55] <sustrik>	i assume its polling on the fd
| [Tuesday 03 May 2011] [14:47:58] <CindyLinz>	sustrik: i'll try.. can i use select(2) ?
| [Tuesday 03 May 2011] [14:48:35] <sustrik>	well, you should have a look what libev does
| [Tuesday 03 May 2011] [14:49:11] <sustrik>	if you do something else the problem may not show up
| [Tuesday 03 May 2011] [14:50:12] <CindyLinz>	Then i try first if the select(2) version work?
| [Tuesday 03 May 2011] [14:50:57] <sustrik>	it's up to you
| [Tuesday 03 May 2011] [14:51:24] <sustrik>	what i need is simplest possible program that shows the problem
| [Tuesday 03 May 2011] [15:24:35] <jond>	sustrik: the subports idea as originally suggested can still work over multicast....
| [Tuesday 03 May 2011] [15:31:15] <sustrik>	jond: how so
| [Tuesday 03 May 2011] [15:31:38] <sustrik>	?
| [Tuesday 03 May 2011] [15:32:32] <sustrik>	jond: btw, have you done any perf tests with the alignment patch?
| [Tuesday 03 May 2011] [15:33:38] <jond>	well in some other software I'm aware of we express multicast addresses like x.x.x.x:5555@1,2,3
| [Tuesday 03 May 2011] [15:34:25] <jond>	and 1,2,3 are the subports.
| [Tuesday 03 May 2011] [15:35:12] <jond>	re: alignment, been busy 
| [Tuesday 03 May 2011] [15:36:08] <jond>	what did you suggest as the test case throughput/latency?
| [Tuesday 03 May 2011] [15:36:08] <sustrik>	ah, i see, presumably filtering on the receiver
| [Tuesday 03 May 2011] [15:36:22] <sustrik>	latency is more relevant
| [Tuesday 03 May 2011] [15:36:29] <sustrik>	the point is that i've tried it at home
| [Tuesday 03 May 2011] [15:36:45] <sustrik>	and got no different between patched/unpatched versions
| [Tuesday 03 May 2011] [15:36:57] <jond>	re: multicast, yes the subport goes in a header, and 0 is reserved for control
| [Tuesday 03 May 2011] [15:37:02] <sustrik>	ack
| [Tuesday 03 May 2011] [15:38:31] <jond>	did you try both mpales and my patches?? I have vtune @ work which might shed some light, if I knew exactly how to interpret the results
| [Tuesday 03 May 2011] [15:39:51] <jond>	are you surprised or can explain why it makes no difference; it looks like it should?
| [Tuesday 03 May 2011] [15:40:26] <sustrik>	i've tried just your patch
| [Tuesday 03 May 2011] [15:40:37] <sustrik>	it's better, so i've tested just that one
| [Tuesday 03 May 2011] [15:40:48] <sustrik>	and yes, i am surprised
| [Tuesday 03 May 2011] [15:41:11] <sustrik>	but maybe the problem is that both threads were scheduled on the same CPU core
| [Tuesday 03 May 2011] [15:41:25] <sustrik>	so that cacheline polution became irrelevant
| [Tuesday 03 May 2011] [15:44:00] <jond>	well I did notice that the mpales patch didnt put an alignment on the struct because it used padding rather than gcc attributes. The sutter article on false sharing suggests we should be able to see something but I do not know what tools he was using
| [Tuesday 03 May 2011] [15:44:54] <jond>	I didnt alter the yqueue so maybe that needs doing as well
| [Tuesday 03 May 2011] [15:52:07] <sustrik>	yeah, yqueue may benefit from that kind of thing as well
| [Tuesday 03 May 2011] [15:52:23] <sustrik>	we probably need a more controled test
| [Tuesday 03 May 2011] [15:52:53] <sustrik>	using ypipe to pass data between two threads bound to different CPU cores (or even CPUs)
| [Tuesday 03 May 2011] [15:56:27] <jond>	yes. I also noticed someone suggessting replacing socketpair with ypipe+pipe. 
| [Tuesday 03 May 2011] [17:22:47] <CIA-75>	libzmq: 03Martin Sustrik 07master * r5e329ba 10/ src/msg.cpp : Minor patch to keep ICC compiler happy ...
| [Tuesday 03 May 2011] [17:22:49] <CIA-75>	libzmq: 03Martin Sustrik 07master * rceb5e1a 10/ (src/msg.cpp src/msg.hpp): Deallocation functions in zmq.h and msg_t class are consistent. ...
| [Wednesday 04 May 2011] [06:38:13] <Bartzy|work>	Hi, anyone here ?
| [Wednesday 04 May 2011] [06:38:46] <pieterh>	Bartzy|work: depends...
| [Wednesday 04 May 2011] [06:38:54] <pieterh>	what's up?
| [Wednesday 04 May 2011] [06:38:56] <Bartzy|work>	I have a brief question
| [Wednesday 04 May 2011] [06:39:05] <Bartzy|work>	a design question
| [Wednesday 04 May 2011] [06:39:17] <pieterh>	go for it
| [Wednesday 04 May 2011] [06:39:37] <Bartzy|work>	I have 4 processes in a server , that do image processing
| [Wednesday 04 May 2011] [06:39:54] <Bartzy|work>	they are GIMPs actually, but nevermind.. they do image processing, one image at a time
| [Wednesday 04 May 2011] [06:40:03] <pieterh>	ok
| [Wednesday 04 May 2011] [06:41:05] <Bartzy|work>	currently, my web app and those 4 GIMP processes are using the same server, so it's easy. I want to scale out, putting the GIMP processes on different, multiple servers
| [Wednesday 04 May 2011] [06:41:15] <pieterh>	have you read the Guide?
| [Wednesday 04 May 2011] [06:41:20] <Bartzy|work>	yes.
| [Wednesday 04 May 2011] [06:41:28] <CIA-75>	libzmq: 03Tore Halvorsen 07master * r1012021 10/ src/xrep.cpp : Accessing an iterator after it is accessed is not valid. ...
| [Wednesday 04 May 2011] [06:41:31] <Bartzy|work>	briefly :p
| [Wednesday 04 May 2011] [06:41:35] <Bartzy|work>	But my question is:
| [Wednesday 04 May 2011] [06:42:39] <Bartzy|work>	The code that I'll write with zeromq, let's say in PHP, should it be 1 process for each "image processing" server (which has 4 GIMP processes in it), or 4 PHP processes that each one control a different server?
| [Wednesday 04 May 2011] [06:43:04] <pieterh>	it doesn't really matter
| [Wednesday 04 May 2011] [06:43:18] <Bartzy|work>	Cause I need a response, so the PHP process controlling everything on the image processing server will be busy with only one request at a time ? 
| [Wednesday 04 May 2011] [06:43:29] <CIA-75>	libzmq: 03Martin Sustrik 07master * r3ef7c74 10/ AUTHORS : Tore Halvorsen added to the AUTHORS file ...
| [Wednesday 04 May 2011] [06:43:29] <pieterh>	whatever is easier for you
| [Wednesday 04 May 2011] [06:43:31] <Bartzy|work>	I want all 4 GIMPs in each server to work in parallel
| [Wednesday 04 May 2011] [06:43:43] <pieterh>	obviously, yes
| [Wednesday 04 May 2011] [06:43:55] <pieterh>	there are a number of patterns you can use for this
| [Wednesday 04 May 2011] [06:44:00] <Bartzy|work>	that means I need 4 processes that uses zeromq to 'listen' for work from the web app ?
| [Wednesday 04 May 2011] [06:44:02] <pieterh>	check the LRU queue patterns, for a start
| [Wednesday 04 May 2011] [06:44:15] <pieterh>	you can make the workers each a single process that is single threaded
| [Wednesday 04 May 2011] [06:44:28] <pieterh>	you can make the workers threads in a single multithreaded process
| [Wednesday 04 May 2011] [06:44:36] <Bartzy|work>	workers = the PHP code right ? not the GIMP processes ?
| [Wednesday 04 May 2011] [06:45:02] <pieterh>	read the LRU queue pattern & description, plz
| [Wednesday 04 May 2011] [06:45:07] <Bartzy|work>	PHP/python/C/whatever I chose to use with zeromq
| [Wednesday 04 May 2011] [06:45:12] <pieterh>	search for lruqueue if in doubt
| [Wednesday 04 May 2011] [06:45:21] <Bartzy|work>	ok, thanks
| [Wednesday 04 May 2011] [06:45:21] <mikko>	Bartzy|work: why do you use gimp?
| [Wednesday 04 May 2011] [06:45:26] <mikko>	just out of curiosity
| [Wednesday 04 May 2011] [06:45:28] <Bartzy|work>	mikko: Why not ?
| [Wednesday 04 May 2011] [06:45:35] <Bartzy|work>	mikko: It's like using photoshop in a script
| [Wednesday 04 May 2011] [06:45:42] <mikko>	Bartzy|work: imagemagick tends to be more geared towards headless processing
| [Wednesday 04 May 2011] [06:45:52] <pieterh>	Bartzy|work: most people would probably use imagemagick except it's harder to spell
| [Wednesday 04 May 2011] [06:45:53] <Bartzy|work>	mikko: ImageMagick is very nice, but limited
| [Wednesday 04 May 2011] [06:46:02] <mikko>	Bartzy|work: limited how?
| [Wednesday 04 May 2011] [06:46:03] <mato>	ImageMagick is also sloooow
| [Wednesday 04 May 2011] [06:46:19] <mikko>	mato: graphicsmagick then
| [Wednesday 04 May 2011] [06:46:37] <Bartzy|work>	mikko: you can do anything you do in Photoshop in ImageMagick ?
| [Wednesday 04 May 2011] [06:46:54] <mikko>	Bartzy|work: pretty much
| [Wednesday 04 May 2011] [06:47:12] <Bartzy|work>	well then it's much harder
| [Wednesday 04 May 2011] [06:47:22] <mikko>	and probably more than in gimp
| [Wednesday 04 May 2011] [06:47:39] <mikko>	last time my trial with gimp ended to not having proper CMYK support
| [Wednesday 04 May 2011] [06:47:57] <mikko>	Bartzy|work: what do you do in the gimp scripts?
| [Wednesday 04 May 2011] [06:48:09] <Bartzy|work>	mikko: Photo effects
| [Wednesday 04 May 2011] [06:48:26] <mikko>	what kind of effects?
| [Wednesday 04 May 2011] [06:48:38] <Bartzy|work>	sketching, painting etc
| [Wednesday 04 May 2011] [06:48:52] <mikko>	programmatically?
| [Wednesday 04 May 2011] [06:48:58] <pieterh>	Bartzy|work: I'd suggest initially making one process per gimp server, single threaded, and use an lruqueue device to connect workers to clients
| [Wednesday 04 May 2011] [06:49:10] <Bartzy|work>	mikko: Yes
| [Wednesday 04 May 2011] [06:49:17] <mikko>	cool
| [Wednesday 04 May 2011] [06:50:09] <sustrik>	hi mikko
| [Wednesday 04 May 2011] [06:50:13] <mikko>	hi
| [Wednesday 04 May 2011] [06:50:28] <Bartzy|work>	pieterh: Do you think gearman is more suitable for this job than zeromq ?
| [Wednesday 04 May 2011] [06:50:31] <sustrik>	any chance to check patches at the build system?
| [Wednesday 04 May 2011] [06:50:34] <Bartzy|work>	pieterh: I know they're different.
| [Wednesday 04 May 2011] [06:50:41] <mikko>	sustrik: sure
| [Wednesday 04 May 2011] [06:50:44] <mikko>	sustrik: which ones?
| [Wednesday 04 May 2011] [06:50:45] <pieterh>	Bartzy|work: nope, all messaging is just 0MQ done poorly
| [Wednesday 04 May 2011] [06:50:45] <sustrik>	i've tried to fix the issues by giess
| [Wednesday 04 May 2011] [06:50:48] <sustrik>	guess
| [Wednesday 04 May 2011] [06:50:56] <Bartzy|work>	pieterh: What do you mean ?
| [Wednesday 04 May 2011] [06:51:00] <sustrik>	but obviously that does not work :)
| [Wednesday 04 May 2011] [06:51:06] <pieterh>	Bartzy|work: well, I'm assuming you haven't actually tried 0MQ
| [Wednesday 04 May 2011] [06:51:09] <sustrik>	mikko: well, the sun studio and icc
| [Wednesday 04 May 2011] [06:51:35] <Bartzy|work>	pieterh: I read the guide a bit and saw the vidoes
| [Wednesday 04 May 2011] [06:51:37] <Bartzy|work>	videos...
| [Wednesday 04 May 2011] [06:51:57] <Bartzy|work>	pieterh: It's indeed VERY cool, but I wonder if for that specific job, gearman is more suitable and less complex.
| [Wednesday 04 May 2011] [06:53:00] <pieterh>	Bartzy|work: it's not about coolness, if you haven't actually written a couple of 0MQ apps, you can't understand it
| [Wednesday 04 May 2011] [06:53:22] <pieterh>	so my advice is to go off, make a simple workload distribution architecture, in PHP
| [Wednesday 04 May 2011] [06:53:28] <pieterh>	it'll take you a day, maybe
| [Wednesday 04 May 2011] [06:53:35] <pieterh>	if you have questions, of course ask for help
| [Wednesday 04 May 2011] [06:53:43] <pieterh>	but there are full, complete PHP examples for this
| [Wednesday 04 May 2011] [06:54:05] <Bartzy|work>	pieterh: PHP is even suited for that stuff ? I mean it's processes that need to run forever.. it won't leak or anything ?
| [Wednesday 04 May 2011] [06:54:17] <pieterh>	sigh
| [Wednesday 04 May 2011] [06:54:27] <pieterh>	:)
| [Wednesday 04 May 2011] [06:54:28] <Bartzy|work>	:\
| [Wednesday 04 May 2011] [06:54:39] <Bartzy|work>	explain yourself :p
| [Wednesday 04 May 2011] [06:54:51] <pieterh>	start by learning 0MQ, then when you know what you want to make, and how, decide how to really make it
| [Wednesday 04 May 2011] [06:55:02] <pieterh>	it's pointless to debate "what language" when you don't even know what architecture
| [Wednesday 04 May 2011] [06:55:19] <pieterh>	"ah, but do you think I should use vim or emacs?"
| [Wednesday 04 May 2011] [06:55:23] <pieterh>	not relevant
| [Wednesday 04 May 2011] [06:55:45] <pieterh>	first learn some basic messaging patterns, then decide how to make them work for you
| [Wednesday 04 May 2011] [06:56:03] <pieterh>	it's wise to make a proof of concept *as rapidly as possible* and then throw it away and start again
| [Wednesday 04 May 2011] [06:56:15] <pieterh>	does this help?
| [Wednesday 04 May 2011] [06:56:43] <Bartzy|work>	yeah, I just don't want to waste a week in learning something I won't eventually use....
| [Wednesday 04 May 2011] [06:56:47] <Bartzy|work>	so I want to research a bit
| [Wednesday 04 May 2011] [06:57:07] <djc>	Bartzy|work: the point is that ZMQ is very good at having something built in a day
| [Wednesday 04 May 2011] [06:57:10] <djc>	instead of in a week
| [Wednesday 04 May 2011] [06:57:32] <djc>	so researching it is less valuable than for some other technologies
| [Wednesday 04 May 2011] [06:57:32] <Bartzy|work>	Just to make this clear in my head - The process per gimp server - it/they should be monitored by god/monit/init ?
| [Wednesday 04 May 2011] [06:59:01] <djc>	the same as what you do now
| [Wednesday 04 May 2011] [06:59:06] <pieterh>	Bartzy|work: the only research that counts is actually programming
| [Wednesday 04 May 2011] [06:59:23] <pieterh>	asking others to make your technical choices for you isn't profitable
| [Wednesday 04 May 2011] [06:59:40] <pieterh>	0MQ makes it *really easy* to go off and learn by doing, so please do so...
| [Wednesday 04 May 2011] [06:59:49] <Bartzy|work>	OK, thanks!
| [Wednesday 04 May 2011] [07:00:04] <Bartzy|work>	pieterh: http://zguide.zeromq.org/php:lruqueue this is what you meant , I presume ?
| [Wednesday 04 May 2011] [07:00:13] <mikko>	Bartzy|work: i've been talking with ian barber about php job distribution system before
| [Wednesday 04 May 2011] [07:00:23] <mikko>	making use of php-fpm for process management
| [Wednesday 04 May 2011] [07:00:50] <Bartzy|work>	mikko: That's nice, any conclusions ?
| [Wednesday 04 May 2011] [07:01:57] <mikko>	Bartzy|work: would not be very hard
| [Wednesday 04 May 2011] [07:02:02] <mikko>	but lack of time 
| [Wednesday 04 May 2011] [07:02:38] <ianbarber>	it's a decent model, works fine. The tricky thing with whatever you use is maintaining the worker processes existence, the basic messaging is straightforward, and FPM simplifies that. 
| [Wednesday 04 May 2011] [07:03:15] <ianbarber>	otherwise that kind of work distribution is just basic push messaging
| [Wednesday 04 May 2011] [07:04:16] <Bartzy|work>	FPM should also be monitored...
| [Wednesday 04 May 2011] [07:05:24] <djc>	Bartzy|work: read more of the guide, then just spend a day writing a proof of concept
| [Wednesday 04 May 2011] [07:06:04] <sustrik>	mikko: i mean, can i log on the build box
| [Wednesday 04 May 2011] [07:06:14] <sustrik>	and try to fix the sun studio and icc problems there?
| [Wednesday 04 May 2011] [07:06:21] <Bartzy|work>	djc: OK..
| [Wednesday 04 May 2011] [07:06:49] <Bartzy|work>	thanks all
| [Wednesday 04 May 2011] [07:08:01] <mikko>	sustrik: it's behind a nat at the moment without public ip address
| [Wednesday 04 May 2011] [07:08:09] <mikko>	sustrik: i can add you user to a jump host
| [Wednesday 04 May 2011] [07:08:25] <sustrik>	hm, alternatively, can i send you patches to test?
| [Wednesday 04 May 2011] [07:08:31] <mikko>	i think i got a box connected to the internet with sun studio
| [Wednesday 04 May 2011] [07:08:46] <mikko>	if you want i can take a look in a minute 
| [Wednesday 04 May 2011] [07:08:56] <sustrik>	great, thanks
| [Wednesday 04 May 2011] [07:10:44] <mikko>	https://build.zero.mq/view/libzmq/
| [Wednesday 04 May 2011] [07:10:52] <mikko>	the builds succeed at the moment
| [Wednesday 04 May 2011] [07:11:08] <mikko>	apart from clang which seems to be a compiler thing on amd64 box
| [Wednesday 04 May 2011] [07:11:08] <sustrik>	hm, strange
| [Wednesday 04 May 2011] [07:11:25] <sustrik>	yesterday evening there were errors
| [Wednesday 04 May 2011] [07:11:50] <sustrik>	anyway, if everything works no, no need to panic
| [Wednesday 04 May 2011] [07:11:58] <sustrik>	now*
| [Wednesday 04 May 2011] [07:13:02] <mikko>	Minor patch to keep ICC compiler happy (commit: 5e329ba7cac8a52fbbd2c347064c2d9355009022) (detail)
| [Wednesday 04 May 2011] [07:13:06] <mikko>	Deallocation functions in zmq.h and msg_t class are consistent. (commit: ceb5e1a0734b0c73bd7f74ec5094ae6ad4f9dfc4) (detail)
| [Wednesday 04 May 2011] [07:13:11] <mikko>	these are the changes in latest build
| [Wednesday 04 May 2011] [07:15:03] <sustrik>	yep, those are my guess patches
| [Wednesday 04 May 2011] [07:15:17] <sustrik>	i thought they were already used in the previous build
| [Wednesday 04 May 2011] [07:15:31] <sustrik>	it seems they weren't
| [Wednesday 04 May 2011] [07:15:36] <sustrik>	so everyting is ok now
| [Wednesday 04 May 2011] [07:20:52] <mikko>	cool
| [Wednesday 04 May 2011] [09:58:17] <Bartzy|work>	pieterh: still here ?
| [Wednesday 04 May 2011] [09:58:24] <pieterh>	Bartzy|work: yup
| [Wednesday 04 May 2011] [09:58:32] <pieterh>	so you finished your prototype?
| [Wednesday 04 May 2011] [09:58:44] <Bartzy|work>	pieterh: No, I'm still at my (other) work :)
| [Wednesday 04 May 2011] [09:58:47] <pieterh>	:)
| [Wednesday 04 May 2011] [09:59:03] <Bartzy|work>	pieterh: You said earlier that you'd start with a single threaded worker for each GIMP
| [Wednesday 04 May 2011] [09:59:08] <Bartzy|work>	4 total
| [Wednesday 04 May 2011] [09:59:20] <pieterh>	I'd start with the very simplest architecture that I could make to test my concept
| [Wednesday 04 May 2011] [09:59:28] <Bartzy|work>	there's nothing to test
| [Wednesday 04 May 2011] [09:59:51] <pieterh>	in that case it should take you only an hour or two
| [Wednesday 04 May 2011] [10:00:16] <pieterh>	if you are asking my advice on how to make something, don't argue with the advice I give you :)
| [Wednesday 04 May 2011] [10:00:34] <pieterh>	make a minimal working model
| [Wednesday 04 May 2011] [10:00:44] <pieterh>	then improve it to solve specific problems you see with it
| [Wednesday 04 May 2011] [10:00:58] <pieterh>	otherwise, you will spend time solving problems that may be irrelevant
| [Wednesday 04 May 2011] [10:01:04] <pieterh>	such as... 1 process vs. N processes
| [Wednesday 04 May 2011] [10:01:10] <Bartzy|work>	pieterh: Since I need to get a response, what if I'll have a single process, each time it gets a command to run in GIMPs ("work") it will fork and continue listening for jobs.... and then execute the command on the forked process ?
| [Wednesday 04 May 2011] [10:01:30] <pieterh>	ok, so this is what you want to build...
| [Wednesday 04 May 2011] [10:01:38] <Bartzy|work>	In my opinion, it's stupid to start programming without thinking through what you're trying to accomplish.
| [Wednesday 04 May 2011] [10:01:43] <pieterh>	well...
| [Wednesday 04 May 2011] [10:01:57] <Bartzy|work>	no, it's not what I want to build. It's a solution to a problem I have
| [Wednesday 04 May 2011] [10:02:03] <Bartzy|work>	one of probably many
| [Wednesday 04 May 2011] [10:02:11] <Bartzy|work>	I want the best solution I can create :)
| [Wednesday 04 May 2011] [10:02:31] <pieterh>	sigh... if you ask and try to answer too many questions at once, you won't get anywhere quickly
| [Wednesday 04 May 2011] [10:02:56] <pieterh>	please do the following:
| [Wednesday 04 May 2011] [10:03:06] <pieterh>	- take the lruqueue example
| [Wednesday 04 May 2011] [10:03:20] <pieterh>	- make a PHP worker that executes request by request, starting GIMP in a shell each time
| [Wednesday 04 May 2011] [10:03:28] <pieterh>	- make a test client, in PHP that can drive this worker
| [Wednesday 04 May 2011] [10:03:36] <pieterh>	- start multiple workers in parallel
| [Wednesday 04 May 2011] [10:03:39] <pieterh>	- see how it works
| [Wednesday 04 May 2011] [10:03:42] <pieterh>	... OK?
| [Wednesday 04 May 2011] [10:03:54] <pieterh>	when you have that working, let's continue the discussion
| [Wednesday 04 May 2011] [10:03:54] <Bartzy|work>	no, because this is really not what I'm trying to accomplish
| [Wednesday 04 May 2011] [10:03:58] <Bartzy|work>	I don't want to start GIMP each time
| [Wednesday 04 May 2011] [10:04:22] <pieterh>	it is not relevant, to this discussion, how you talk to GIMOP
| [Wednesday 04 May 2011] [10:04:24] <pieterh>	GIMP
| [Wednesday 04 May 2011] [10:04:25] <Bartzy|work>	I want to start it once when I start the entire machine. GIMP is like MySQL to me - I ask it something and in responds.
| [Wednesday 04 May 2011] [10:04:36] <pieterh>	not at least until GIMP has 0MQ built into it
| [Wednesday 04 May 2011] [10:04:46] <Bartzy|work>	OK. So you just want me to experiment a bit with ZeroMQ? 
| [Wednesday 04 May 2011] [10:04:50] <pieterh>	yes
| [Wednesday 04 May 2011] [10:04:57] <Bartzy|work>	OK
| [Wednesday 04 May 2011] [10:05:03] <pieterh>	it's pointless to ask me questions about how to use ZeroMQ when you have no experience actually using it
| [Wednesday 04 May 2011] [10:05:14] <pieterh>	and when there  is a 150-page explanation with full examples...
| [Wednesday 04 May 2011] [10:05:23] <Bartzy|work>	And I'm asking - So I'll make some nice program that does nothing I need. Then I'll come back and ask the exact same questions.
| [Wednesday 04 May 2011] [10:05:34] <pieterh>	:) guaranteed you will ask different questions
| [Wednesday 04 May 2011] [10:05:36] <guido_g>	omg
| [Wednesday 04 May 2011] [10:05:42] <pieterh>	guido_g: help please
| [Wednesday 04 May 2011] [10:05:46] <Bartzy|work>	pieterh: OK, I'll try
| [Wednesday 04 May 2011] [10:05:58] <pieterh>	it's like asking about sex when you've never tried it
| [Wednesday 04 May 2011] [10:05:59] <guido_g>	pieterh: there is nothing one can do
| [Wednesday 04 May 2011] [10:06:14] <pieterh>	"is it true I need to get really drunk before hand?"
| [Wednesday 04 May 2011] [10:06:23] <pieterh>	"or would it be better to have a long sauna?"
| [Wednesday 04 May 2011] [10:07:00] <guido_g>	pieterh: people come here (or to other channels) and demand answers
| [Wednesday 04 May 2011] [10:07:22] <pieterh>	Bartzy|work: I don't want to be critical, it's good that you think ahead, but don't over-think it
| [Wednesday 04 May 2011] [10:07:32] <guido_g>	of course w/o even the smalles achievements on their side
| [Wednesday 04 May 2011] [10:07:52] <pieterh>	guido_g: luckily we're a caring and helpful community
| [Wednesday 04 May 2011] [10:08:25] <pieterh>	but indeed it could be worth raising the barrier a little...
| [Wednesday 04 May 2011] [10:08:40] <guido_g>	yes, this does help
| [Wednesday 04 May 2011] [10:09:06] <Bartzy|work>	pieterh: I like "best practices"
| [Wednesday 04 May 2011] [10:09:16] <guido_g>	it helped back in use-net times and it did the last years in an irc channel
| [Wednesday 04 May 2011] [10:09:36] <pieterh>	Bartzy|work: the best practice is, and I quote Zed Shaw on this, "programming, motherf***r"
| [Wednesday 04 May 2011] [10:09:48] <Bartzy|work>	now I know there isn't one true best practice for everything... but there are do and don't do's...
| [Wednesday 04 May 2011] [10:09:58] <Bartzy|work>	haha
| [Wednesday 04 May 2011] [10:10:08] <pieterh>	if you come here with questions that actually refer to the context we all share, it's much easier
| [Wednesday 04 May 2011] [10:10:21] <guido_g>	Bartzy|work: if you can't walk, don't even try to run
| [Wednesday 04 May 2011] [10:11:48] <Bartzy|work>	pieterh, guido_g : I'll build the worker like we first said - one process for each GIMP. I'll come to complain in a few hours
| [Wednesday 04 May 2011] [10:11:50] <Bartzy|work>	:)
| [Wednesday 04 May 2011] [10:11:56] <pieterh>	good deal
| [Wednesday 04 May 2011] [10:12:26] <pieterh>	If you still see the problem the same way after using 0MQ, you get your money back
| [Wednesday 04 May 2011] [10:12:27] <guido_g>	oh pieterh while this case is close, there is another question wrt the brussels
| [Wednesday 04 May 2011] [10:12:33] <pieterh>	tell me
| [Wednesday 04 May 2011] [10:13:13] <guido_g>	did you made a decision on weather? going to select the clothes...
| [Wednesday 04 May 2011] [10:13:28] <pieterh>	I've asked for excellent weather
| [Wednesday 04 May 2011] [10:13:35] <guido_g>	great
| [Wednesday 04 May 2011] [10:13:43] <pieterh>	but there's a long queue so my request might not get processed in time
| [Wednesday 04 May 2011] [10:13:54] <pieterh>	it will be warm and sunny
| [Wednesday 04 May 2011] [10:13:58] <pieterh>	but perhaps only in August or so...
| [Wednesday 04 May 2011] [10:14:04] <guido_g>	hehe
| [Wednesday 04 May 2011] [10:14:13] <pieterh>	they're not using 0MQ, obviously...
| [Wednesday 04 May 2011] [10:14:21] <guido_g>	luckly it's a very short walk from and to the hotel
| [Wednesday 04 May 2011] [10:14:49] <guido_g>	mq might have been made in heaven, but it's not used there
| [Wednesday 04 May 2011] [10:14:54] <pieterh>	lol :)
| [Wednesday 04 May 2011] [10:15:55] <guido_g>	is there an idea where the warm-up meeting on monday will be?
| [Wednesday 04 May 2011] [10:16:15] <djc>	what kind of event is there?
| [Wednesday 04 May 2011] [10:16:51] <guido_g>	http://www.zeromq.org/event:brussels-2011-05-10
| [Wednesday 04 May 2011] [10:20:24] <djc>	nice
| [Wednesday 04 May 2011] [10:20:42] <djc>	hmm, too bad, I probably won't be able to make it this time
| [Wednesday 04 May 2011] [10:21:04] <mato>	pieterh: can you make a short url for the brussels conf page?
| [Wednesday 04 May 2011] [10:21:18] <pieterh>	mato: it's been there for ages: http://zero.mq/bxl
| [Wednesday 04 May 2011] [10:21:21] <mato>	ah
| [Wednesday 04 May 2011] [10:21:23] <pieterh>	I put that in every email
| [Wednesday 04 May 2011] [10:21:25] <pieterh>	:-(
| [Wednesday 04 May 2011] [10:21:37] <pieterh>	let me put that on the page as well
| [Wednesday 04 May 2011] [10:21:48] <guido_g>	it's too short :)
| [Wednesday 04 May 2011] [10:21:49] <pieterh>	BTW anyone can make a short URL at zero.mq/go
| [Wednesday 04 May 2011] [10:22:26] <pieterh>	djc: thanks :)
| [Wednesday 04 May 2011] [10:22:49] <mato>	ok, that's better
| [Wednesday 04 May 2011] [10:23:47] <mato>	pieterh: happy with that topic?
| [Wednesday 04 May 2011] [10:24:00] <pieterh>	mato: you're the channel admin?
| [Wednesday 04 May 2011] [10:24:05] <mato>	pieterh: one of them, yes
| [Wednesday 04 May 2011] [10:24:10] <pieterh>	yes, very happy with this, was going to ask for it before but forgot
| [Wednesday 04 May 2011] [10:24:11] <pieterh>	thanks!
| [Wednesday 04 May 2011] [10:24:36] <mato>	np
| [Wednesday 04 May 2011] [11:04:46] <cremes>	mikko: ping; question on compiling under mingw
| [Wednesday 04 May 2011] [11:05:10] <cremes>	mikko: i run ./configure; make; make install and let it figure out the defaults
| [Wednesday 04 May 2011] [11:05:30] <cremes>	mikko: the makefile produces libzmq.dll.a and libzmq.la but i do not see any libzmq.dll
| [Wednesday 04 May 2011] [11:05:44] <cremes>	am i doing something wrong? do i need to pass another switch to configure?
| [Wednesday 04 May 2011] [11:06:42] <mato>	cremes: look in src/.libs
| [Wednesday 04 May 2011] [11:06:49] <mato>	libtool will hide the dll there
| [Wednesday 04 May 2011] [11:07:23] <cremes>	ah ha!
| [Wednesday 04 May 2011] [11:08:14] <cremes>	any particular reason 'make install' doesn't do the right thing here?
| [Wednesday 04 May 2011] [11:08:30] <mato>	yes, what would you have it do on windows? :-)
| [Wednesday 04 May 2011] [11:10:02] <cremes>	copy libzmq.dll to the same place it copies libzmq.dll.a and libzmq.la
| [Wednesday 04 May 2011] [11:10:12] <mato>	there is no such place on win32
| [Wednesday 04 May 2011] [11:11:26] <cremes>	well, under mingw it's pretty standard to install to /c/user/local/lib
| [Wednesday 04 May 2011] [11:11:36] <cremes>	that's at least a good "known" place to copy it from to other locations
| [Wednesday 04 May 2011] [11:11:43] <cremes>	as required by your windows apps
| [Wednesday 04 May 2011] [11:11:57] <Seta00>	windows for /usr/lib is C:/Windows/System32 :P
| [Wednesday 04 May 2011] [11:12:02] <cremes>	instead of hiding it in src/.libs (i swear i never would have found it there)
| [Wednesday 04 May 2011] [11:12:23] <mato>	I guess it could create a 'bin' directory on mingw and stick things there
| [Wednesday 04 May 2011] [11:12:33] <mato>	but AFAIK there is no real standard install path
| [Wednesday 04 May 2011] [11:12:35] <cremes>	(i should have run 'find /c -name libzmq.dll"
| [Wednesday 04 May 2011] [11:12:44] <mato>	other than %WINDIR%\system32 and you don't want that :-)
| [Wednesday 04 May 2011] [11:14:02] <cremes>	got my first 0mq program running on windows! thanks for your help!
| [Wednesday 04 May 2011] [11:36:01] <djc>	so, is there much of a difference between (a) using poll with a ZMQ_FD and a normal fd, or (b) zmq_poll with a zmq socket and a normal fd?
| [Wednesday 04 May 2011] [11:39:06] <sustrik>	djc: no
| [Wednesday 04 May 2011] [11:39:24] <djc>	basically equivalent?
| [Wednesday 04 May 2011] [11:39:28] <sustrik>	just keep in mind that ZMQ_FD is edge triggered
| [Wednesday 04 May 2011] [11:39:34] <djc>	yeah :)
| [Wednesday 04 May 2011] [11:39:53] <djc>	and that's not an issue with zmq_poll because it does the extra ZMQ_EVENTS check, presumably?
| [Wednesday 04 May 2011] [11:40:08] <djc>	or s/check/loop/
| [Wednesday 04 May 2011] [11:42:09] <sustrik>	yes
| [Wednesday 04 May 2011] [11:42:20] <sustrik>	see zmq_poll implementation in src/zmq.cpp
| [Wednesday 04 May 2011] [11:42:28] <sustrik>	it uses ZMQ_EVENTS and ZMQ_FD
| [Wednesday 04 May 2011] [11:42:28] <djc>	okay, so it's basically the same as what I'm doing
| [Wednesday 04 May 2011] [11:42:35] <djc>	okay, nice to know :)
| [Wednesday 04 May 2011] [11:42:56] <djc>	btw, zeromq 2.1 is a very nice improvement over 2.0
| [Wednesday 04 May 2011] [11:43:34] <cremes>	what's the reasoning for ZMQ_RATE, ZMQ_HWM, etc using int64_t or uint64_t but ZMQ_LINGER (and 2 others) use int?
| [Wednesday 04 May 2011] [11:44:17] <djc>	(oh yeah, and I'm also looking forward a lot to all the sockopts being int, so that the API can be simpler than the current thing)
| [Wednesday 04 May 2011] [11:47:24] <pieterh>	cremes: zero-mq, zero-reasoning!
| [Wednesday 04 May 2011] [11:48:06] <pieterh>	these were added ad-hoc
| [Wednesday 04 May 2011] [11:48:16] <pieterh>	in 3.0 they're all int where they can be
| [Wednesday 04 May 2011] [11:48:19] <cremes>	pieterh: i had opened a bug on that some time ago... i just remembered
| [Wednesday 04 May 2011] [11:48:37] <pieterh>	anyhow, every language binding should wrap these IMO
| [Wednesday 04 May 2011] [11:48:45] <cremes>	sustrik closed it because he wanted to go from int64 -> int and not int -> int64
| [Wednesday 04 May 2011] [11:48:55] <pieterh>	so e.g. in czmq you have wrappers for all these
| [Wednesday 04 May 2011] [11:49:17] <cremes>	right, i was trying to make them consistent for the ruby binding
| [Wednesday 04 May 2011] [11:49:27] <cremes>	so that other folks wouldn't need to worry about it
| [Wednesday 04 May 2011] [11:49:34] <pieterh>	yeah, in the czmq code I have two ifdef blocks
| [Wednesday 04 May 2011] [11:49:42] <pieterh>	you're free to reuse that code if it helps
| [Wednesday 04 May 2011] [11:50:08] <cremes>	nope, got my issue fixed already... i exposed a problem with the ruby binding on 32-bit windows
| [Wednesday 04 May 2011] [11:50:17] <pieterh>	aight
| [Wednesday 04 May 2011] [11:50:18] <cremes>	and it was related to this
| [Wednesday 04 May 2011] [11:51:58] <pieterh>	sustrik: hey, I was kidding about the zero-reasoning bit... come back!
| [Wednesday 04 May 2011] [11:52:18] <pieterh>	mato: you there?
| [Wednesday 04 May 2011] [11:57:10] <mato>	pieterh: yes, but i need to go in like 5mins
| [Wednesday 04 May 2011] [11:57:27] <pieterh>	I think ephemeral ports is a great idea
| [Wednesday 04 May 2011] [11:57:35] <pieterh>	it should be easy to make, too
| [Wednesday 04 May 2011] [11:58:01] <pieterh>	I assume Sustrik will accept a patch but won't make this himself
| [Wednesday 04 May 2011] [11:58:23] <mato>	i can make a patch when i have time, it's not too hard
| [Wednesday 04 May 2011] [11:58:43] <mato>	the tricky bit is actually the getsockname()/other API
| [Wednesday 04 May 2011] [11:58:50] <mato>	since a socket can have many endpoints
| [Wednesday 04 May 2011] [11:59:04] <pieterh>	right, it can be the last one or somesuch
| [Wednesday 04 May 2011] [11:59:15] <pieterh>	it's just an int value, right?
| [Wednesday 04 May 2011] [11:59:28] <mato>	pieterh: no it can't
| [Wednesday 04 May 2011] [11:59:36] <mato>	if we make an API, we do it properly
| [Wednesday 04 May 2011] [12:00:00] <pieterh>	indeed
| [Wednesday 04 May 2011] [12:00:11] <pieterh>	so maybe it's worth just jotting down how the API should work first
| [Wednesday 04 May 2011] [12:00:23] <Seta00>	looking forward to subports. my users already complain about copying libzmq.dll/so to a folder, I don't want to see their reactions when I tell them to open two ports
| [Wednesday 04 May 2011] [12:00:30] <pieterh>	yeah
| [Wednesday 04 May 2011] [12:00:39] <pieterh>	but that thread on subports was so *confused*
| [Wednesday 04 May 2011] [12:01:12] <mato>	i gotta go, cyl
| [Wednesday 04 May 2011] [12:01:24] <pieterh>	cyl mato
| [Wednesday 04 May 2011] [12:01:27] <pieterh>	zmq_push() { m=$(cat) && echo -e $(printf '\\x01\\x00\\x%02x\\x00%s' $((1 + ${#m})) "$m") | nc -q1 $@; }
| [Wednesday 04 May 2011] [12:01:47] <pieterh>	bash 1-liner from Daniel Lundin
| [Wednesday 04 May 2011] [12:18:49] <Bar__>	"We'll generate random values, just like the real weather stations do."
| [Wednesday 04 May 2011] [12:18:52] <Bar__>	lol
| [Wednesday 04 May 2011] [12:23:42] <mikko>	aha!
| [Wednesday 04 May 2011] [12:23:49] <mikko>	it got me again, setting HWM before connect
| [Wednesday 04 May 2011] [12:27:49] <djc>	mikko: what does that do?
| [Wednesday 04 May 2011] [12:28:03] <mikko>	the hwm has no effect unless you set it before connect/bind
| [Wednesday 04 May 2011] [12:28:08] <mikko>	i keep tripping on that
| [Wednesday 04 May 2011] [12:43:37] <pieterh>	mikko: if you keep tripping over it, it's bad design
| [Wednesday 04 May 2011] [12:44:06] <pieterh>	raise an issue, the setsockopt should return -1 if you call it after connect/bind
| [Wednesday 04 May 2011] [12:44:27] <pieterh>	(unless it does weird stuff like applying to some but not all connections... agh... )
| [Wednesday 04 May 2011] [12:44:36] <sustrik>	exactly
| [Wednesday 04 May 2011] [12:44:52] <pieterh>	bad design, if people keep getting it wrong
| [Wednesday 04 May 2011] [12:45:10] <pieterh>	this is like a basic rule of design, it should not be surprising
| [Wednesday 04 May 2011] [12:46:37] <sustrik>	what's the alternative?
| [Wednesday 04 May 2011] [12:49:26] <mikko>	sustrik: have a method for setting the sockopt for specific connection
| [Wednesday 04 May 2011] [12:49:31] <mikko>	not sure if that is too far from posix
| [Wednesday 04 May 2011] [12:49:42] <sustrik>	quite far imo
| [Wednesday 04 May 2011] [12:49:51] <sustrik>	it woudl require "connect IDs"
| [Wednesday 04 May 2011] [12:49:56] <sustrik>	and "bind IDs"
| [Wednesday 04 May 2011] [12:50:19] <mikko>	that is not all bad
| [Wednesday 04 May 2011] [12:50:24] <mikko>	would allow removing connection as well
| [Wednesday 04 May 2011] [12:50:35] <mikko>	currently you have to close socket and rebuild without one connection
| [Wednesday 04 May 2011] [12:51:44] <pieterh>	sustrik: what would you expect to happen, as a user, if you set HWM on a socket that's already connected...?
| [Wednesday 04 May 2011] [12:51:56] <sustrik>	no change
| [Wednesday 04 May 2011] [12:52:14] <pieterh>	nope, that's as an implementor
| [Wednesday 04 May 2011] [12:52:32] <pieterh>	since Mikko, a classic user, keeps tripping up on this, 'no change' is clearly not what he intends
| [Wednesday 04 May 2011] [12:52:45] <sustrik>	change to running sockets don't work well
| [Wednesday 04 May 2011] [12:52:53] <sustrik>	mailbox_t is nice example
| [Wednesday 04 May 2011] [12:53:10] <pieterh>	you're telling me, as often, about implementation details
| [Wednesday 04 May 2011] [12:53:17] <pieterh>	I'm talking about API design
| [Wednesday 04 May 2011] [12:53:19] <sustrik>	(the probleb with resizing buffers on the run)
| [Wednesday 04 May 2011] [12:53:41] <sustrik>	i am talking about how existing implementations work
| [Wednesday 04 May 2011] [12:53:57] <pieterh>	we have this kind of discussion often
| [Wednesday 04 May 2011] [12:53:59] <sustrik>	the rule of the thumb is "don't do that or you get burned"
| [Wednesday 04 May 2011] [12:54:15] 	 * pieterh will go off and do this properly in czmq... 
| [Wednesday 04 May 2011] [12:55:29] <pieterh>	allow me to suggest that APIs should not burn their users
| [Wednesday 04 May 2011] [12:55:47] <pieterh>	and should properly report errors when users make mistakes
| [Wednesday 04 May 2011] [12:56:10] <sustrik>	sure, but keep inside POSIX
| [Wednesday 04 May 2011] [12:56:19] <pieterh>	what does that mean?
| [Wednesday 04 May 2011] [12:56:30] <pieterh>	please send me the URL for the "POSIX API"
| [Wednesday 04 May 2011] [12:56:32] <pieterh>	it is massive
| [Wednesday 04 May 2011] [12:56:40] <sustrik>	use interfaces as defined at opengroup.org
| [Wednesday 04 May 2011] [12:57:37] <pieterh>	I'd point out that the Open Group *develop* standards, meaning it's a process
| [Wednesday 04 May 2011] [12:58:11] <pieterh>	however I'm interested in what specific API standards you're following in this case
| [Wednesday 04 May 2011] [12:58:31] <pieterh>	since you often claim "POSIX" (which is a good goal IMO) it would be useful to be precise about what that means
| [Wednesday 04 May 2011] [12:58:46] <pieterh>	"silent burning of users who get it wrong" isn't in there IMO
| [Wednesday 04 May 2011] [12:59:08] <sustrik>	that's what happens in reality though
| [Wednesday 04 May 2011] [12:59:18] <pieterh>	and you accept this as inevitable?
| [Wednesday 04 May 2011] [12:59:39] <sustrik>	changing options on run-time is hard or maybe impossible to implement consistently
| [Wednesday 04 May 2011] [12:59:43] <sustrik>	depends on the option
| [Wednesday 04 May 2011] [13:00:32] <pieterh>	so with HWMs you can maintain different-sized queues for each active connection in a socket?
| [Wednesday 04 May 2011] [13:00:42] <pieterh>	but you cannot resize a queue nor copy one queue to another
| [Wednesday 04 May 2011] [13:01:56] <pieterh>	surely the HWM is just a number
| [Wednesday 04 May 2011] [13:02:06] <sustrik>	yes, that's the case
| [Wednesday 04 May 2011] [13:02:09] <pieterh>	if your queue is already larger than the HWM, setting it lower won't have immediate impact
| [Wednesday 04 May 2011] [13:02:14] <pieterh>	only when the queue grows again
| [Wednesday 04 May 2011] [13:02:25] <pieterh>	thus, setting the HWM on an empty queue can work trivially
| [Wednesday 04 May 2011] [13:02:54] <sustrik>	there are synchronisation problems
| [Wednesday 04 May 2011] [13:03:07] <sustrik>	you can never be sure that the queue is empty at the moment
| [Wednesday 04 May 2011] [13:03:12] <pieterh>	does that matter?
| [Wednesday 04 May 2011] [13:03:41] <pieterh>	further, it would be simpler than today
| [Wednesday 04 May 2011] [13:03:42] <sustrik>	dunno, maybe it's possible to do it
| [Wednesday 04 May 2011] [13:03:46] <sustrik>	but very complex
| [Wednesday 04 May 2011] [13:03:49] <sustrik>	you can try
| [Wednesday 04 May 2011] [13:03:49] <pieterh>	now you have to manage a separate HWM per queue
| [Wednesday 04 May 2011] [13:04:03] <pieterh>	well, "send me a patch" is a good joke but it doesn't work on me
| [Wednesday 04 May 2011] [13:04:28] <pieterh>	my role is limited here to challenging your (fairly frequent) assertions that painful APIs are inevitable due to implementation details :)
| [Wednesday 04 May 2011] [13:05:16] <pieterh>	ok, I owe you a beer next week for being rather unkind
| [Wednesday 04 May 2011] [13:06:06] <pieterh>	however it is always profitable to improve an area where people systematically make mistakes
| [Wednesday 04 May 2011] [13:10:06] <sustrik>	well, it's
| [Wednesday 04 May 2011] [13:10:09] <sustrik>	1. hard to do
| [Wednesday 04 May 2011] [13:10:36] <sustrik>	OSes often get it wrong, which is a sign of a possible problem there
| [Wednesday 04 May 2011] [13:10:53] <sustrik>	2. it's not clear how to expose it via POSIX api
| [Wednesday 04 May 2011] [13:11:48] <sustrik>	3. the development of new features is severely hindered by the hacks in the codebase that cannot be removed because people are using them
| [Wednesday 04 May 2011] [13:12:15] <sustrik>	thus, adding any more hacks can easily kill the project
| [Wednesday 04 May 2011] [13:12:46] <sustrik>	what we need to do before doing this kind of thing is to grow the developer base
| [Wednesday 04 May 2011] [13:13:36] <sustrik>	once there are 10-20 people hacking on the core
| [Wednesday 04 May 2011] [13:14:03] <sustrik>	we can allow some more complexity in the codebase
| [Wednesday 04 May 2011] [14:06:06] <CIA-75>	pyzmq: 03hugo shi 07master * ra8e6532 10/ examples/eventloop/web.py : added simple example that runs a tornado web server which can send zmq messages to echostream.py ...
| [Wednesday 04 May 2011] [14:34:49] <CIA-75>	pyzmq: 03Min RK 07master * r3556e77 10/ (zmq/core/socket.pyx zmq/tests/test_device.py): Merge pull request #108 from minrk/testsockets. ...
| [Wednesday 04 May 2011] [14:56:51] <Bartzy>	I was just told at ##php that PHP is totally unsuitable for daemons and servers and stuff
| [Wednesday 04 May 2011] [14:56:52] <Bartzy>	;(
| [Wednesday 04 May 2011] [14:58:55] <Bartzy>	Anyone here is using PHP as a 'server' ?
| [Wednesday 04 May 2011] [14:59:08] <Bartzy>	with 0MQ, of course...
| [Wednesday 04 May 2011] [17:02:48] <aspidites>	any best practices when trying to design a network architecture? or is it more of a trial and error thing?
| [Wednesday 04 May 2011] [17:03:49] <mikko>	aspidites: same best practices apply as outside zeromq
| [Wednesday 04 May 2011] [17:04:07] <mikko>	there are some zeromq specific established things as well
| [Wednesday 04 May 2011] [17:04:16] <mikko>	but if you explain your situation a bit people can advise better
| [Wednesday 04 May 2011] [17:06:16] <aspidites>	well i'm trying to write a server for a trading card game. i'm thinking about having deck objects created on the server and allowing those objects to be modified using a req/rep socket pair, simultaneously using pub/sub sockets to deliver/receive updates
| [Wednesday 04 May 2011] [17:06:53] <aspidites>	eg, player client can request to draw cards and receive a reply with the cards that were drawn, but other players or spectators could subscribe to deck events such as 'player 1 drew a card'
| [Wednesday 04 May 2011] [17:08:38] <mikko>	ok, is this over the internet?
| [Wednesday 04 May 2011] [17:09:10] <aspidites>	desktop
| [Wednesday 04 May 2011] [17:09:58] <aspidites>	server would be run as a daemon either on a remote machine, or on a 'host' machine, clients would be desktop applications that connected to said remote machines, more than likely locating them through a simple name server
| [Wednesday 04 May 2011] [17:10:38] <aspidites>	initially i'll just key in the server address as a command line option, so i'm not so worried about the name server right now
| [Wednesday 04 May 2011] [17:11:23] <mikko>	what i meant by over the internet is that are you exposing zeromq to internet?
| [Wednesday 04 May 2011] [17:11:37] <mikko>	there are still occasional asserts on invalid messages
| [Wednesday 04 May 2011] [17:11:50] <mikko>	but those usually get fixed pretty quickly as they are found
| [Wednesday 04 May 2011] [17:12:20] <aspidites>	i guess i still don't follow. 
| [Wednesday 04 May 2011] [17:13:13] <aspidites>	there won't be (initially) any web based clients if that's what you mean
| [Wednesday 04 May 2011] [17:13:22] <mikko>	i mean public access
| [Wednesday 04 May 2011] [17:13:26] <mikko>	over the internet
| [Wednesday 04 May 2011] [17:13:45] <mikko>	are you exposing zeromq to public internet or is this lan application?
| [Wednesday 04 May 2011] [17:14:22] <aspidites>	mostly lan
| [Wednesday 04 May 2011] [17:14:48] <aspidites>	actually no. it would be public internet
| [Wednesday 04 May 2011] [17:15:20] <aspidites>	sorry i'm being confusing. users will most likely be spread accross domains, in separate cities, states, and more likely countries, not on the same router
| [Wednesday 04 May 2011] [17:17:06] <mikko>	yes
| [Wednesday 04 May 2011] [17:17:09] <mikko>	thats what i meant
| [Wednesday 04 May 2011] [17:18:07] <aspidites>	yeah. public internet. might need to slow down on drinking those energy drinks
| [Wednesday 04 May 2011] [17:19:13] <aspidites>	perhaps i can ask a simpler question: should i prefer the req/rep pattern when i need to guarantee delivery of messages, and the pub/sub pattern when clients may come and go without carrying about what messages are received?
| [Wednesday 04 May 2011] [17:19:46] <mikko>	yes, but most likely you want XREP/XREQ 
| [Wednesday 04 May 2011] [17:22:59] <aspidites>	which is now router/dealer, right?
| [Wednesday 04 May 2011] [17:23:07] <mikko>	yes
| [Wednesday 04 May 2011] [17:23:25] <aspidites>	ok. so when would i use push/pull?
| [Wednesday 04 May 2011] [17:23:51] <mikko>	fire and forget
| [Wednesday 04 May 2011] [17:25:07] <aspidites>	ah ok
| [Wednesday 04 May 2011] [17:26:05] <aspidites>	i see the multithreading example, is there a similar multiprocessing example?
| [Wednesday 04 May 2011] [17:30:56] <aspidites>	nvm thanks though
| [Wednesday 04 May 2011] [19:24:41] <Bartzy>	Can I use fork with zeromq ? 
| [Wednesday 04 May 2011] [19:24:56] <Bartzy>	It won't crash or something cause file descriptors get shared between processes ?
| [Thursday 05 May 2011] [02:53:04] <djc>	Bartzy: IIRC you shouldn't share sockets across threads
| [Thursday 05 May 2011] [02:53:13] <djc>	(zmq sockets)
| [Thursday 05 May 2011] [02:54:19] <guido_g>	fork <- processes
| [Thursday 05 May 2011] [02:54:31] <guido_g>	but the statement holds
| [Thursday 05 May 2011] [02:54:34] <djc>	yeah
| [Thursday 05 May 2011] [02:54:54] <djc>	hmmm, I'm using a device to forward a tcp publisher over inproc
| [Thursday 05 May 2011] [02:55:05] <djc>	but it seems to leak like hell
| [Thursday 05 May 2011] [02:55:13] <djc>	even though I set HWM on the inproc subs
| [Thursday 05 May 2011] [02:55:31] <djc>	presumably if there are no inproc subs the device will just lose the messages, right?
| [Thursday 05 May 2011] [02:57:50] <djc>	also is it possible somehow to inspect the size of the queue for a subscriber?
| [Thursday 05 May 2011] [02:58:07] <djc>	I don't see anything in the getsockopt docs, so probably not...
| [Thursday 05 May 2011] [02:58:35] <guido_g>	hwm should be set on both sides for inproc
| [Thursday 05 May 2011] [02:58:57] <guido_g>	its then the sum of both sides, i've heard here
| [Thursday 05 May 2011] [02:59:00] <djc>	why's that?
| [Thursday 05 May 2011] [02:59:10] <guido_g>	i didn't implement it
| [Thursday 05 May 2011] [02:59:28] <sustrik>	the reason is to make it work same for tcp and inproc
| [Thursday 05 May 2011] [02:59:44] <sustrik>	so, in tcp you have a buffer on send side and buffer on recv side
| [Thursday 05 May 2011] [02:59:55] <djc>	ah, ok
| [Thursday 05 May 2011] [02:59:57] <djc>	that makes sense
| [Thursday 05 May 2011] [03:00:15] <djc>	so for a forwarder device, if I only have HWM on the pub side, should that suffice?
| [Thursday 05 May 2011] [03:00:23] <djc>	or does that just make it clog up on the sub side?
| [Thursday 05 May 2011] [03:00:34] <sustrik>	the latter
| [Thursday 05 May 2011] [03:00:57] <sustrik>	if you wan't to bound memory usage
| [Thursday 05 May 2011] [03:01:07] <sustrik>	set hwm on every socket you are using
| [Thursday 05 May 2011] [03:01:36] <djc>	I had a server completely fail last night because the OOM killer for some reason killed everything except the pyzmq-using process :(
| [Thursday 05 May 2011] [03:02:13] <sustrik>	yes, you should use HWM consistently
| [Thursday 05 May 2011] [03:02:24] <sustrik>	you can also have a look at MAXMSGSIZE option
| [Thursday 05 May 2011] [03:02:28] <djc>	sustrik: if the forwarder device doesn't have any clients on the pub side, it will still throw messages away, right?
| [Thursday 05 May 2011] [03:02:33] <djc>	like a normal publisher?
| [Thursday 05 May 2011] [03:02:48] <sustrik>	yes, the same
| [Thursday 05 May 2011] [03:03:10] <djc>	and would it be hard to add a sock opt to get the queue size?
| [Thursday 05 May 2011] [03:03:40] <sustrik>	which queue?
| [Thursday 05 May 2011] [03:03:47] <sustrik>	there are many queues beneath each socket
| [Thursday 05 May 2011] [03:03:56] <sustrik>	one per connection basically
| [Thursday 05 May 2011] [03:04:08] <djc>	yeah
| [Thursday 05 May 2011] [03:04:21] <djc>	I suppose, on a sub socket, the total of all messages queued from each publisher
| [Thursday 05 May 2011] [03:04:27] <sustrik>	also, you can't account for data stored in TCP buffers, in the NIC etc.
| [Thursday 05 May 2011] [03:04:49] <sustrik>	what would you use that for?
| [Thursday 05 May 2011] [03:05:02] <sustrik>	memory usage management?
| [Thursday 05 May 2011] [03:25:17] <guido_g>	some information would be better than no information
| [Thursday 05 May 2011] [03:25:48] <guido_g>	one could use the information to see trends and steer the components
| [Thursday 05 May 2011] [03:26:27] <sustrik>	you mean in terms of memory management, right?
| [Thursday 05 May 2011] [03:26:53] <sustrik>	like "this component is using too much memory so let's ask it to pause for a while"
| [Thursday 05 May 2011] [03:26:54] <guido_g>	no, I mean in terms of overall management during system runtime
| [Thursday 05 May 2011] [03:27:25] <sustrik>	management of what then, network bandwidth?
| [Thursday 05 May 2011] [03:27:35] <guido_g>	the whole system
| [Thursday 05 May 2011] [03:27:41] <sustrik>	CPU usage?
| [Thursday 05 May 2011] [03:27:45] <guido_g>	the whole system
| [Thursday 05 May 2011] [03:27:50] <sustrik>	what's that? :)
| [Thursday 05 May 2011] [03:27:54] <guido_g>	omfg
| [Thursday 05 May 2011] [03:28:07] <guido_g>	sometimes it's really hard
| [Thursday 05 May 2011] [03:28:30] <sustrik>	well, you want to manage something, but you don't say what you want to manage
| [Thursday 05 May 2011] [03:28:34] <sustrik>	hard to help you then
| [Thursday 05 May 2011] [03:28:37] <guido_g>	the application
| [Thursday 05 May 2011] [03:28:46] <sustrik>	can you give an example?
| [Thursday 05 May 2011] [03:28:53] <guido_g>	i build an application and need to keep track what it does
| [Thursday 05 May 2011] [03:29:01] <guido_g>	messaging is part of this
| [Thursday 05 May 2011] [03:29:10] <guido_g>	i don't need exact numbers
| [Thursday 05 May 2011] [03:29:34] <guido_g>	it's more important to have measurement-pointsd all over the app
| [Thursday 05 May 2011] [03:29:48] <guido_g>	so there is evidence if something goes wrong
| [Thursday 05 May 2011] [03:30:10] <mikko>	deja vu
| [Thursday 05 May 2011] [03:30:14] <mikko>	good morning
| [Thursday 05 May 2011] [03:30:15] <guido_g>	it modernd times, this information might even be used to allert ops if something looks fishy
| [Thursday 05 May 2011] [03:30:20] <sustrik>	morning
| [Thursday 05 May 2011] [03:30:25] <sustrik>	right
| [Thursday 05 May 2011] [03:30:25] <guido_g>	hi mikko 
| [Thursday 05 May 2011] [03:30:30] <sustrik>	do you monitor tcp buffers?
| [Thursday 05 May 2011] [03:30:39] <guido_g>	i knew that would come
| [Thursday 05 May 2011] [03:30:48] <guido_g>	if i have to, i'd do it
| [Thursday 05 May 2011] [03:30:49] <sustrik>	there's actually a way to do that as i found out yesterday
| [Thursday 05 May 2011] [03:31:08] <guido_g>	but messages are a way better overall indicator
| [Thursday 05 May 2011] [03:31:21] <guido_g>	because these link directly to the applications actions
| [Thursday 05 May 2011] [03:31:27] <mikko>	i think metric of how many messages in zeromq buffers is a useful metric
| [Thursday 05 May 2011] [03:31:35] <guido_g>	and therefore produce a "value" for logging/monitoring
| [Thursday 05 May 2011] [03:32:01] <guido_g>	mikko: thanks, i owe you a beer
| [Thursday 05 May 2011] [03:32:14] <mikko>	guido_g: we've had this discussion before
| [Thursday 05 May 2011] [03:32:25] <guido_g>	mikko: you too?  ,)
| [Thursday 05 May 2011] [03:32:30] <sustrik>	let's maybe discuss it in bxl?
| [Thursday 05 May 2011] [03:32:36] <guido_g>	YES!
| [Thursday 05 May 2011] [03:32:37] <mikko>	i think the best you can do is to give real-world example how you use this metric
| [Thursday 05 May 2011] [03:32:45] <sustrik>	yes, please
| [Thursday 05 May 2011] [03:32:50] <mikko>	what do you gain out of this metric, not just "logging" as whole
| [Thursday 05 May 2011] [03:32:59] <sustrik>	without the use cases the discussion is kind of pointless
| [Thursday 05 May 2011] [03:33:04] <guido_g>	no
| [Thursday 05 May 2011] [03:33:11] <mikko>	once there is a real-world example sustrik can relate to it
| [Thursday 05 May 2011] [03:33:13] <guido_g>	it'S a service the library should provide
| [Thursday 05 May 2011] [03:33:24] <djc>	mikko: for example, you might have found out sooner you erroneously set your HWM after the connect
| [Thursday 05 May 2011] [03:33:27] <guido_g>	going to read the internets then...
| [Thursday 05 May 2011] [03:33:46] <djc>	I would definitely have found out my single HWM was not enough
| [Thursday 05 May 2011] [03:33:51] <mikko>	djc: i wouldn't, because it was the receiver side hwm
| [Thursday 05 May 2011] [03:33:55] <djc>	even though I still don't fully understand why that is
| [Thursday 05 May 2011] [03:33:59] <mikko>	i wouldve looked at sender side
| [Thursday 05 May 2011] [03:34:09] <mikko>	djc: inproc?
| [Thursday 05 May 2011] [03:34:16] <djc>	yeah, inproc
| [Thursday 05 May 2011] [03:34:24] <mikko>	set sender and receiver hwm
| [Thursday 05 May 2011] [03:34:33] <djc>	yeah, sure, WHY, though?
| [Thursday 05 May 2011] [03:34:40] <mikko>	because the messages get queued
| [Thursday 05 May 2011] [03:34:51] <djc>	the docs say for PUB and SUB sockets, both have action = Drop for HWM
| [Thursday 05 May 2011] [03:34:54] <mikko>	in my case i publish frames from kinect
| [Thursday 05 May 2011] [03:35:01] <mikko>	sensor gives 30fps
| [Thursday 05 May 2011] [03:35:09] <mikko>	and my gui occasionally lags behind a bit
| [Thursday 05 May 2011] [03:35:18] <djc>	so it seems like, if I set HWM on the sub, the sub should drop if it gets more stuff from the PUB
| [Thursday 05 May 2011] [03:35:24] <mikko>	and then the memory usage starts to sky rocket as the frames get buffered
| [Thursday 05 May 2011] [03:35:37] <mikko>	djc: yes
| [Thursday 05 May 2011] [03:35:41] <mikko>	that's what i wanted in my case
| [Thursday 05 May 2011] [03:35:50] <djc>	that's similar to what I have, I'm pushing JSON messages over a WebSocket and the browser has to update a web page
| [Thursday 05 May 2011] [03:35:50] <mikko>	as the sensor feed is real-time
| [Thursday 05 May 2011] [03:36:18] <mikko>	this is only problem if you publish faster than you consume
| [Thursday 05 May 2011] [03:36:39] <mikko>	guido_g: there is no question in my mind that zeromq should provide this metric
| [Thursday 05 May 2011] [03:36:51] <mikko>	sustrik: if you can monitor the size of tcp buffers why not zeromq as well?
| [Thursday 05 May 2011] [03:37:12] <djc>	also, does someone here have experience tuning the Linux OOM killer? ;)
| [Thursday 05 May 2011] [03:38:22] <djc>	mikko: but the thing is, I'm forwarding from tcp to inproc, and I think the inproc side of the forwarder had no clients at all
| [Thursday 05 May 2011] [03:38:36] <djc>	so in that case I don't understand why I need a HWM set
| [Thursday 05 May 2011] [03:38:47] <djc>	because the pub side of the forwarder should just drop everything
| [Thursday 05 May 2011] [03:38:53] <mikko>	you don't necessarily
| [Thursday 05 May 2011] [03:38:57] <mikko>	are you having issues?
| [Thursday 05 May 2011] [03:39:26] <djc>	the OOM killer killed one of my servers last night
| [Thursday 05 May 2011] [03:39:36] <djc>	because it didn't understand what process it had to kill
| [Thursday 05 May 2011] [03:40:05] <sustrik>	mikko: my fear is that people would abuse it to drive application logic
| [Thursday 05 May 2011] [03:40:18] <guido_g>	mikko: http://highscalability.com/log-everything-all-time  <- my statement in form of an article (note the date!)
| [Thursday 05 May 2011] [03:40:20] <mikko>	terminate called after throwing an instance of 'zmq::error_t'
| [Thursday 05 May 2011] [03:40:23] <sustrik>	i've had that discussion serveral times
| [Thursday 05 May 2011] [03:40:26] <mikko>	shouldn't this be catchable?
| [Thursday 05 May 2011] [03:40:35] <sustrik>	guy asks for monitoring the queue size
| [Thursday 05 May 2011] [03:40:45] <sustrik>	says it's for "monitoring" purposes
| [Thursday 05 May 2011] [03:40:55] <guido_g>	you can'T protect the world
| [Thursday 05 May 2011] [03:41:09] <djc>	sustrik: the solution for that would be good docs
| [Thursday 05 May 2011] [03:41:16] <sustrik>	further questioning reveals that he actually want's it to dirve the business logic
| [Thursday 05 May 2011] [03:41:19] <djc>	which say DON'T USE THIS FOR APP LOGIC
| [Thursday 05 May 2011] [03:41:31] <djc>	and then when they complain you can just point to the docs
| [Thursday 05 May 2011] [03:41:38] <guido_g>	if mq should be used for real 24/7 distributed applications, it has to have a way to montior it's behaviour
| [Thursday 05 May 2011] [03:41:44] <sustrik>	well, the REQ/REP is meant to do REQ/REP
| [Thursday 05 May 2011] [03:41:49] <guido_g>	directly and related to the messages it processes
| [Thursday 05 May 2011] [03:41:59] <sustrik>	what you see now is everyone using it to do custom routing
| [Thursday 05 May 2011] [03:42:04] <guido_g>	for now it's a black box
| [Thursday 05 May 2011] [03:42:10] <pieterh>	sustrik: you're not being fair here
| [Thursday 05 May 2011] [03:42:16] <pieterh>	0MQ lacks any other way to do routing
| [Thursday 05 May 2011] [03:42:19] <guido_g>	and ask ops guys what they think of those things
| [Thursday 05 May 2011] [03:42:26] <guido_g>	hi pieterh 
| [Thursday 05 May 2011] [03:42:29] <sustrik>	morning
| [Thursday 05 May 2011] [03:42:33] <pieterh>	guido_g: hi
| [Thursday 05 May 2011] [03:42:55] <pieterh>	sustrik: if you keep complaining that people 'misuse' your lovely designs
| [Thursday 05 May 2011] [03:42:56] <guido_g>	welcome to the pre-warmup for brussels :)
| [Thursday 05 May 2011] [03:43:04] <pieterh>	you really start to sound silly
| [Thursday 05 May 2011] [03:43:14] <pieterh>	since you don't provide alternatives
| [Thursday 05 May 2011] [03:43:21] <pieterh>	and you try to claim that the use cases are invalid
| [Thursday 05 May 2011] [03:43:25] <pieterh>	or people are just too stupid
| [Thursday 05 May 2011] [03:43:27] <pieterh>	or something
| [Thursday 05 May 2011] [03:43:28] <sustrik>	well, if i added every possible feature to 0mq, we'll be back to AMQP style design by now
| [Thursday 05 May 2011] [03:43:33] <pieterh>	it's really annoying to have this discussion
| [Thursday 05 May 2011] [03:43:45] <pieterh>	no-one is asking for "every possible feature"
| [Thursday 05 May 2011] [03:43:49] <pieterh>	that is a straw man
| [Thursday 05 May 2011] [03:43:53] <guido_g>	sustrik: resistance is good, up to a certain amount
| [Thursday 05 May 2011] [03:43:53] <djc>	sustrik: it's not even a feature, just exposing some more data you already have somehwere
| [Thursday 05 May 2011] [03:43:55] <sustrik>	one at a time :)
| [Thursday 05 May 2011] [03:44:06] <guido_g>	sustrik: if you refuse too much features, you fail to attract users
| [Thursday 05 May 2011] [03:44:08] <pieterh>	stop telling your users they are stupid, it's really bad politics
| [Thursday 05 May 2011] [03:44:17] <pieterh>	you don't actually use 0MQ
| [Thursday 05 May 2011] [03:44:17] <sustrik>	ok
| [Thursday 05 May 2011] [03:44:25] <pieterh>	you are actually incompetent when it comes to knowing about use cases
| [Thursday 05 May 2011] [03:44:34] <pieterh>	if you don't trust your users, what do you have?
| [Thursday 05 May 2011] [03:44:37] <guido_g>	ahhh
| [Thursday 05 May 2011] [03:44:39] <djc>	pieterh: harsh words, man
| [Thursday 05 May 2011] [03:44:44] <pieterh>	true words
| [Thursday 05 May 2011] [03:44:56] <guido_g>	one-gear down would help more, i think
| [Thursday 05 May 2011] [03:45:09] <sustrik>	i would love to hear the use case
| [Thursday 05 May 2011] [03:45:13] <pieterh>	either we design 0MQ collectively, or it fails to work
| [Thursday 05 May 2011] [03:45:24] <djc>	sustrik: the use case is actual monitoring
| [Thursday 05 May 2011] [03:45:32] <sustrik>	what's that?
| [Thursday 05 May 2011] [03:45:38] <sustrik>	what it is used for?
| [Thursday 05 May 2011] [03:45:40] <sustrik>	etc.
| [Thursday 05 May 2011] [03:45:42] <djc>	making sure the message queues don't balloon out because of my failing to set enough HWMs
| [Thursday 05 May 2011] [03:45:54] <djc>	and displaying some values about this on a status page
| [Thursday 05 May 2011] [03:46:03] <djc>	so I can correct my code by setting more HWMs
| [Thursday 05 May 2011] [03:46:08] <sustrik>	ah, so it's for debugging, right?
| [Thursday 05 May 2011] [03:46:15] <guido_g>	pieterh: is it ok to have a page on the wiki for such things? and if so, where?
| [Thursday 05 May 2011] [03:46:24] <djc>	sustrik: debugging and monitoring go together
| [Thursday 05 May 2011] [03:46:29] <pieterh>	guido_g: what such things?
| [Thursday 05 May 2011] [03:46:38] <djc>	some code that worked fine may not work once I start to move more messages through the socket
| [Thursday 05 May 2011] [03:46:39] <sustrik>	so what's the monitoring part about?
| [Thursday 05 May 2011] [03:46:51] <guido_g>	pieterh: features to be beaten^W discussed over
| [Thursday 05 May 2011] [03:47:10] <pieterh>	guido_g: for sure, yes... I sometimes make 'topic' pages for that stuff
| [Thursday 05 May 2011] [03:47:27] <sustrik>	that would be goog
| [Thursday 05 May 2011] [03:47:30] <sustrik>	good
| [Thursday 05 May 2011] [03:47:41] <sustrik>	especially if people post use cases there
| [Thursday 05 May 2011] [03:47:49] <djc>	sustrik: the monitoring part is just being able to ascertain that something is not going wrong... it's not just debugging
| [Thursday 05 May 2011] [03:48:23] <guido_g>	pieterh: i want to present the monitoring use-case, lots of links and some meagre words from me
| [Thursday 05 May 2011] [03:48:42] <djc>	for example I'd put it into SNMP and integrate it with my other diagnostics
| [Thursday 05 May 2011] [03:48:45] <guido_g>	monitoring is much more, yes
| [Thursday 05 May 2011] [03:48:56] <pieterh>	start a topic: page, write what you like, then post link to email list and discuss there
| [Thursday 05 May 2011] [03:48:58] <djc>	(for example couchdb replication state, redis uptime, whatever)
| [Thursday 05 May 2011] [03:49:06] <guido_g>	pieterh: ah ok
| [Thursday 05 May 2011] [03:49:28] 	 * guido_g goes of to find out what a topic-page is
| [Thursday 05 May 2011] [03:50:17] <pieterh>	guido_g: it's a wiki, you enter 'http://www.zeromq.org/topic:monitoring-something' in the URL, then click to create the page
| [Thursday 05 May 2011] [03:50:35] <guido_g>	pieterh: thanks
| [Thursday 05 May 2011] [03:50:38] <pieterh>	you can edit the community page to add to the list of topics already shown
| [Thursday 05 May 2011] [03:51:29] <guido_g>	i'm not allowed to do that
| [Thursday 05 May 2011] [03:51:57] <guido_g>	the story of my life
| [Thursday 05 May 2011] [03:52:29] <djc>	sustrik: so in my pub-sub-forwarded-over-inproc scenario, how many HWMs do I need to set to be safe? in my mental model, if I set the HWM on the inproc subscriber (at the end of the chain), I'd be safe
| [Thursday 05 May 2011] [03:52:38] <pieterh>	guido_g: join the wiki, there should be a button somewhere
| [Thursday 05 May 2011] [03:52:41] <djc>	but obviously that's not the case, and I don't understand why, from the docs
| [Thursday 05 May 2011] [03:52:43] 	 * pieterh will check the wiki permissions
| [Thursday 05 May 2011] [03:52:48] <guido_g>	pieterh: i'm logged in
| [Thursday 05 May 2011] [03:53:12] <sustrik>	djc: on every socket
| [Thursday 05 May 2011] [03:53:31] <djc>	yeah, I really don't understand why that is
| [Thursday 05 May 2011] [03:53:49] <pieterh>	guido_g: did you join the site? You have to be a member to edit pages on it
| [Thursday 05 May 2011] [03:53:58] <sustrik>	actually, my feeling is that the whole monitoring discussion would be solved by setting the default HWM to 1000 or somesuch :)
| [Thursday 05 May 2011] [03:54:11] <pieterh>	sustrik: yeah, or default in context
| [Thursday 05 May 2011] [03:54:27] <djc>	ugh, that would be really bad
| [Thursday 05 May 2011] [03:54:35] <guido_g>	pieterh: i could edit the brussels page, but i'm not allowed to create a page (url close the one you gave)
| [Thursday 05 May 2011] [03:54:47] <sustrik>	djc: why so?
| [Thursday 05 May 2011] [03:54:55] <sustrik>	infinity is a prety lousy default
| [Thursday 05 May 2011] [03:55:02] <djc>	sustrik: because I don't want it to lose messages by default
| [Thursday 05 May 2011] [03:55:05] <guido_g>	pieterh: i requested http://www.zeromq.org/topic:monitoring-support and clicked on create page
| [Thursday 05 May 2011] [03:55:24] <pieterh>	guido_g: sorry, it's 'topics' not 'topic'...
| [Thursday 05 May 2011] [03:55:45] <pieterh>	I can make a better interface for creating topics but you're pretty much user number 1 here
| [Thursday 05 May 2011] [03:55:47] <guido_g>	pieterh: see, and it works :)
| [Thursday 05 May 2011] [03:55:51] <guido_g>	pieterh: thanks again
| [Thursday 05 May 2011] [03:55:53] <sustrik>	djc: you mean in pub/sub?
| [Thursday 05 May 2011] [03:56:12] <djc>	sustrik: but explain this to me some more... in my mind, a message incoming over tcp gets to the forwarder sub, is then copied onto the inproc pub, then it immediately gets reference-copied to each inproc sub incoming queue, right?
| [Thursday 05 May 2011] [03:56:22] <djc>	sustrik: yeah, pub/sub
| [Thursday 05 May 2011] [03:56:58] <sustrik>	yes
| [Thursday 05 May 2011] [03:57:26] <djc>	sustrik: so if I set HWM on the inproc sub, it should drop things that come in when it's full, so how is that not a good enough solution?
| [Thursday 05 May 2011] [03:57:47] <djc>	there doesn't seem to be any opportunity for the other buffers to get clogged up
| [Thursday 05 May 2011] [03:58:04] <sustrik>	but it's either/or problem; either you loose messages or run out of memory
| [Thursday 05 May 2011] [03:58:16] <sustrik>	there's no way out of that
| [Thursday 05 May 2011] [03:58:22] <djc>	sustrik: yes, and that's exactly the choice zeromq shouldn't make for me
| [Thursday 05 May 2011] [03:58:32] <sustrik>	ah
| [Thursday 05 May 2011] [03:58:50] <sustrik>	i was speaking about default behaviour
| [Thursday 05 May 2011] [03:58:57] <sustrik>	not mandatory behaviour
| [Thursday 05 May 2011] [03:59:43] <sustrik>	the point was that loosing messages is probably more acceptable than process being killed by OOM killer
| [Thursday 05 May 2011] [04:00:07] <djc>	well, I prefer fail fast, and I'll notice the OOM killer sooner than I'll notice messages being dropped
| [Thursday 05 May 2011] [04:00:39] <djc>	(actually before the OOM killer I noticed the memory use before it became really problematic and killed the right process myself, and then set the HWM)
| [Thursday 05 May 2011] [04:00:44] <pieterh>	djc: if 0MQ told you when it was dropping messages, would that help?
| [Thursday 05 May 2011] [04:00:55] <djc>	but you still haven't explained why my single HWM won't work
| [Thursday 05 May 2011] [04:01:17] <djc>	pieterh: that might help some, but I'm not sure what the appropriate channel for that would be 
| [Thursday 05 May 2011] [04:01:33] <pieterh>	well, there's already sys://log for such things
| [Thursday 05 May 2011] [04:01:52] <pieterh>	it can be extraordinarily annoying to e.g. have messages dropped silently when they can't be routed
| [Thursday 05 May 2011] [04:02:11] <pieterh>	sustrik: you realize that the only way to debug this is to add printfs to libzmq?
| [Thursday 05 May 2011] [04:02:24] <sustrik>	yes
| [Thursday 05 May 2011] [04:02:32] <pieterh>	i vaguely recall submitting a patch for this, which got rejected
| [Thursday 05 May 2011] [04:02:45] <sustrik>	two problems
| [Thursday 05 May 2011] [04:03:06] <sustrik>	1. if there are several publishers it's not clear which message sequence is broken
| [Thursday 05 May 2011] [04:03:42] <sustrik>	2. there should be a way to propagate the "breaking points" down the pub/sub tree
| [Thursday 05 May 2011] [04:04:07] <sustrik>	djc: if there's unbounded queue anywhere in the system it'll become the narrow point where the messages get accumulated
| [Thursday 05 May 2011] [04:04:34] <djc>	sustrik: that doesn't make sense if the HWM behavior is to drop
| [Thursday 05 May 2011] [04:04:37] <sustrik>	so, in congestion situation, that queue will grow and ultimately run out of memory
| [Thursday 05 May 2011] [04:04:55] <sustrik>	what should it be instead?
| [Thursday 05 May 2011] [04:04:59] <djc>	the docs say the subscriber drops messages, it doesn't say the subscriber blocks messages
| [Thursday 05 May 2011] [04:05:12] <sustrik>	yes, for pub/sub it drops
| [Thursday 05 May 2011] [04:05:21] <sustrik>	you would prefer blocking?
| [Thursday 05 May 2011] [04:05:35] <djc>	no, I prefer dropping, but you'r saying that it actually blocks
| [Thursday 05 May 2011] [04:05:58] <djc>	the unbounded queues can only grow if the the downstream queues block instead of drop
| [Thursday 05 May 2011] [04:05:59] <sustrik>	did i said that?
| [Thursday 05 May 2011] [04:06:10] <sustrik>	ah
| [Thursday 05 May 2011] [04:06:21] <djc>	if the downstream queues dropped instead of blocked, the upstream queues wouldn't accumulate
| [Thursday 05 May 2011] [04:06:25] <sustrik>	there are more queues there than you are seeing
| [Thursday 05 May 2011] [04:06:38] <sustrik>	there's TCP involved which has a blocking behaviour
| [Thursday 05 May 2011] [04:07:02] <sustrik>	so, if the network is not keeping up with the feed, it causes TCP to block
| [Thursday 05 May 2011] [04:07:25] <djc>	but that would only be if the subscriber side doesn't get a chance to recv its messages and then drop them, right?
| [Thursday 05 May 2011] [04:07:55] <sustrik>	if it doesn't catch up
| [Thursday 05 May 2011] [04:08:07] <sustrik>	slow hardware, limited bandwidth or whatever
| [Thursday 05 May 2011] [04:08:22] <djc>	yeah, we don't have slow hardware or limited bandwidth
| [Thursday 05 May 2011] [04:09:10] <sustrik>	ok, so what's the problem once again?
| [Thursday 05 May 2011] [04:09:25] <sustrik>	i understand the topology you have
| [Thursday 05 May 2011] [04:09:42] <sustrik>	what's the thing you believe is broken?
| [Thursday 05 May 2011] [04:10:25] <djc>	okay, the problem is, I set the HWM on the downstream inproc subscribers yesterday afternoon, and yesterday evening the process completely blew up, invoking the OOM killer until the server had to be restarted
| [Thursday 05 May 2011] [04:10:55] <sustrik>	there's hwm missing somewhere i would guess
| [Thursday 05 May 2011] [04:11:28] <djc>	yes, that's what you've been saying, but it still seems weird to me
| [Thursday 05 May 2011] [04:11:46] <djc>	particularly because I *suspect* (but can't be sure at this point) that there were no inproc subscribers at all
| [Thursday 05 May 2011] [04:11:59] <sustrik>	aha
| [Thursday 05 May 2011] [04:12:12] <sustrik>	maybe there's a bug
| [Thursday 05 May 2011] [04:12:15] <sustrik>	hard to say
| [Thursday 05 May 2011] [04:12:31] <sustrik>	what was the message load?
| [Thursday 05 May 2011] [04:12:34] <djc>	yeah, so for debugging it would help if I could inspect the queue size ;)
| [Thursday 05 May 2011] [04:12:35] <sustrik>	very high?
| [Thursday 05 May 2011] [04:13:04] <djc>	I don't have hard numbers about the message load yet, I'll make some today
| [Thursday 05 May 2011] [04:13:23] <sustrik>	i mean, was it "publish as fast as possible" scenario?
| [Thursday 05 May 2011] [04:13:47] <sustrik>	or rather something like "send a message each millisecond"
| [Thursday 05 May 2011] [04:13:53] <djc>	the former
| [Thursday 05 May 2011] [04:13:59] <sustrik>	ok
| [Thursday 05 May 2011] [04:14:13] <djc>	it's tick data from stock exchanges all over the world
| [Thursday 05 May 2011] [04:14:23] <djc>	for some 500 different markets
| [Thursday 05 May 2011] [04:14:29] <sustrik>	in such cases you are basically testing congestion behaviour of the system
| [Thursday 05 May 2011] [04:15:07] <sustrik>	the congestion happens at points where two "pipes" get connected
| [Thursday 05 May 2011] [04:15:20] <sustrik>	and the downstream one is slower than upstream one
| [Thursday 05 May 2011] [04:15:30] <sustrik>	for example a TCP and 0mq
| [Thursday 05 May 2011] [04:15:55] <sustrik>	the only real solution is to set HWM everywhere
| [Thursday 05 May 2011] [04:16:27] <sustrik>	that would guarantee that if the congestion happens at any point of the patch
| [Thursday 05 May 2011] [04:16:28] <sustrik>	path
| [Thursday 05 May 2011] [04:16:36] <djc>	yeah, I just think the docs don't make clear enough why in this kind of scenario dropping messages might not actually drop, but rather block
| [Thursday 05 May 2011] [04:16:37] <sustrik>	it won't run out of memory
| [Thursday 05 May 2011] [04:17:08] <sustrik>	hm, well, it's not really visible to the user
| [Thursday 05 May 2011] [04:17:29] <djc>	it's visible because the server runs out of memory :P
| [Thursday 05 May 2011] [04:17:40] <sustrik>	right
| [Thursday 05 May 2011] [04:18:00] <sustrik>	feel free to submit a documentation patch
| [Thursday 05 May 2011] [04:18:30] <sustrik>	hm
| [Thursday 05 May 2011] [04:19:22] <sustrik>	"if the downstream is not able to keep with the message feed, you should expect the memory usage to grow"
| [Thursday 05 May 2011] [04:19:50] <sustrik>	"if the HWMs are not set, this can eventually lead to memory exhaustion"
| [Thursday 05 May 2011] [04:19:54] <sustrik>	would that do?
| [Thursday 05 May 2011] [04:20:30] <djc>	you should emphasize that a single HWM at the downstream end might not suffice
| [Thursday 05 May 2011] [04:21:56] <sustrik>	would you mind to word it yourself?
| [Thursday 05 May 2011] [04:22:14] <sustrik>	for me it's kind of obvious so i am probably not a right person to write it down
| [Thursday 05 May 2011] [04:24:18] <skm>	i have a question on using epgm
| [Thursday 05 May 2011] [04:24:27] <skm>	i have two servers connected to 10.80.11.X
| [Thursday 05 May 2011] [04:24:38] <skm>	and one broadcasts via epgm://eth0;239.192.1.1:8000
| [Thursday 05 May 2011] [04:24:43] <skm>	the other receives on the same
| [Thursday 05 May 2011] [04:24:52] <skm>	the messages arent getting through
| [Thursday 05 May 2011] [04:25:05] <skm>	is it because of that address? is there another address i should be using?
| [Thursday 05 May 2011] [04:26:05] <sustrik>	the address looks ok
| [Thursday 05 May 2011] [04:26:19] <guido_g>	a) try the ip instead of the interface
| [Thursday 05 May 2011] [04:26:30] <sustrik>	and do you have multicast traffic enabled on your network?
| [Thursday 05 May 2011] [04:26:32] <guido_g>	b) check if multicast routes are working
| [Thursday 05 May 2011] [04:27:21] <Bartzy|work>	Hey
| [Thursday 05 May 2011] [04:27:33] <Bartzy|work>	Anyone here is using 0MQ with PHP ?
| [Thursday 05 May 2011] [04:27:59] <skm>	multicast routes - how do i check that/what do i do? *goes to google*
| [Thursday 05 May 2011] [04:31:30] <skm>	iptables
| [Thursday 05 May 2011] [04:31:31] <skm>	sign
| [Thursday 05 May 2011] [04:31:34] <skm>	sgh*
| [Thursday 05 May 2011] [04:31:40] <skm>	sigh*
| [Thursday 05 May 2011] [04:47:00] <mikko>	Bartzy|work: yes
| [Thursday 05 May 2011] [04:47:50] <Bartzy|work>	mikko: I was chatting @ ##php, and asked about daemons and 'servers' written in PHP, and most of the people there told me PHP is just not built for that. That it leaks memory, and it's generally bad for your health to do stuff that are not web-based in PHP
| [Thursday 05 May 2011] [04:48:25] <guido_g>	good advice :)
| [Thursday 05 May 2011] [04:48:26] <Bartzy|work>	mikko: Is that your experience too (since using ZeroMQ with PHP probably means not using it from a web server exclusively) ?
| [Thursday 05 May 2011] [04:49:11] <Bartzy|work>	I was thinking about learning python, but I need a solution now, and I know PHP fine... 
| [Thursday 05 May 2011] [04:50:25] <Bartzy|work>	guido_g: What's your language of choice ? :)
| [Thursday 05 May 2011] [04:50:31] <guido_g>	python is fine for these things
| [Thursday 05 May 2011] [04:50:31] <mikko>	PHP should be good enough for that if you respawn the workers within certain intervals
| [Thursday 05 May 2011] [04:50:40] <guido_g>	right
| [Thursday 05 May 2011] [04:50:59] <guido_g>	Bartzy|work: i'm mostly a python guy (for ~10 years)
| [Thursday 05 May 2011] [04:51:14] <guido_g>	but if you need something fast, use the things you know best
| [Thursday 05 May 2011] [04:53:17] <Bartzy|work>	mikko: How do I do that ?
| [Thursday 05 May 2011] [04:54:30] <guido_g>	Bartzy|work: just exit the process after a certain amount of requests
| [Thursday 05 May 2011] [04:54:37] <Bartzy|work>	mikko: I want to do this: 1 PHP process listening for jobs on a 0MQ TCP socket. when it gets something, it forks itself, running the job at the forked child (because it's blocking), and the master process (parent) doesn't stop listening to other jobs...
| [Thursday 05 May 2011] [04:54:48] <Bartzy|work>	guido_g: But what will start it back ?
| [Thursday 05 May 2011] [04:54:59] <guido_g>	a so called watchdog
| [Thursday 05 May 2011] [04:55:04] <Bartzy|work>	Monit ?
| [Thursday 05 May 2011] [04:55:21] <Bartzy|work>	mikko: Is that reasonable in your experience ? Forking in PHP won't mess up 0MQ extension ?
| [Thursday 05 May 2011] [04:59:10] <mikko>	no
| [Thursday 05 May 2011] [04:59:15] <mikko>	just create the socket in the fork
| [Thursday 05 May 2011] [04:59:32] <Bartzy|work>	in the fork ? But I fork only when I get a request
| [Thursday 05 May 2011] [05:00:01] <Bartzy|work>	and then I thought about contacting the parent with IPC (when the forked process ends the job)
| [Thursday 05 May 2011] [05:08:32] <mikko>	you have a process running somwhere in the background
| [Thursday 05 May 2011] [05:08:38] <mikko>	and you just send from your web script
| [Thursday 05 May 2011] [05:09:47] <Bartzy|work>	mikko? what ?
| [Thursday 05 May 2011] [05:10:20] <Bartzy|work>	I have a web script. It uses 0MQ to push out a job to a PHP script that runs constantly in the background
| [Thursday 05 May 2011] [05:10:49] <Bartzy|work>	that PHP script needs to continue listening for jobs, so it can't process the job itself
| [Thursday 05 May 2011] [05:11:13] <Bartzy|work>	so it forks itself, running the job in the forked child, and continuing listening to jobs coming in, forking as needed 
| [Thursday 05 May 2011] [05:11:25] <Bartzy|work>	mikko: That's what I want to do ^
| [Thursday 05 May 2011] [05:11:34] <mikko>	yes
| [Thursday 05 May 2011] [05:11:39] <Bartzy|work>	I just don't know if 0MQ will confuse when I fork
| [Thursday 05 May 2011] [05:11:52] <Bartzy|work>	cause I fork AFTER I use 0MQ context and sockets (to get the jobs)
| [Thursday 05 May 2011] [05:12:30] <Bartzy|work>	and I want to use 0MQ in the child processes to communicate with the parent process (child process saying it has completed the job).
| [Thursday 05 May 2011] [05:39:48] <mikko>	create them after fork
| [Thursday 05 May 2011] [05:40:00] <mikko>	i dont think they survive fork
| [Thursday 05 May 2011] [06:09:56] <guido_g>	mikko: please see http://www.zeromq.org/topics:monitoring-support and contribute, if you like
| [Thursday 05 May 2011] [06:19:05] <Bartzy|work>	mikko: I can't start it after the fork. I have to listen for incoming jobs before I fork.
| [Thursday 05 May 2011] [06:19:24] <Bartzy|work>	sorry for the huge delay. went to eat :|
| [Thursday 05 May 2011] [06:21:30] <mikko>	Bartzy|work: have you considered running a device?
| [Thursday 05 May 2011] [06:21:37] <mikko>	run a device that listens for incoming jobs
| [Thursday 05 May 2011] [06:21:44] <mikko>	and the php scripts connect to the device locally
| [Thursday 05 May 2011] [06:22:07] <Bartzy|work>	how would that help with the blocking issue ?
| [Thursday 05 May 2011] [06:22:30] <mikko>	your php scripts can be single threaded
| [Thursday 05 May 2011] [06:22:34] <mikko>	no need to fork anything
| [Thursday 05 May 2011] [06:22:46] <mikko>	if the script dies the device won't send anything to it anymore
| [Thursday 05 May 2011] [06:24:15] <Bartzy|work>	but I want only 1 php script
| [Thursday 05 May 2011] [06:24:22] <Bartzy|work>	Can you explain your suggestion further ?
| [Thursday 05 May 2011] [06:24:46] <Bartzy|work>	device = a dummy php script that only forwards requests ?
| [Thursday 05 May 2011] [06:26:38] <mikko>	have you read the zguide at all?
| [Thursday 05 May 2011] [06:26:56] <mikko>	devices are small daemons that forward requests
| [Thursday 05 May 2011] [06:27:20] <mikko>	the workers connect to the device
| [Thursday 05 May 2011] [06:27:26] <mikko>	and clients connect to the device as well
| [Thursday 05 May 2011] [06:27:37] <Bartzy|work>	Yes, but that will defeat the purpose of having only 1 worker than spawns sub-worker to do that actual jobs
| [Thursday 05 May 2011] [06:27:40] <mikko>	the client doesnt know about individual workers, how many or so
| [Thursday 05 May 2011] [06:27:54] <mikko>	Bartzy|work: why would you need only one worker?
| [Thursday 05 May 2011] [06:28:00] <mikko>	isn't that exactly what you don't want?
| [Thursday 05 May 2011] [06:28:20] <mikko>	if you have the workers as simple individual scripts you can respawn them periodically
| [Thursday 05 May 2011] [06:28:27] <Bartzy|work>	mikko: Cause I don't want to keep many workers alive... Is that a stupid thing to be worried of ?
| [Thursday 05 May 2011] [06:28:32] <Bartzy|work>	OK...
| [Thursday 05 May 2011] [06:28:36] <Bartzy|work>	Maybe I'm afraid of a non-issue
| [Thursday 05 May 2011] [06:28:45] <mikko>	what is the issue with multiple workers?
| [Thursday 05 May 2011] [06:28:54] <mikko>	it simplifies your code hugely
| [Thursday 05 May 2011] [06:29:02] <Bartzy|work>	I don't know.. I thought it would be a problem to respawn them
| [Thursday 05 May 2011] [06:29:53] <mikko>	it would be without the device
| [Thursday 05 May 2011] [06:30:05] <mikko>	but the device maintains the connections with your clients
| [Thursday 05 May 2011] [06:30:10] <mikko>	workers can come and go in the background
| [Thursday 05 May 2011] [06:30:37] <Bartzy|work>	But I guess if I kill them after a random number of requests (between the min and max request I want them to serve, so they won't all die together), and then monit/supervisord would respawn a worker after X seconds when it's dead... I assume it's fine?
| [Thursday 05 May 2011] [06:30:51] <Bartzy|work>	Yeah, that's smart... Like a job server
| [Thursday 05 May 2011] [06:31:42] <Bartzy|work>	and if I have 4 workers per machine. I have 2 machines. I want 1 request to go to 1 machine and the next to the 2nd machine.. I don't want 4 subsequent request to go to the same machine, and only after that going to the 2nd one...
| [Thursday 05 May 2011] [06:32:18] <Bartzy|work>	How the device is dispatching work ? At the order that the workers connected to it, or in some random fashion ?
| [Thursday 05 May 2011] [06:33:13] <sustrik>	round-robin
| [Thursday 05 May 2011] [06:34:36] <Bartzy|work>	round-robin is a list (1st worker, 2nd worker, 3rd worker) and the counter just increments (1st job to 1st worker, 2nd to 2nd... etc)
| [Thursday 05 May 2011] [06:34:39] <Bartzy|work>	But how the list is built ?
| [Thursday 05 May 2011] [06:34:50] <Bartzy|work>	According to the time the 'workers' connected to the device ?
| [Thursday 05 May 2011] [06:36:04] <sustrik>	it's unspecified
| [Thursday 05 May 2011] [06:36:19] <sustrik>	in reality the order is established as peers connect
| [Thursday 05 May 2011] [06:36:35] <sustrik>	however it changes as they disconnect or reach HWMs
| [Thursday 05 May 2011] [06:38:07] <Bartzy|work>	so I shouldn't worry about it ?
| [Thursday 05 May 2011] [06:38:37] <mikko>	the guide has examples for custom routing as well
| [Thursday 05 May 2011] [06:38:47] <Bartzy|work>	Cause if I have 2 actual machines, each running 4 workers, I don't want 1 machine to fill up with 4 jobs and the other machine not doing anything. I would rather have it more load balanced... 1 job to the first machine, 2nd job to the 2nd machine...
| [Thursday 05 May 2011] [06:38:51] <Bartzy|work>	mikko: thanks.
| [Thursday 05 May 2011] [06:41:15] <sustrik>	so you have 8 connections to load-balance among
| [Thursday 05 May 2011] [06:41:37] <sustrik>	what happens is that messages are sent in this way: 1,2,3,4,5,6,7,8,1,2,3...
| [Thursday 05 May 2011] [06:42:02] <sustrik>	so you'll have the tasks fairly balanced between the two machines
| [Thursday 05 May 2011] [06:42:15] <Bartzy|work>	yeah, but what if 1 2 3 4 connections are all in the same server ? That's not good. it's still load balancing but only if I have 8 jobs concurrently
| [Thursday 05 May 2011] [06:42:25] <mikko>	between machines it's 1,2,1,2,1,2,1,2,
| [Thursday 05 May 2011] [06:42:38] <mikko>	and between workers in a machine its 1,2,3,4,1,2,3,4
| [Thursday 05 May 2011] [06:42:40] <Bartzy|work>	if I have only 4 jobs, and 1-4 connections are on the same machine, only 1 is loaded
| [Thursday 05 May 2011] [06:43:03] <Bartzy|work>	so I should have 2 devices ? one for the machines only, and one for the workers @ each machine ?
| [Thursday 05 May 2011] [06:43:04] <sustrik>	mikko: ah, there's a device on each box?
| [Thursday 05 May 2011] [06:43:07] <mikko>	sustrik: yes
| [Thursday 05 May 2011] [06:43:14] <sustrik>	then yes
| [Thursday 05 May 2011] [06:43:19] <mikko>	Bartzy|work: each machine has a device
| [Thursday 05 May 2011] [06:43:29] <mikko>	you web scripts balance between 1,2,1,2,1,2
| [Thursday 05 May 2011] [06:43:45] <mikko>	and the devices round-robin between workers
| [Thursday 05 May 2011] [06:44:21] <Bartzy|work>	so I need a device to handle the 2 devices ?
| [Thursday 05 May 2011] [06:44:33] <Bartzy|work>	the web scripts need to connect to one device
| [Thursday 05 May 2011] [06:45:12] <Bartzy|work>	right ?
| [Thursday 05 May 2011] [06:46:33] <mikko>	sorry?
| [Thursday 05 May 2011] [06:46:41] <mikko>	"so I need a device to handle the 2 devices ?"
| [Thursday 05 May 2011] [06:46:50] <mikko>	you can start a device from php script
| [Thursday 05 May 2011] [06:47:10] <mikko>	the php script is just used to start the device, all the processing happens inside C code
| [Thursday 05 May 2011] [06:47:39] <mikko>	https://github.com/mkoppanen/php-zmq/blob/master/examples/forwarder-device.php
| [Thursday 05 May 2011] [06:47:45] <mikko>	there is an example of running a device
| [Thursday 05 May 2011] [06:52:57] <Bartzy|work>	mikko: OK. I understand that. My web scripts - They're connecting to who ?
| [Thursday 05 May 2011] [06:54:57] <mikko>	Bartzy|work: to the device
| [Thursday 05 May 2011] [06:55:11] <Bartzy|work>	mikko: But I have 1 at each machine. 
| [Thursday 05 May 2011] [06:58:19] <Bartzy|work>	To which of them my web scripts connect to ?
| [Thursday 05 May 2011] [07:05:33] <mikko>	both
| [Thursday 05 May 2011] [07:05:50] <mikko>	you can connect zeromq socket to multiple endpoints
| [Thursday 05 May 2011] [07:11:32] <Bartzy|work>	oh, that's nice. So if I add more machines, I must add them in my web code too . correct ?
| [Thursday 05 May 2011] [07:15:19] <sustrik>	the web code is transient, right?
| [Thursday 05 May 2011] [07:15:31] <sustrik>	it opens a socket, sends a message and closes the socket?
| [Thursday 05 May 2011] [07:16:27] <Bartzy|work>	no, it needs to get a response back that the job has ended
| [Thursday 05 May 2011] [07:16:42] <sustrik>	but then it exits, right?
| [Thursday 05 May 2011] [07:16:47] <Bartzy|work>	yes
| [Thursday 05 May 2011] [07:16:57] <sustrik>	ok, so, you can run one device on the same box as webserver and make all the webscripts connect to that device
| [Thursday 05 May 2011] [07:17:10] <Bartzy|work>	but anyway , if it needs to connect to first_machine_ip:port and to second_machine_ip:port , if I add a 3rd and 4th and 20th machine, the web code needs to know about that...
| [Thursday 05 May 2011] [07:17:26] <sustrik>	that device in turn would connect to all devices on the worker boxes
| [Thursday 05 May 2011] [07:17:42] <Bartzy|work>	OK, and then when I add a machine, the script that opens the device on each web server needs to know about the IPs of each machine ?
| [Thursday 05 May 2011] [07:17:55] <sustrik>	yes
| [Thursday 05 May 2011] [07:18:04] <sustrik>	or, alternatively
| [Thursday 05 May 2011] [07:18:10] <Bartzy|work>	No way around it with some other pattern ?
| [Thursday 05 May 2011] [07:18:10] <sustrik>	you can do it other way round
| [Thursday 05 May 2011] [07:18:22] <sustrik>	the devices on the worker boxes can connect to the central device
| [Thursday 05 May 2011] [07:38:29] <Bartzy|work>	so I need a central device to sit somewhere
| [Thursday 05 May 2011] [07:38:51] <Bartzy|work>	sustrik: I can't just send out to 1 of many, who ever is listening ?
| [Thursday 05 May 2011] [09:26:08] <Guthur>	I'm planning to use a queue device to develop a 'test farm' where the workers are making a number of potential long running http requests, best case maybe ~7secs, I'm wondering is it reasonable to have a client socket per test case
| [Thursday 05 May 2011] [09:26:13] <Guthur>	or is there a better approach
| [Thursday 05 May 2011] [09:43:14] <djc>	pyzmq is segfaulting on me :(
| [Thursday 05 May 2011] [09:51:06] <djc>	okay, I think this is a buglet: in 2.1, I can't connect a SUB to an inproc publisher before the publisher has bound to it
| [Thursday 05 May 2011] [09:51:09] <djc>	this worked in 2.0
| [Thursday 05 May 2011] [10:05:19] <pieterh>	djc: that didn't work in 2.0, pretty sure of it
| [Thursday 05 May 2011] [10:05:39] <pieterh>	it's a known issue with inproc sockets, in all versions of zmq
| [Thursday 05 May 2011] [10:07:12] <djc>	hmmm, it worked for me, although I guess some part of the timing setup could have changed between versions
| [Thursday 05 May 2011] [10:08:15] <pieterh>	yes, it'll be timing related
| [Thursday 05 May 2011] [10:17:38] <travlr>	it just happened again.. doesn't everbody already know that 0mq will make there  lives so much easier ;-}
| [Thursday 05 May 2011] [10:18:21] <travlr>	i'm watching FLOSS Weekly (http://twit.tv/floss164) and he  should be usinig 0mq forsure!
| [Thursday 05 May 2011] [10:25:35] <travlr>	ha! he just mention 0mq, go figure.
| [Thursday 05 May 2011] [10:33:34] <guido_g>	http://www.infoq.com/presentations/Large-Scale-Integration-in-Financial-Services <- nice definition of guaranteed messaging and mentions a well known low-level open-source messaging product
| [Thursday 05 May 2011] [10:36:56] <djc>	btw, I got some numbers from what we have running here
| [Thursday 05 May 2011] [10:37:24] <djc>	apparently we push up to 8000 msg/s, with a msg on average being 150b
| [Thursday 05 May 2011] [10:37:31] <djc>	so it's probably not that impressive
| [Thursday 05 May 2011] [10:44:01] <Guthur>	guido, that MPI thing?
| [Thursday 05 May 2011] [10:44:13] <Guthur>	AMQP
| [Thursday 05 May 2011] [10:44:21] <guido_g>	below amqp
| [Thursday 05 May 2011] [10:44:27] <guido_g>	on the chart 
| [Thursday 05 May 2011] [10:44:37] <guido_g>	at minute 9 something
| [Thursday 05 May 2011] [10:46:19] <Guthur>	guido_g: hehe, I was trying to be facetious
| [Thursday 05 May 2011] [10:46:34] <Guthur>	it does have a question mark after it though, 0MQ?
| [Thursday 05 May 2011] [10:47:41] <mile>	is it legal to bind to a SUB socket?
| [Thursday 05 May 2011] [10:48:05] <mile>	I need a server listening on 2 sockets, one for each communication direction
| [Thursday 05 May 2011] [10:48:10] <guido_g>	Guthur: at least it's mentioned
| [Thursday 05 May 2011] [10:48:29] <mile>	but I get assertion failed 
| [Thursday 05 May 2011] [10:49:06] <djc>	mile: that sounds confused
| [Thursday 05 May 2011] [10:49:17] <djc>	listening on two sockets, for each direction?
| [Thursday 05 May 2011] [10:49:35] <mile>	I am forwarding messages from a web socket to the backend
| [Thursday 05 May 2011] [10:49:47] <djc>	generally in at least one of the possible directions you wouldn't bind, you'd connect
| [Thursday 05 May 2011] [10:49:58] <mile>	so I need backend to connect to the gateway
| [Thursday 05 May 2011] [10:50:20] <Guthur>	guido_g: I just got and email there 20 mins ago from a colleague wanting to investigate using 0MQ for real-time flow in FX processing
| [Thursday 05 May 2011] [10:50:25] <Guthur>	Forex*
| [Thursday 05 May 2011] [10:50:26] <mile>	so gateway is binding on a PUB and on a SUB sockets
| [Thursday 05 May 2011] [10:50:37] <mile>	instead of SUB may be PULL
| [Thursday 05 May 2011] [10:50:43] <mile>	there I'm confused
| [Thursday 05 May 2011] [10:50:50] <Guthur>	I had placed on company wide cool tech page a couple of months ago
| [Thursday 05 May 2011] [10:51:18] <djc>	mile: you don't "bind" on a SUB
| [Thursday 05 May 2011] [10:51:22] <djc>	you "connect" on a SUB
| [Thursday 05 May 2011] [10:51:27] <djc>	you "bind" on a PUB
| [Thursday 05 May 2011] [10:51:41] <djc>	if it's the inverse thing of what you want to do, don't use PUB/SUB
| [Thursday 05 May 2011] [10:51:46] <guido_g>	Guthur: would be nice to see something like that
| [Thursday 05 May 2011] [10:51:57] <mile>	djc, I need exatly the inverse :)
| [Thursday 05 May 2011] [10:52:11] <djc>	mile: so use PUSH/PULL
| [Thursday 05 May 2011] [10:52:22] <mile>	ah, thanks! :)
| [Thursday 05 May 2011] [10:57:42] <pieterh>	mile: you can bind a SUB and connect a PUB, it's useful in some cases
| [Thursday 05 May 2011] [10:58:10] <pieterh>	imagine you have one stable subscriber and publishers that come and go
| [Thursday 05 May 2011] [10:58:22] <pieterh>	djc: sorry to correct you here
| [Thursday 05 May 2011] [10:58:24] <mile>	that is my scenario
| [Thursday 05 May 2011] [10:58:45] <pieterh>	push-pull and pub-sub do have different semantics
| [Thursday 05 May 2011] [10:58:58] <djc>	pieterh: that's fine, that way I get to learn something
| [Thursday 05 May 2011] [10:58:58] <mile>	they do the load balancing?
| [Thursday 05 May 2011] [10:59:01] <pieterh>	the main difference is if you (accidentally or on purpose) plug in a second subscriber
| [Thursday 05 May 2011] [10:59:13] <pieterh>	with pubsub, each sub will still get each message
| [Thursday 05 May 2011] [10:59:22] <pieterh>	with pushpull, messages will be load balanced
| [Thursday 05 May 2011] [10:59:52] <mile>	so that is semantically the main difference between those two?
| [Thursday 05 May 2011] [10:59:55] <pieterh>	the bind/connect direction is independent from the data flow and the pattern
| [Thursday 05 May 2011] [11:00:01] <pieterh>	yes
| [Thursday 05 May 2011] [11:00:14] <pieterh>	the semantic difference is loadbalancing with pushpull, fanout with pubsub
| [Thursday 05 May 2011] [11:00:27] <pieterh>	there are *some* edge cases where the bind/connect direction makes a difference
| [Thursday 05 May 2011] [11:00:29] <djc>	pieterh: so could I also bind REQ and connect REP, for example?
| [Thursday 05 May 2011] [11:00:33] <pieterh>	djc: yes
| [Thursday 05 May 2011] [11:00:38] <djc>	ah, edge cases
| [Thursday 05 May 2011] [11:00:43] <mile>	:)
| [Thursday 05 May 2011] [11:00:46] <pieterh>	the reason we generally don't do this is that it is confusing
| [Thursday 05 May 2011] [11:00:46] <djc>	tell me more about the edge cases ;)
| [Thursday 05 May 2011] [11:01:21] <pieterh>	djc: there was one issue reported on the list a while back, but I don't recall the details
| [Thursday 05 May 2011] [11:01:28] <pieterh>	could have been HWM processing
| [Thursday 05 May 2011] [11:01:46] <pieterh>	it worked differently depending on which sides did the bind & connect
| [Thursday 05 May 2011] [11:02:07] <pieterh>	that seems to be a bug, IMO, since formally the bind/connect direction should be irrelevant to message flow
| [Thursday 05 May 2011] [11:02:19] <Guthur>	guido_g: I'll certainly try to help this guy realise his proof of concept
| [Thursday 05 May 2011] [11:04:54] <guido_g>	Guthur: good luck, i would be happy to have such a project :)
| [Thursday 05 May 2011] [13:15:24] <cremes>	i have a non-0mq question for the channel
| [Thursday 05 May 2011] [13:15:40] <cremes>	it seems like a lot of folks are using 0mq for market data dissemination for trading systems
| [Thursday 05 May 2011] [13:16:13] <cremes>	how do you solve the issue of delivering market data (tick level details) to a web-browser client?
| [Thursday 05 May 2011] [13:16:34] <cremes>	are you bridging 0mq to websockets, using flash, or something proprietary?
| [Thursday 05 May 2011] [13:20:03] <guido_g>	seems noone delivers the accumulated data :)
| [Thursday 05 May 2011] [13:22:30] <pieterh>	anyone want a PATCH socket? :-)
| [Thursday 05 May 2011] [13:22:38] <pieterh>	Like a PUB and PULL combined. Grab it athttp://zero.mq/patch.
| [Thursday 05 May 2011] [13:23:18] <pieterh>	cremes: the only sane way I know of (but no-one is contributing) is an HTTP bridge that turns 0MQ patterns into HTTP ones
| [Thursday 05 May 2011] [13:23:26] <pieterh>	at some point I'll make the thing myself
| [Thursday 05 May 2011] [13:23:40] <cremes>	pieterh: interesting...
| [Thursday 05 May 2011] [13:23:40] <pieterh>	if you have a paying client who needs this, that'd be excellent of course
| [Thursday 05 May 2011] [13:23:58] <cremes>	of course! if there were such a client, it would be me
| [Thursday 05 May 2011] [13:24:10] <pieterh>	you can make HTTP patterns from the simple to the insanely complex
| [Thursday 05 May 2011] [13:24:15] <cremes>	i'm just doing some research in advance... i'm not going to get to it for several months at least
| [Thursday 05 May 2011] [13:24:23] <pieterh>	I'd do something RESTful with long polling, nothing more weird
| [Thursday 05 May 2011] [13:24:29] <pieterh>	doesn't need websockets
| [Thursday 05 May 2011] [13:24:45] <pieterh>	does need a reasonably well built web server
| [Thursday 05 May 2011] [13:25:17] <cremes>	pieterh: updating FAQ now with steps for building 0mq on windows mingw
| [Thursday 05 May 2011] [13:25:23] <cremes>	how do i make the 0 with a slash in it?
| [Thursday 05 May 2011] [13:25:34] <cremes>	what's the key combo?
| [Thursday 05 May 2011] [13:25:35] <pieterh>	cremes: you copy paste from somewhere else on the wiki :-)
| [Thursday 05 May 2011] [13:25:43] <cremes>	cheater
| [Thursday 05 May 2011] [13:25:56] <pieterh>	you can reprogram your keyboard if you're smart
| [Thursday 05 May 2011] [13:26:22] <cremes>	clearly, i cannot do that ;)
| [Thursday 05 May 2011] [13:28:49] <pieterh>	me neither, I just copy/paste all the time...
| [Thursday 05 May 2011] [13:31:08] <cremes>	okay, FAQ updated with mingw instructions
| [Thursday 05 May 2011] [13:32:29] <pieterh>	nice
| [Thursday 05 May 2011] [13:32:44] <pieterh>	there're also pages per platform afair
| [Thursday 05 May 2011] [13:36:51] <cremes>	pieterh: aren't those pages for "tuning"?
| [Thursday 05 May 2011] [13:37:06] 	 * pieterh can't find the platform pages any more...
| [Thursday 05 May 2011] [13:37:17] <pieterh>	there should be a page for Windows
| [Thursday 05 May 2011] [13:37:54] <pieterh>	I guess it's this one: http://www.zeromq.org/docs:windows-installations
| [Thursday 05 May 2011] [13:38:42] <pieterh>	anyhow, the Search function immediately returns the FAQ page, so it's all good...
| [Thursday 05 May 2011] [13:38:50] 	 * pieterh needs lunch, bbl
| [Thursday 05 May 2011] [15:27:52] <Guthur>	pieterh, the use of CLisp as the Common Lisp code link in the guide can cause a little confusion
| [Thursday 05 May 2011] [15:28:34] <Guthur>	CLisp is an implementation of Common Lisp and so can sometimes seem like it might use specific features of that implementation
| [Thursday 05 May 2011] [15:29:00] <Guthur>	it's only a minor point, but a CL user today was making that assumption
| [Thursday 05 May 2011] [15:34:24] <pieterh>	Guthur: I didn't know that
| [Thursday 05 May 2011] [15:35:02] <pieterh>	I shortened Common Lisp to CLisp for pragmatic reasons, didn't realize it was a specific implementation
| [Thursday 05 May 2011] [15:35:48] <pieterh>	I'll abbreviate it to CL then
| [Thursday 05 May 2011] [15:36:02] <Guthur>	pieterh, understandable
| [Thursday 05 May 2011] [15:36:04] <Guthur>	CL would be fine
| [Thursday 05 May 2011] [15:36:17] <Guthur>	clisp is the GNU implementation actually
| [Thursday 05 May 2011] [15:36:22] <pieterh>	ok
| [Thursday 05 May 2011] [15:38:24] <pieterh>	Guthur: ok, fixed, and new version published
| [Thursday 05 May 2011] [15:38:31] <pieterh>	sorry for the delay... :)
| [Thursday 05 May 2011] [15:43:37] <Guthur>	hehe, super service as usual
| [Thursday 05 May 2011] [16:38:50] <QQ_Nick>	Hi, I'm fairly new to 0mq but I've encountered a problem when using a PUSH/PULL pattern when using pyzmq. 
| [Thursday 05 May 2011] [16:40:53] <QQ_Nick>	I've set a HWM on the Push side, and when no client is running this seems to work OK.
| [Thursday 05 May 2011] [16:42:14] <QQ_Nick>	But if I start a Pull client with a HWM (say set to 10), all messages from the server are immediately sent to the client
| [Thursday 05 May 2011] [16:47:23] <djc>	yes, so?
| [Thursday 05 May 2011] [16:54:00] <QQ_Nick>	The server sends 1000 messages to my client which has a HWM of 10 messages set. 
| [Thursday 05 May 2011] [17:01:14] <djc>	yeah
| [Thursday 05 May 2011] [17:01:29] <djc>	this is how it works, the client will try to receive messages as fast as possible
| [Thursday 05 May 2011] [17:06:58] <QQ_Nick>	Does the HWM not limit the number of messages that the client queues? My client takes 1/20th second to process each message but still the server sends all 1000 messages to it immediately. 
| [Thursday 05 May 2011] [17:27:55] <mikko>	sustrik: there?
| [Thursday 05 May 2011] [21:03:59] <eyecue>	hai
| [Thursday 05 May 2011] [21:12:54] <mikko>	hello